(()=>{var ge,jp={416:(ge,vt,Je)=>{var Xe=Je(62);ge.exports=function R(Pe,Z,ct){return(Z=Xe(Z))in Pe?Object.defineProperty(Pe,Z,{value:ct,enumerable:!0,configurable:!0,writable:!0}):Pe[Z]=ct,Pe},ge.exports.__esModule=!0,ge.exports.default=ge.exports},36:(ge,vt,Je)=>{var Xe=Je(698).default;ge.exports=function R(Pe,Z){if("object"!==Xe(Pe)||null===Pe)return Pe;var ct=Pe[Symbol.toPrimitive];if(void 0!==ct){var Wn=ct.call(Pe,Z||"default");if("object"!==Xe(Wn))return Wn;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===Z?String:Number)(Pe)},ge.exports.__esModule=!0,ge.exports.default=ge.exports},62:(ge,vt,Je)=>{var Xe=Je(698).default,R=Je(36);ge.exports=function Pe(Z){var ct=R(Z,"string");return"symbol"===Xe(ct)?ct:String(ct)},ge.exports.__esModule=!0,ge.exports.default=ge.exports},698:ge=>{function vt(Je){return ge.exports=vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(Xe){return typeof Xe}:function(Xe){return Xe&&"function"==typeof Symbol&&Xe.constructor===Symbol&&Xe!==Symbol.prototype?"symbol":typeof Xe},ge.exports.__esModule=!0,ge.exports.default=ge.exports,vt(Je)}ge.exports=vt,ge.exports.__esModule=!0,ge.exports.default=ge.exports}},sl={};ge=function al(ge){var vt=sl[ge];if(void 0!==vt)return vt.exports;var Je=sl[ge]={exports:{}};return jp[ge](Je,Je.exports,al),Je.exports}(416).default,function(){"use strict";var Je=Xe;function Xe(r,e,t,n){this.cx=3*r,this.bx=3*(t-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=e,this.p2x=t,this.p2y=n}Xe.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,e){if(void 0===e&&(e=1e-6),r<0)return 0;if(r>1)return 1;for(var t=r,n=0;n<8;n++){var i=this.sampleCurveX(t)-r;if(Math.abs(i)<e)return t;var s=this.sampleCurveDerivativeX(t);if(Math.abs(s)<1e-6)break;t-=i/s}var a=0,o=1;for(t=r,n=0;n<20&&(i=this.sampleCurveX(t),!(Math.abs(i-r)<e));n++)r>i?a=t:o=t,t=.5*(o-a)+a;return t},solve:function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))}};var R=Pe;function Pe(r,e){this.x=r,this.y=e}Pe.prototype={clone:function(){return new Pe(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,e){return this.clone()._rotateAround(r,e)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var e=r.x-this.x,t=r.y-this.y;return e*e+t*t},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult:function(r){var e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var e=Math.cos(r),t=Math.sin(r),n=t*this.x+e*this.y;return this.x=e*this.x-t*this.y,this.y=n,this},_rotateAround:function(r,e){var t=Math.cos(r),n=Math.sin(r),i=e.y+n*(this.x-e.x)+t*(this.y-e.y);return this.x=e.x+t*(this.x-e.x)-n*(this.y-e.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Pe.convert=function(r){return r instanceof Pe?r:Array.isArray(r)?new Pe(r[0],r[1]):r};var Z=typeof self<"u"?self:{};const ct=Math.PI/180,Wn=180/Math.PI;function me(r){return r*ct}function it(r){return r*Wn}function ue(r,e,t){return Math.min(t,Math.max(e,r))}function ol(r,e,t){const n=t-e,i=((r-e)%n+n)%n+e;return i===e?t:i}function Ms(r){const e=[];for(const t in r)e.push(r[t]);return e}function Re(r,...e){for(const t of e)for(const n in t)r[n]=t[n];return r}new Je(.25,.1,.25,1);let $p=1;function ll(){return function r(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)}()}function ul(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)}function cl(r,e){r.forEach(t=>{e[t]&&(e[t]=e[t].bind(e))})}function Ts(r,e){return-1!==r.indexOf(e,r.length-e.length)}function zs(r,e,t){const n={};for(const i in r)n[i]=e.call(t||this,r[i],i,r);return n}function Ut(r){return Array.isArray(r)?r.map(Ut):"object"==typeof r&&r?zs(r,Ut):r}const hl={};function Ee(r){hl[r]||(typeof console<"u"&&console.warn(r),hl[r]=!0)}function qt(r,e,t){return(t.y-r.y)*(e.x-r.x)>(e.y-r.y)*(t.x-r.x)}function Op(r){let e=0;for(let t,n,i=0,s=r.length,a=s-1;i<s;a=i++)t=r[i],n=r[a],e+=(n.x-t.x)*(t.y+n.y);return e}function wr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Bs(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(t,n,i,s)=>{const a=i||s;return e[n]=!a||a.toLowerCase(),""}),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e}let Cs=null;function pl(r){if(null==Cs){const e=r.navigator?r.navigator.userAgent:null;Cs=!!r.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Cs}function fl(r){try{const e=Z[r];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Ps(r,e){return[r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]]}var _r=bt;function bt(r,e,t){var n=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var i=new Int32Array(this.arrayBuffer);r=i[0],this.d=(e=i[1])+2*(t=i[2]);for(var s=0;s<this.d*this.d;s++){var a=i[3+s],o=i[3+s+1];n.push(a===o?null:i.subarray(a,o))}var l=i[3+n.length+1];this.keys=i.subarray(i[3+n.length],l),this.bboxes=i.subarray(l),this.insert=this._insertReadonly}else{this.d=e+2*t;for(var u=0;u<this.d*this.d;u++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=r,this.padding=t,this.scale=e/r,this.uid=0;var c=t/e*r;this.min=-c,this.max=r+c}bt.prototype.insert=function(r,e,t,n,i){this._forEachCell(e,t,n,i,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(i)},bt.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},bt.prototype._insertCell=function(r,e,t,n,i,s){this.cells[i].push(s)},bt.prototype.query=function(r,e,t,n,i){var s=this.min,a=this.max;if(r<=s&&e<=s&&a<=t&&a<=n&&!i)return Array.prototype.slice.call(this.keys);var o=[];return this._forEachCell(r,e,t,n,this._queryCell,o,{},i),o},bt.prototype._queryCell=function(r,e,t,n,i,s,a,o){var l=this.cells[i];if(null!==l)for(var u=this.keys,c=this.bboxes,p=0;p<l.length;p++){var h=l[p];if(void 0===a[h]){var f=4*h;(o?o(c[f+0],c[f+1],c[f+2],c[f+3]):r<=c[f+2]&&e<=c[f+3]&&t>=c[f+0]&&n>=c[f+1])?(a[h]=!0,s.push(u[h])):a[h]=!1}}},bt.prototype._forEachCell=function(r,e,t,n,i,s,a,o){for(var l=this._convertToCellCoord(r),u=this._convertToCellCoord(e),c=this._convertToCellCoord(t),p=this._convertToCellCoord(n),h=l;h<=c;h++)for(var f=u;f<=p;f++){var d=this.d*f+h;if((!o||o(this._convertFromCellCoord(h),this._convertFromCellCoord(f),this._convertFromCellCoord(h+1),this._convertFromCellCoord(f+1)))&&i.call(this,r,e,t,n,d,s,a,o))return}},bt.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},bt.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},bt.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,e=3+this.cells.length+1+1,t=0,n=0;n<this.cells.length;n++)t+=this.cells[n].length;var i=new Int32Array(e+t+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var s=e,a=0;a<r.length;a++){var o=r[a];i[3+a]=s,i.set(o,s),s+=o.length}return i[3+r.length]=s,i.set(this.keys,s),i[3+r.length+1]=s+=this.keys.length,i.set(this.bboxes,s),s+=this.bboxes.length,i.buffer};var Es,dl={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Hn(r){return(r=Math.round(r))<0?0:r>255?255:r}function Ds(r){return Hn("%"===r[r.length-1]?parseFloat(r)/100*255:parseInt(r))}function Qn(r){return(e="%"===r[r.length-1]?parseFloat(r)/100:parseFloat(r))<0?0:e>1?1:e;var e}function Vs(r,e,t){return t<0?t+=1:t>1&&(t-=1),6*t<1?r+(e-r)*t*6:2*t<1?e:3*t<2?r+(e-r)*(2/3-t)*6:r}try{Es={}.parseCSSColor=function(r){var e,t=r.replace(/ /g,"").toLowerCase();if(t in dl)return dl[t].slice();if("#"===t[0])return 4===t.length?(e=parseInt(t.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===t.length&&(e=parseInt(t.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var n=t.indexOf("("),i=t.indexOf(")");if(-1!==n&&i+1===t.length){var s=t.substr(0,n),a=t.substr(n+1,i-(n+1)).split(","),o=1;switch(s){case"rgba":if(4!==a.length)return null;o=Qn(a.pop());case"rgb":return 3!==a.length?null:[Ds(a[0]),Ds(a[1]),Ds(a[2]),o];case"hsla":if(4!==a.length)return null;o=Qn(a.pop());case"hsl":if(3!==a.length)return null;var l=(parseFloat(a[0])%360+360)%360/360,u=Qn(a[1]),c=Qn(a[2]),p=c<=.5?c*(u+1):c+u-c*u,h=2*c-p;return[Hn(255*Vs(h,p,l+1/3)),Hn(255*Vs(h,p,l)),Hn(255*Vs(h,p,l-1/3)),o];default:return null}}return null}}catch{}class He{constructor(e,t,n,i=1){this.r=e,this.g=t,this.b=n,this.a=i}static parse(e){if(!e)return;if(e instanceof He)return e;if("string"!=typeof e)return;const t=Es(e);return t?new He(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3]):void 0}toString(){const[e,t,n,i]=this.toArray();return`rgba(${Math.round(e)},${Math.round(t)},${Math.round(n)},${i})`}toArray(){const{r:e,g:t,b:n,a:i}=this;return 0===i?[0,0,0,0]:[255*e/i,255*t/i,255*n/i,i]}toArray01(){const{r:e,g:t,b:n,a:i}=this;return 0===i?[0,0,0,0]:[e/i,t/i,n/i,i]}toArray01PremultipliedAlpha(){const{r:e,g:t,b:n,a:i}=this;return[e,t,n,i]}}He.black=new He(0,0,0,1),He.white=new He(1,1,1,1),He.transparent=new He(0,0,0,0),He.red=new He(1,0,0,1),He.blue=new He(0,0,1,1);var Be=He;function ar(r,...e){for(const t of e)for(const n in t)r[n]=t[n];return r}class Up extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}var wt=Up;class Ls{constructor(e,t=[]){this.parent=e,this.bindings={};for(const[n,i]of t)this.bindings[n]=i}concat(e){return new Ls(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var qp=Ls;const tn={kind:"null"},j={kind:"number"},ne={kind:"string"},ee={kind:"boolean"},_t={kind:"color"},Sr={kind:"object"},te={kind:"value"},ei={kind:"collator"},rn={kind:"formatted"},nn={kind:"resolvedImage"};function st(r,e){return{kind:"array",itemType:r,N:e}}function ke(r){if("array"===r.kind){const e=ke(r.itemType);return"number"==typeof r.N?`array<${e}, ${r.N}>`:"value"===r.itemType.kind?"array":`array<${e}>`}return r.kind}const Np=[tn,j,ne,ee,_t,rn,Sr,st(te),nn];function sn(r,e){if("error"===e.kind)return null;if("array"===r.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!sn(r.itemType,e.itemType))&&("number"!=typeof r.N||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if("value"===r.kind)for(const t of Np)if(!sn(t,e))return null}return`Expected ${ke(r)} but found ${ke(e)} instead.`}function Fs(r,e){return e.some(t=>t.kind===r.kind)}function an(r,e){return e.some(t=>"null"===t?null===r:"array"===t?Array.isArray(r):"object"===t?r&&!Array.isArray(r)&&"object"==typeof r:t===typeof r)}class Rs{constructor(e,t,n){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class js{constructor(e,t,n,i,s){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=n,this.fontStack=i,this.textColor=s}}class Qe{constructor(e){this.sections=e}static fromString(e){return new Qe([new js(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof Qe?e:Qe.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){e.push(["image",t.image.name]);continue}e.push(t.text);const n={};t.fontStack&&(n["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(n["font-scale"]=t.scale),t.textColor&&(n["text-color"]=["rgba"].concat(t.textColor.toArray())),e.push(n)}return e}}class at{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new at({name:e,available:!1}):null}serialize(){return["image",this.name]}}function yl(r,e,t,n){return"number"==typeof r&&r>=0&&r<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:`Invalid rgba value [${[r,e,t,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof n?[r,e,t,n]:[r,e,t]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ti(r){if(null===r||"string"==typeof r||"boolean"==typeof r||"number"==typeof r||r instanceof Be||r instanceof Rs||r instanceof Qe||r instanceof at)return!0;if(Array.isArray(r)){for(const e of r)if(!ti(e))return!1;return!0}if("object"==typeof r){for(const e in r)if(!ti(r[e]))return!1;return!0}return!1}function De(r){if(null===r)return tn;if("string"==typeof r)return ne;if("boolean"==typeof r)return ee;if("number"==typeof r)return j;if(r instanceof Be)return _t;if(r instanceof Rs)return ei;if(r instanceof Qe)return rn;if(r instanceof at)return nn;if(Array.isArray(r)){const e=r.length;let t;for(const n of r){const i=De(n);if(t){if(t===i)continue;t=te;break}t=i}return st(t||te,e)}return Sr}function on(r){const e=typeof r;return null===r?"":"string"===e||"number"===e||"boolean"===e?String(r):r instanceof Be||r instanceof Qe||r instanceof at?r.toString():JSON.stringify(r)}class $s{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ti(e[1]))return t.error("invalid value");const n=e[1];let i=De(n);const s=t.expectedType;return"array"!==i.kind||0!==i.N||!s||"array"!==s.kind||"number"==typeof s.N&&0!==s.N||(i=s),new $s(i,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Be?["rgba"].concat(this.value.toArray()):this.value instanceof Qe?this.value.serialize():this.value}}var ln=$s,Ue=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const Os={string:ne,number:j,boolean:ee,object:Sr};class Us{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let n,i=1;const s=e[0];if("array"===s){let o,l;if(e.length>2){const u=e[1];if("string"!=typeof u||!(u in Os)||"object"===u)return t.error('The item type argument of "array" must be one of string, number, boolean',1);o=Os[u],i++}else o=te;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);l=e[2],i++}n=st(o,l)}else n=Os[s];const a=[];for(;i<e.length;i++){const o=t.parse(e[i],i,te);if(!o)return null;a.push(o)}return new Us(n,a)}evaluate(e){for(let t=0;t<this.args.length;t++){const n=this.args[t].evaluate(e);if(!sn(this.type,De(n)))return n;if(t===this.args.length-1)throw new Ue(`Expected value to be of type ${ke(this.type)}, but found ${ke(De(n))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const n=e.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){t.push(n.kind);const i=e.N;("number"==typeof i||this.args.length>1)&&t.push(i)}}return t.concat(this.args.map(n=>n.serialize()))}}var Bt=Us;class un{constructor(e){this.type=rn,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&"object"==typeof n)return t.error("First argument must be an image or text section.");const i=[];let s=!1;for(let a=1;a<=e.length-1;++a){const o=e[a];if(s&&"object"==typeof o&&!Array.isArray(o)){s=!1;let l=null;if(o["font-scale"]&&(l=t.parse(o["font-scale"],1,j),!l))return null;let u=null;if(o["text-font"]&&(u=t.parse(o["text-font"],1,st(ne)),!u))return null;let c=null;if(o["text-color"]&&(c=t.parse(o["text-color"],1,_t),!c))return null;const p=i[i.length-1];p.scale=l,p.font=u,p.textColor=c}else{const l=t.parse(e[a],1,te);if(!l)return null;const u=l.type.kind;if("string"!==u&&"value"!==u&&"null"!==u&&"resolvedImage"!==u)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");s=!0,i.push({content:l,scale:null,font:null,textColor:null})}}return new un(i)}evaluate(e){return new Qe(this.sections.map(t=>{const n=t.content.evaluate(e);return De(n)===nn?new js("",n,null,null,null):new js(on(n),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const n={};t.scale&&(n["font-scale"]=t.scale.serialize()),t.font&&(n["text-font"]=t.font.serialize()),t.textColor&&(n["text-color"]=t.textColor.serialize()),e.push(n)}return e}}class ri{constructor(e){this.type=nn,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected two arguments.");const n=t.parse(e[1],1,ne);return n?new ri(n):t.error("No image name provided.")}evaluate(e){const t=this.input.evaluate(e),n=at.fromString(t);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(t)>-1),n}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Zp={"to-boolean":ee,"to-color":_t,"to-number":j,"to-string":ne};class qs{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const n=e[0];if(("to-boolean"===n||"to-string"===n)&&2!==e.length)return t.error("Expected one argument.");const i=Zp[n],s=[];for(let a=1;a<e.length;a++){const o=t.parse(e[a],a,te);if(!o)return null;s.push(o)}return new qs(i,s)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,n;for(const i of this.args){if(t=i.evaluate(e),n=null,t instanceof Be)return t;if("string"==typeof t){const s=e.parseColor(t);if(s)return s}else if(Array.isArray(t)&&(n=t.length<3||t.length>4?`Invalid rbga value ${JSON.stringify(t)}: expected an array containing either three or four numeric values.`:yl(t[0],t[1],t[2],t[3]),!n))return new Be(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Ue(n||`Could not parse color from value '${"string"==typeof t?t:String(JSON.stringify(t))}'`)}if("number"===this.type.kind){let t=null;for(const n of this.args){if(t=n.evaluate(e),null===t)return 0;const i=Number(t);if(!isNaN(i))return i}throw new Ue(`Could not convert ${JSON.stringify(t)} to number.`)}return"formatted"===this.type.kind?Qe.fromString(on(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?at.fromString(on(this.args[0].evaluate(e))):on(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new un([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ri(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(t=>{e.push(t.serialize())}),e}}var Ar=qs;const Gp=["Unknown","Point","LineString","Polygon"];var ml=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Gp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:n,y:i}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*t-e[0])+this.featureDistanceData.bearing[1]*(i*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Be.parse(e)),t}};class kr{constructor(e,t,n,i){this.name=e,this.type=t,this._evaluate=n,this.args=i}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,t){const n=e[0],i=kr.definitions[n];if(!i)return t.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const s=Array.isArray(i)?i[0]:i.type,a=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,o=a.filter(([u])=>!Array.isArray(u)||u.length===e.length-1);let l=null;for(const[u,c]of o){l=new Al(t.registry,t.path,null,t.scope);const p=[];let h=!1;for(let f=1;f<e.length;f++){const d=e[f],y=Array.isArray(u)?u[f-1]:u.type,m=l.parse(d,1+p.length,y);if(!m){h=!0;break}p.push(m)}if(!h)if(Array.isArray(u)&&u.length!==p.length)l.error(`Expected ${u.length} arguments, but found ${p.length} instead.`);else{for(let f=0;f<p.length;f++){const d=Array.isArray(u)?u[f]:u.type,y=p[f];l.concat(f+1).checkSubtype(d,y.type)}if(0===l.errors.length)return new kr(n,s,c,p)}}if(1===o.length)t.errors.push(...l.errors);else{const u=(o.length?o:a).map(([p])=>{return h=p,Array.isArray(h)?`(${h.map(ke).join(", ")})`:`(${ke(h.type)}...)`;var h}).join(" | "),c=[];for(let p=1;p<e.length;p++){const h=t.parse(e[p],1+c.length);if(!h)return null;c.push(ke(h.type))}t.error(`Expected arguments of type ${u}, but found (${c.join(", ")}) instead.`)}return null}static register(e,t){kr.definitions=t;for(const n in t)e[n]=kr}}var Nt=kr;class ni{constructor(e,t,n){this.type=ei,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const n=e[1];if("object"!=typeof n||Array.isArray(n))return t.error("Collator options argument must be an object.");const i=t.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,ee);if(!i)return null;const s=t.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,ee);if(!s)return null;let a=null;return n.locale&&(a=t.parse(n.locale,1,ne),!a)?null:new ni(i,s,a)}evaluate(e){return new Rs(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Zt=8192;function Ns(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function ii(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function Xp(r,e){const t=(180+r[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,i=Math.pow(2,e.z);return[Math.round(t*i*Zt),Math.round(n*i*Zt)]}function Yp(r,e,t){const n=r[0]-e[0],i=r[1]-e[1],s=r[0]-t[0],a=r[1]-t[1];return n*a-s*i==0&&n*s<=0&&i*a<=0}function Zs(r,e){let t=!1;for(let a=0,o=e.length;a<o;a++){const l=e[a];for(let u=0,c=l.length;u<c-1;u++){if(Yp(r,l[u],l[u+1]))return!1;(i=l[u])[1]>(n=r)[1]!=(s=l[u+1])[1]>n[1]&&n[0]<(s[0]-i[0])*(n[1]-i[1])/(s[1]-i[1])+i[0]&&(t=!t)}}var n,i,s;return t}function Kp(r,e){for(let t=0;t<e.length;t++)if(Zs(r,e[t]))return!0;return!1}function gl(r,e,t,n){const i=n[0]-t[0],s=n[1]-t[1],a=(r[0]-t[0])*s-i*(r[1]-t[1]),o=(e[0]-t[0])*s-i*(e[1]-t[1]);return a>0&&o<0||a<0&&o>0}function Jp(r,e,t){for(const u of t)for(let c=0;c<u.length-1;++c)if((o=[(a=u[c+1])[0]-(s=u[c])[0],a[1]-s[1]])[0]*(l=[(i=e)[0]-(n=r)[0],i[1]-n[1]])[1]-o[1]*l[0]!=0&&gl(n,i,s,a)&&gl(s,a,n,i))return!0;var n,i,s,a,o,l;return!1}function xl(r,e){for(let t=0;t<r.length;++t)if(!Zs(r[t],e))return!1;for(let t=0;t<r.length-1;++t)if(Jp(r[t],r[t+1],e))return!1;return!0}function Wp(r,e){for(let t=0;t<e.length;t++)if(xl(r,e[t]))return!0;return!1}function Gs(r,e,t){const n=[];for(let i=0;i<r.length;i++){const s=[];for(let a=0;a<r[i].length;a++){const o=Xp(r[i][a],t);Ns(e,o),s.push(o)}n.push(s)}return n}function vl(r,e,t){const n=[];for(let i=0;i<r.length;i++){const s=Gs(r[i],e,t);n.push(s)}return n}function bl(r,e,t,n){if(r[0]<t[0]||r[0]>t[2]){const i=.5*n;let s=r[0]-t[0]>i?-n:t[0]-r[0]>i?n:0;0===s&&(s=r[0]-t[2]>i?-n:t[2]-r[0]>i?n:0),r[0]+=s}Ns(e,r)}function wl(r,e,t,n){const i=Math.pow(2,n.z)*Zt,s=[n.x*Zt,n.y*Zt],a=[];if(!r)return a;for(const o of r)for(const l of o){const u=[l.x+s[0],l.y+s[1]];bl(u,e,t,i),a.push(u)}return a}function _l(r,e,t,n){const i=Math.pow(2,n.z)*Zt,s=[n.x*Zt,n.y*Zt],a=[];if(!r)return a;for(const l of r){const u=[];for(const c of l){const p=[c.x+s[0],c.y+s[1]];Ns(e,p),u.push(p)}a.push(u)}if(e[2]-e[0]<=i/2){(o=e)[0]=o[1]=1/0,o[2]=o[3]=-1/0;for(const l of a)for(const u of l)bl(u,e,t,i)}var o;return a}class cn{constructor(e,t){this.type=ee,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ti(e[1])){const n=e[1];if("FeatureCollection"===n.type)for(let i=0;i<n.features.length;++i){const s=n.features[i].geometry.type;if("Polygon"===s||"MultiPolygon"===s)return new cn(n,n.features[i].geometry)}else if("Feature"===n.type){const i=n.geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new cn(n,n.geometry)}else if("Polygon"===n.type||"MultiPolygon"===n.type)return new cn(n,n)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(t,n){const i=[1/0,1/0,-1/0,-1/0],s=[1/0,1/0,-1/0,-1/0],a=t.canonicalID();if(!a)return!1;if("Polygon"===n.type){const o=Gs(n.coordinates,s,a),l=wl(t.geometry(),i,s,a);if(!ii(i,s))return!1;for(const u of l)if(!Zs(u,o))return!1}if("MultiPolygon"===n.type){const o=vl(n.coordinates,s,a),l=wl(t.geometry(),i,s,a);if(!ii(i,s))return!1;for(const u of l)if(!Kp(u,o))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(t,n){const i=[1/0,1/0,-1/0,-1/0],s=[1/0,1/0,-1/0,-1/0],a=t.canonicalID();if(!a)return!1;if("Polygon"===n.type){const o=Gs(n.coordinates,s,a),l=_l(t.geometry(),i,s,a);if(!ii(i,s))return!1;for(const u of l)if(!xl(u,o))return!1}if("MultiPolygon"===n.type){const o=vl(n.coordinates,s,a),l=_l(t.geometry(),i,s,a);if(!ii(i,s))return!1;for(const u of l)if(!Wp(u,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Xs=cn;function hn(r){if(r instanceof Nt&&("get"===r.name&&1===r.args.length||"feature-state"===r.name||"has"===r.name&&1===r.args.length||"properties"===r.name||"geometry-type"===r.name||"id"===r.name||/^filter-/.test(r.name))||r instanceof Xs)return!1;let e=!0;return r.eachChild(t=>{e&&!hn(t)&&(e=!1)}),e}function si(r){if(r instanceof Nt&&"feature-state"===r.name)return!1;let e=!0;return r.eachChild(t=>{e&&!si(t)&&(e=!1)}),e}function ai(r,e){if(r instanceof Nt&&e.indexOf(r.name)>=0)return!1;let t=!0;return r.eachChild(n=>{t&&!ai(n,e)&&(t=!1)}),t}class Ys{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const n=e[1];return t.scope.has(n)?new Ys(n,t.scope.get(n)):t.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Sl=Ys;class Ks{constructor(e,t=[],n,i=new qp,s=[]){this.registry=e,this.path=t,this.key=t.map(a=>`[${a}]`).join(""),this.scope=i,this.errors=s,this.expectedType=n}parse(e,t,n,i,s={}){return t?this.concat(t,n,i)._parse(e,s):this._parse(e,s)}_parse(e,t){function n(i,s,a){return"assert"===a?new Bt(s,[i]):"coerce"===a?new Ar(s,[i]):i}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const i=e[0];if("string"!=typeof i)return this.error(`Expression name must be a string, but found ${typeof i} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const s=this.registry[i];if(s){let a=s.parse(e,this);if(!a)return null;if(this.expectedType){const o=this.expectedType,l=a.type;if("string"!==o.kind&&"number"!==o.kind&&"boolean"!==o.kind&&"object"!==o.kind&&"array"!==o.kind||"value"!==l.kind)if("color"!==o.kind&&"formatted"!==o.kind&&"resolvedImage"!==o.kind||"value"!==l.kind&&"string"!==l.kind){if(this.checkSubtype(o,l))return null}else a=n(a,o,t.typeAnnotation||"coerce");else a=n(a,o,t.typeAnnotation||"assert")}if(!(a instanceof ln)&&"resolvedImage"!==a.type.kind&&Js(a)){const o=new ml;try{a=new ln(a.type,a.evaluate(o))}catch(l){return this.error(l.message),null}}return a}return this.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,t,n){const i="number"==typeof e?this.path.concat(e):this.path,s=n?this.scope.concat(n):this.scope;return new Ks(this.registry,i,t||null,s,this.errors)}error(e,...t){const n=`${this.key}${t.map(i=>`[${i}]`).join("")}`;this.errors.push(new wt(n,e))}checkSubtype(e,t){const n=sn(e,t);return n&&this.error(n),n}}var Al=Ks;function Js(r){if(r instanceof Sl)return Js(r.boundExpression);if(r instanceof Nt&&"error"===r.name||r instanceof ni||r instanceof Xs)return!1;const e=r instanceof Ar||r instanceof Bt;let t=!0;return r.eachChild(n=>{t=e?t&&Js(n):t&&n instanceof ln}),!!t&&hn(r)&&ai(r,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function oi(r,e){const t=r.length-1;let n,i,s=0,a=t,o=0;for(;s<=a;)if(o=Math.floor((s+a)/2),n=r[o],i=r[o+1],n<=e){if(o===t||e<i)return o;s=o+1}else{if(!(n>e))throw new Ue("Input is not a number.");a=o-1}return 0}class Ws{constructor(e,t,n){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[i,s]of n)this.labels.push(i),this.outputs.push(s)}static parse(e,t){if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const n=t.parse(e[1],1,j);if(!n)return null;const i=[];let s=null;t.expectedType&&"value"!==t.expectedType.kind&&(s=t.expectedType);for(let a=1;a<e.length;a+=2){const o=1===a?-1/0:e[a],l=e[a+1],u=a,c=a+1;if("number"!=typeof o)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(i.length&&i[i.length-1][0]>=o)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);const p=t.parse(l,c,s);if(!p)return null;s=s||p.type,i.push([o,p])}return new Ws(s,n,i)}evaluate(e){const t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const s=t.length;return i>=t[s-1]?n[s-1].evaluate(e):n[oi(t,i)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}var Hs=Ws;function fe(r,e,t){return r*(1-t)+e*t}var li=Object.freeze({__proto__:null,number:fe,color:function(r,e,t){return new Be(fe(r.r,e.r,t),fe(r.g,e.g,t),fe(r.b,e.b,t),fe(r.a,e.a,t))},array:function(r,e,t){return r.map((n,i)=>fe(n,e[i],t))}});const Ml=4/29,Qs=6/29,Tl=3*Qs*Qs,Hp=Math.PI/180,Qp=180/Math.PI;function ea(r){return r>.008856451679035631?Math.pow(r,1/3):r/Tl+Ml}function ta(r){return r>Qs?r*r*r:Tl*(r-Ml)}function ra(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function na(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function zl(r){const e=na(r.r),t=na(r.g),n=na(r.b),i=ea((.4124564*e+.3575761*t+.1804375*n)/.95047),s=ea((.2126729*e+.7151522*t+.072175*n)/1);return{l:116*s-16,a:500*(i-s),b:200*(s-ea((.0193339*e+.119192*t+.9503041*n)/1.08883)),alpha:r.a}}function Bl(r){let e=(r.l+16)/116,t=isNaN(r.a)?e:e+r.a/500,n=isNaN(r.b)?e:e-r.b/200;return e=1*ta(e),t=.95047*ta(t),n=1.08883*ta(n),new Be(ra(3.2404542*t-1.5371385*e-.4985314*n),ra(-.969266*t+1.8760108*e+.041556*n),ra(.0556434*t-.2040259*e+1.0572252*n),r.alpha)}function ef(r,e,t){const n=e-r;return r+t*(n>180||n<-180?n-360*Math.round(n/360):n)}const pn={forward:zl,reverse:Bl,interpolate:function(r,e,t){return{l:fe(r.l,e.l,t),a:fe(r.a,e.a,t),b:fe(r.b,e.b,t),alpha:fe(r.alpha,e.alpha,t)}}},fn={forward:function(r){const{l:e,a:t,b:n}=zl(r),i=Math.atan2(n,t)*Qp;return{h:i<0?i+360:i,c:Math.sqrt(t*t+n*n),l:e,alpha:r.a}},reverse:function(r){const e=r.h*Hp,t=r.c;return Bl({l:r.l,a:Math.cos(e)*t,b:Math.sin(e)*t,alpha:r.alpha})},interpolate:function(r,e,t){return{h:ef(r.h,e.h,t),c:fe(r.c,e.c,t),l:fe(r.l,e.l,t),alpha:fe(r.alpha,e.alpha,t)}}};var Cl=Object.freeze({__proto__:null,lab:pn,hcl:fn});class ui{constructor(e,t,n,i,s){this.type=e,this.operator=t,this.interpolation=n,this.input=i,this.labels=[],this.outputs=[];for(const[a,o]of s)this.labels.push(a),this.outputs.push(o)}static interpolationFactor(e,t,n,i){let s=0;if("exponential"===e.name)s=ia(t,e.base,n,i);else if("linear"===e.name)s=ia(t,1,n,i);else if("cubic-bezier"===e.name){const a=e.controlPoints;s=new Je(a[0],a[1],a[2],a[3]).solve(ia(t,1,n,i))}return s}static parse(e,t){let[n,i,s,...a]=e;if(!Array.isArray(i)||0===i.length)return t.error("Expected an interpolation type expression.",1);if("linear"===i[0])i={name:"linear"};else if("exponential"===i[0]){const u=i[1];if("number"!=typeof u)return t.error("Exponential interpolation requires a numeric base.",1,1);i={name:"exponential",base:u}}else{if("cubic-bezier"!==i[0])return t.error(`Unknown interpolation type ${String(i[0])}`,1,0);{const u=i.slice(1);if(4!==u.length||u.some(c=>"number"!=typeof c||c<0||c>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);i={name:"cubic-bezier",controlPoints:u}}}if(e.length-1<4)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(s=t.parse(s,2,j),!s)return null;const o=[];let l=null;"interpolate-hcl"===n||"interpolate-lab"===n?l=_t:t.expectedType&&"value"!==t.expectedType.kind&&(l=t.expectedType);for(let u=0;u<a.length;u+=2){const c=a[u],p=a[u+1],h=u+3,f=u+4;if("number"!=typeof c)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',h);if(o.length&&o[o.length-1][0]>=c)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',h);const d=t.parse(p,f,l);if(!d)return null;l=l||d.type,o.push([c,d])}return"number"===l.kind||"color"===l.kind||"array"===l.kind&&"number"===l.itemType.kind&&"number"==typeof l.N?new ui(l,n,i,s,o):t.error(`Type ${ke(l)} is not interpolatable.`)}evaluate(e){const t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);const i=this.input.evaluate(e);if(i<=t[0])return n[0].evaluate(e);const s=t.length;if(i>=t[s-1])return n[s-1].evaluate(e);const a=oi(t,i),o=ui.interpolationFactor(this.interpolation,i,t[a],t[a+1]),l=n[a].evaluate(e),u=n[a+1].evaluate(e);return"interpolate"===this.operator?li[this.type.kind.toLowerCase()](l,u,o):"interpolate-hcl"===this.operator?fn.reverse(fn.interpolate(fn.forward(l),fn.forward(u),o)):pn.reverse(pn.interpolate(pn.forward(l),pn.forward(u),o))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const t=[this.operator,e,this.input.serialize()];for(let n=0;n<this.labels.length;n++)t.push(this.labels[n],this.outputs[n].serialize());return t}}function ia(r,e,t,n){const i=n-t,s=r-t;return 0===i?0:1===e?s/i:(Math.pow(e,s)-1)/(Math.pow(e,i)-1)}var St=ui;class sa{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let n=null;const i=t.expectedType;i&&"value"!==i.kind&&(n=i);const s=[];for(const o of e.slice(1)){const l=t.parse(o,1+s.length,n,void 0,{typeAnnotation:"omit"});if(!l)return null;n=n||l.type,s.push(l)}const a=i&&s.some(o=>sn(i,o.type));return new sa(a?te:n,s)}evaluate(e){let t,n=null,i=0;for(const s of this.args){if(i++,n=s.evaluate(e),n&&n instanceof at&&!n.available&&(t||(t=n),n=null,i===this.args.length))return t;if(null!==n)break}return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var Pl=sa;class aa{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let s=1;s<e.length-1;s+=2){const a=e[s];if("string"!=typeof a)return t.error(`Expected string, but found ${typeof a} instead.`,s);if(/[^a-zA-Z0-9_]/.test(a))return t.error("Variable names must contain only alphanumeric characters or '_'.",s);const o=t.parse(e[s+1],s+1);if(!o)return null;n.push([a,o])}const i=t.parse(e[e.length-1],e.length-1,t.expectedType,n);return i?new aa(n,i):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,n]of this.bindings)e.push(t,n.serialize());return e.push(this.result.serialize()),e}}var El=aa;class oa{constructor(e,t,n){this.type=e,this.index=t,this.input=n}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,j),i=t.parse(e[2],2,st(t.expectedType||te));return n&&i?new oa(i.type.itemType,n,i):null}evaluate(e){const t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new Ue(`Array index out of bounds: ${t} < 0.`);if(t>=n.length)throw new Ue(`Array index out of bounds: ${t} > ${n.length-1}.`);if(t!==Math.floor(t))throw new Ue(`Array index must be an integer, but found ${t} instead.`);return n[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var tf=oa;class la{constructor(e,t){this.type=ee,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,te),i=t.parse(e[2],2,te);return n&&i?Fs(n.type,[ee,ne,j,tn,te])?new la(n,i):t.error(`Expected first argument to be of type boolean, string, number or null, but found ${ke(n.type)} instead`):null}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(null==n)return!1;if(!an(t,["boolean","string","number","null"]))throw new Ue(`Expected first argument to be of type boolean, string, number or null, but found ${ke(De(t))} instead.`);if(!an(n,["string","array"]))throw new Ue(`Expected second argument to be of type array or string, but found ${ke(De(n))} instead.`);return n.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var rf=la;class ci{constructor(e,t,n){this.type=j,this.needle=e,this.haystack=t,this.fromIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,te),i=t.parse(e[2],2,te);if(!n||!i)return null;if(!Fs(n.type,[ee,ne,j,tn,te]))return t.error(`Expected first argument to be of type boolean, string, number or null, but found ${ke(n.type)} instead`);if(4===e.length){const s=t.parse(e[3],3,j);return s?new ci(n,i,s):null}return new ci(n,i)}evaluate(e){const t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!an(t,["boolean","string","number","null"]))throw new Ue(`Expected first argument to be of type boolean, string, number or null, but found ${ke(De(t))} instead.`);if(!an(n,["string","array"]))throw new Ue(`Expected second argument to be of type array or string, but found ${ke(De(n))} instead.`);if(this.fromIndex){const i=this.fromIndex.evaluate(e);return n.indexOf(t,i)}return n.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var nf=ci;class ua{constructor(e,t,n,i,s,a){this.inputType=e,this.type=t,this.input=n,this.cases=i,this.outputs=s,this.otherwise=a}static parse(e,t){if(e.length<5)return t.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return t.error("Expected an even number of arguments.");let n,i;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);const s={},a=[];for(let u=2;u<e.length-1;u+=2){let c=e[u];const p=e[u+1];Array.isArray(c)||(c=[c]);const h=t.concat(u);if(0===c.length)return h.error("Expected at least one branch label.");for(const d of c){if("number"!=typeof d&&"string"!=typeof d)return h.error("Branch labels must be numbers or strings.");if("number"==typeof d&&Math.abs(d)>Number.MAX_SAFE_INTEGER)return h.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof d&&Math.floor(d)!==d)return h.error("Numeric branch labels must be integer values.");if(n){if(h.checkSubtype(n,De(d)))return null}else n=De(d);if(void 0!==s[String(d)])return h.error("Branch labels must be unique.");s[String(d)]=a.length}const f=t.parse(p,u,i);if(!f)return null;i=i||f.type,a.push(f)}const o=t.parse(e[1],1,te);if(!o)return null;const l=t.parse(e[e.length-1],e.length-1,i);return l?"value"!==o.type.kind&&t.concat(1).checkSubtype(n,o.type)?null:new ua(n,i,o,s,a,l):null}evaluate(e){const t=this.input.evaluate(e);return(De(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),n=[],i={};for(const a of t){const o=i[this.cases[a]];void 0===o?(i[this.cases[a]]=n.length,n.push([this.cases[a],[a]])):n[o][1].push(a)}const s=a=>"number"===this.inputType.kind?Number(a):a;for(const[a,o]of n)e.push(1===o.length?s(o[0]):o.map(s)),e.push(this.outputs[a].serialize());return e.push(this.otherwise.serialize()),e}}var sf=ua;class ca{constructor(e,t,n){this.type=e,this.branches=t,this.otherwise=n}static parse(e,t){if(e.length<4)return t.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const i=[];for(let a=1;a<e.length-1;a+=2){const o=t.parse(e[a],a,ee);if(!o)return null;const l=t.parse(e[a+1],a+1,n);if(!l)return null;i.push([o,l]),n=n||l.type}const s=t.parse(e[e.length-1],e.length-1,n);return s?new ca(n,i,s):null}evaluate(e){for(const[t,n]of this.branches)if(t.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,n]of this.branches)e(t),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(([e,t])=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(t=>{e.push(t.serialize())}),e}}var af=ca;class hi{constructor(e,t,n,i){this.type=e,this.input=t,this.beginIndex=n,this.endIndex=i}static parse(e,t){if(e.length<=2||e.length>=5)return t.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=t.parse(e[1],1,te),i=t.parse(e[2],2,j);if(!n||!i)return null;if(!Fs(n.type,[st(te),ne,te]))return t.error(`Expected first argument to be of type array or string, but found ${ke(n.type)} instead`);if(4===e.length){const s=t.parse(e[3],3,j);return s?new hi(n.type,n,i,s):null}return new hi(n.type,n,i)}evaluate(e){const t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!an(t,["string","array"]))throw new Ue(`Expected first argument to be of type array or string, but found ${ke(De(t))} instead.`);if(this.endIndex){const i=this.endIndex.evaluate(e);return t.slice(n,i)}return t.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var of=hi;function Dl(r,e){return"=="===r||"!="===r?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Vl(r,e,t,n){return 0===n.compare(e,t)}function Ir(r,e,t){const n="=="!==r&&"!="!==r;return class Rp{constructor(s,a,o){this.type=ee,this.lhs=s,this.rhs=a,this.collator=o,this.hasUntypedArgument="value"===s.type.kind||"value"===a.type.kind}static parse(s,a){if(3!==s.length&&4!==s.length)return a.error("Expected two or three arguments.");const o=s[0];let l=a.parse(s[1],1,te);if(!l)return null;if(!Dl(o,l.type))return a.concat(1).error(`"${o}" comparisons are not supported for type '${ke(l.type)}'.`);let u=a.parse(s[2],2,te);if(!u)return null;if(!Dl(o,u.type))return a.concat(2).error(`"${o}" comparisons are not supported for type '${ke(u.type)}'.`);if(l.type.kind!==u.type.kind&&"value"!==l.type.kind&&"value"!==u.type.kind)return a.error(`Cannot compare types '${ke(l.type)}' and '${ke(u.type)}'.`);n&&("value"===l.type.kind&&"value"!==u.type.kind?l=new Bt(u.type,[l]):"value"!==l.type.kind&&"value"===u.type.kind&&(u=new Bt(l.type,[u])));let c=null;if(4===s.length){if("string"!==l.type.kind&&"string"!==u.type.kind&&"value"!==l.type.kind&&"value"!==u.type.kind)return a.error("Cannot use collator to compare non-string types.");if(c=a.parse(s[3],3,ei),!c)return null}return new Rp(l,u,c)}evaluate(s){const a=this.lhs.evaluate(s),o=this.rhs.evaluate(s);if(n&&this.hasUntypedArgument){const l=De(a),u=De(o);if(l.kind!==u.kind||"string"!==l.kind&&"number"!==l.kind)throw new Ue(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${l.kind}, ${u.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const l=De(a),u=De(o);if("string"!==l.kind||"string"!==u.kind)return e(s,a,o)}return this.collator?t(s,a,o,this.collator.evaluate(s)):e(s,a,o)}eachChild(s){s(this.lhs),s(this.rhs),this.collator&&s(this.collator)}outputDefined(){return!0}serialize(){const s=[r];return this.eachChild(a=>{s.push(a.serialize())}),s}}}const lf=Ir("==",function(r,e,t){return e===t},Vl),uf=Ir("!=",function(r,e,t){return e!==t},function(r,e,t,n){return!Vl(0,e,t,n)}),cf=Ir("<",function(r,e,t){return e<t},function(r,e,t,n){return n.compare(e,t)<0}),hf=Ir(">",function(r,e,t){return e>t},function(r,e,t,n){return n.compare(e,t)>0}),pf=Ir("<=",function(r,e,t){return e<=t},function(r,e,t,n){return n.compare(e,t)<=0}),ff=Ir(">=",function(r,e,t){return e>=t},function(r,e,t,n){return n.compare(e,t)>=0});class ha{constructor(e,t,n,i,s,a){this.type=ne,this.number=e,this.locale=t,this.currency=n,this.unit=i,this.minFractionDigits=s,this.maxFractionDigits=a}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const n=t.parse(e[1],1,j);if(!n)return null;const i=e[2];if("object"!=typeof i||Array.isArray(i))return t.error("NumberFormat options argument must be an object.");let s=null;if(i.locale&&(s=t.parse(i.locale,1,ne),!s))return null;let a=null;if(i.currency&&(a=t.parse(i.currency,1,ne),!a))return null;let o=null;if(i.unit&&(o=t.parse(i.unit,1,ne),!o))return null;let l=null;if(i["min-fraction-digits"]&&(l=t.parse(i["min-fraction-digits"],1,j),!l))return null;let u=null;return i["max-fraction-digits"]&&(u=t.parse(i["max-fraction-digits"],1,j),!u)?null:new ha(n,s,a,o,l,u)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class pa{constructor(e){this.type=j,this.input=e}static parse(e,t){if(2!==e.length)return t.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=t.parse(e[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?t.error(`Expected argument of type string or array, but found ${ke(n.type)} instead.`):new pa(n):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t||Array.isArray(t))return t.length;throw new Ue(`Expected value to be of type string or array, but found ${ke(De(t))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(t=>{e.push(t.serialize())}),e}}const Ll={"==":lf,"!=":uf,">":hf,"<":cf,">=":ff,"<=":pf,array:Bt,at:tf,boolean:Bt,case:af,coalesce:Pl,collator:ni,format:un,image:ri,in:rf,"index-of":nf,interpolate:St,"interpolate-hcl":St,"interpolate-lab":St,length:pa,let:El,literal:ln,match:sf,number:Bt,"number-format":ha,object:Bt,slice:of,step:Hs,string:Bt,"to-boolean":Ar,"to-color":Ar,"to-number":Ar,"to-string":Ar,var:Sl,within:Xs};function Fl(r,[e,t,n,i]){e=e.evaluate(r),t=t.evaluate(r),n=n.evaluate(r);const s=i?i.evaluate(r):1,a=yl(e,t,n,s);if(a)throw new Ue(a);return new Be(e/255*s,t/255*s,n/255*s,s)}function Rl(r,e){return r in e}function fa(r,e){const t=e[r];return void 0===t?null:t}function or(r){return{type:r}}Nt.register(Ll,{error:[{kind:"error"},[ne],(r,[e])=>{throw new Ue(e.evaluate(r))}],typeof:[ne,[te],(r,[e])=>ke(De(e.evaluate(r)))],"to-rgba":[st(j,4),[_t],(r,[e])=>e.evaluate(r).toArray()],rgb:[_t,[j,j,j],Fl],rgba:[_t,[j,j,j,j],Fl],has:{type:ee,overloads:[[[ne],(r,[e])=>Rl(e.evaluate(r),r.properties())],[[ne,Sr],(r,[e,t])=>Rl(e.evaluate(r),t.evaluate(r))]]},get:{type:te,overloads:[[[ne],(r,[e])=>fa(e.evaluate(r),r.properties())],[[ne,Sr],(r,[e,t])=>fa(e.evaluate(r),t.evaluate(r))]]},"feature-state":[te,[ne],(r,[e])=>fa(e.evaluate(r),r.featureState||{})],properties:[Sr,[],r=>r.properties()],"geometry-type":[ne,[],r=>r.geometryType()],id:[te,[],r=>r.id()],zoom:[j,[],r=>r.globals.zoom],pitch:[j,[],r=>r.globals.pitch||0],"distance-from-center":[j,[],r=>r.distanceFromCenter()],"heatmap-density":[j,[],r=>r.globals.heatmapDensity||0],"line-progress":[j,[],r=>r.globals.lineProgress||0],"sky-radial-progress":[j,[],r=>r.globals.skyRadialProgress||0],accumulated:[te,[],r=>void 0===r.globals.accumulated?null:r.globals.accumulated],"+":[j,or(j),(r,e)=>{let t=0;for(const n of e)t+=n.evaluate(r);return t}],"*":[j,or(j),(r,e)=>{let t=1;for(const n of e)t*=n.evaluate(r);return t}],"-":{type:j,overloads:[[[j,j],(r,[e,t])=>e.evaluate(r)-t.evaluate(r)],[[j],(r,[e])=>-e.evaluate(r)]]},"/":[j,[j,j],(r,[e,t])=>e.evaluate(r)/t.evaluate(r)],"%":[j,[j,j],(r,[e,t])=>e.evaluate(r)%t.evaluate(r)],ln2:[j,[],()=>Math.LN2],pi:[j,[],()=>Math.PI],e:[j,[],()=>Math.E],"^":[j,[j,j],(r,[e,t])=>Math.pow(e.evaluate(r),t.evaluate(r))],sqrt:[j,[j],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[j,[j],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[j,[j],(r,[e])=>Math.log(e.evaluate(r))],log2:[j,[j],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[j,[j],(r,[e])=>Math.sin(e.evaluate(r))],cos:[j,[j],(r,[e])=>Math.cos(e.evaluate(r))],tan:[j,[j],(r,[e])=>Math.tan(e.evaluate(r))],asin:[j,[j],(r,[e])=>Math.asin(e.evaluate(r))],acos:[j,[j],(r,[e])=>Math.acos(e.evaluate(r))],atan:[j,[j],(r,[e])=>Math.atan(e.evaluate(r))],min:[j,or(j),(r,e)=>Math.min(...e.map(t=>t.evaluate(r)))],max:[j,or(j),(r,e)=>Math.max(...e.map(t=>t.evaluate(r)))],abs:[j,[j],(r,[e])=>Math.abs(e.evaluate(r))],round:[j,[j],(r,[e])=>{const t=e.evaluate(r);return t<0?-Math.round(-t):Math.round(t)}],floor:[j,[j],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[j,[j],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[ee,[ne,te],(r,[e,t])=>r.properties()[e.value]===t.value],"filter-id-==":[ee,[te],(r,[e])=>r.id()===e.value],"filter-type-==":[ee,[ne],(r,[e])=>r.geometryType()===e.value],"filter-<":[ee,[ne,te],(r,[e,t])=>{const n=r.properties()[e.value],i=t.value;return typeof n==typeof i&&n<i}],"filter-id-<":[ee,[te],(r,[e])=>{const t=r.id(),n=e.value;return typeof t==typeof n&&t<n}],"filter->":[ee,[ne,te],(r,[e,t])=>{const n=r.properties()[e.value],i=t.value;return typeof n==typeof i&&n>i}],"filter-id->":[ee,[te],(r,[e])=>{const t=r.id(),n=e.value;return typeof t==typeof n&&t>n}],"filter-<=":[ee,[ne,te],(r,[e,t])=>{const n=r.properties()[e.value],i=t.value;return typeof n==typeof i&&n<=i}],"filter-id-<=":[ee,[te],(r,[e])=>{const t=r.id(),n=e.value;return typeof t==typeof n&&t<=n}],"filter->=":[ee,[ne,te],(r,[e,t])=>{const n=r.properties()[e.value],i=t.value;return typeof n==typeof i&&n>=i}],"filter-id->=":[ee,[te],(r,[e])=>{const t=r.id(),n=e.value;return typeof t==typeof n&&t>=n}],"filter-has":[ee,[te],(r,[e])=>e.value in r.properties()],"filter-has-id":[ee,[],r=>null!==r.id()&&void 0!==r.id()],"filter-type-in":[ee,[st(ne)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[ee,[st(te)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[ee,[ne,st(te)],(r,[e,t])=>t.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[ee,[ne,st(te)],(r,[e,t])=>function(n,i,s,a){for(;s<=a;){const o=s+a>>1;if(i[o]===n)return!0;i[o]>n?a=o-1:s=o+1}return!1}(r.properties()[e.value],t.value,0,t.value.length-1)],all:{type:ee,overloads:[[[ee,ee],(r,[e,t])=>e.evaluate(r)&&t.evaluate(r)],[or(ee),(r,e)=>{for(const t of e)if(!t.evaluate(r))return!1;return!0}]]},any:{type:ee,overloads:[[[ee,ee],(r,[e,t])=>e.evaluate(r)||t.evaluate(r)],[or(ee),(r,e)=>{for(const t of e)if(t.evaluate(r))return!0;return!1}]]},"!":[ee,[ee],(r,[e])=>!e.evaluate(r)],"is-supported-script":[ee,[ne],(r,[e])=>{const t=r.globals&&r.globals.isSupportedScript;return!t||t(e.evaluate(r))}],upcase:[ne,[ne],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[ne,[ne],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[ne,or(te),(r,e)=>e.map(t=>on(t.evaluate(r))).join("")],"resolved-locale":[ne,[ei],(r,[e])=>e.evaluate(r).resolvedLocale()]});var dn=Ll;function jl(r){return{result:"success",value:r}}function Mr(r){return{result:"error",value:r}}function Tr(r){return"data-driven"===r["property-type"]}function $l(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function da(r){return!!r.expression&&r.expression.interpolated}function oe(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":null===r?"null":typeof r}function pi(r){return"object"==typeof r&&null!==r&&!Array.isArray(r)}function df(r){return r}function Ol(r,e){const t="color"===e.type,n=r.stops&&"object"==typeof r.stops[0][0],i=n||!(n||void 0!==r.property),s=r.type||(da(e)?"exponential":"interval");if(t&&((r=ar({},r)).stops&&(r.stops=r.stops.map(u=>[u[0],Be.parse(u[1])])),r.default=Be.parse(r.default?r.default:e.default)),r.colorSpace&&"rgb"!==r.colorSpace&&!Cl[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let a,o,l;if("exponential"===s)a=Ul;else if("interval"===s)a=mf;else if("categorical"===s){a=yf,o=Object.create(null);for(const u of r.stops)o[u[0]]=u[1];l=typeof r.stops[0][0]}else{if("identity"!==s)throw new Error(`Unknown function type "${s}"`);a=gf}if(n){const u={},c=[];for(let f=0;f<r.stops.length;f++){const d=r.stops[f],y=d[0].zoom;void 0===u[y]&&(u[y]={zoom:y,type:r.type,property:r.property,default:r.default,stops:[]},c.push(y)),u[y].stops.push([d[0].value,d[1]])}const p=[];for(const f of c)p.push([u[f].zoom,Ol(u[f],e)]);const h={name:"linear"};return{kind:"composite",interpolationType:h,interpolationFactor:St.interpolationFactor.bind(void 0,h),zoomStops:p.map(f=>f[0]),evaluate:({zoom:f},d)=>Ul({stops:p,base:r.base},e,f).evaluate(f,d)}}if(i){const u="exponential"===s?{name:"exponential",base:void 0!==r.base?r.base:1}:null;return{kind:"camera",interpolationType:u,interpolationFactor:St.interpolationFactor.bind(void 0,u),zoomStops:r.stops.map(c=>c[0]),evaluate:({zoom:c})=>a(r,e,c,o,l)}}return{kind:"source",evaluate(u,c){const p=c&&c.properties?c.properties[r.property]:void 0;return void 0===p?yn(r.default,e.default):a(r,e,p,o,l)}}}function yn(r,e,t){return void 0!==r?r:void 0!==e?e:void 0!==t?t:void 0}function yf(r,e,t,n,i){return yn(typeof t===i?n[t]:void 0,r.default,e.default)}function mf(r,e,t){if("number"!==oe(t))return yn(r.default,e.default);const n=r.stops.length;if(1===n||t<=r.stops[0][0])return r.stops[0][1];if(t>=r.stops[n-1][0])return r.stops[n-1][1];const i=oi(r.stops.map(s=>s[0]),t);return r.stops[i][1]}function Ul(r,e,t){const n=void 0!==r.base?r.base:1;if("number"!==oe(t))return yn(r.default,e.default);const i=r.stops.length;if(1===i||t<=r.stops[0][0])return r.stops[0][1];if(t>=r.stops[i-1][0])return r.stops[i-1][1];const s=oi(r.stops.map(c=>c[0]),t),a=function(c,p,h,f){const d=f-h,y=c-h;return 0===d?0:1===p?y/d:(Math.pow(p,y)-1)/(Math.pow(p,d)-1)}(t,n,r.stops[s][0],r.stops[s+1][0]),o=r.stops[s][1],l=r.stops[s+1][1];let u=li[e.type]||df;if(r.colorSpace&&"rgb"!==r.colorSpace){const c=Cl[r.colorSpace];u=(p,h)=>c.reverse(c.interpolate(c.forward(p),c.forward(h),a))}return"function"==typeof o.evaluate?{evaluate(...c){const p=o.evaluate.apply(void 0,c),h=l.evaluate.apply(void 0,c);if(void 0!==p&&void 0!==h)return u(p,h,a)}}:u(o,l,a)}function gf(r,e,t){return"color"===e.type?t=Be.parse(t):"formatted"===e.type?t=Qe.fromString(t.toString()):"resolvedImage"===e.type?t=at.fromString(t.toString()):oe(t)===e.type||"enum"===e.type&&e.values[t]||(t=void 0),yn(t,r.default,e.default)}class ya{constructor(e,t){var n;this.expression=e,this._warningHistory={},this._evaluator=new ml,this._defaultValue=t?"color"===(n=t).type&&(pi(n.default)||Array.isArray(n.default))?new Be(0,0,0,0):"color"===n.type?Be.parse(n.default)||null:void 0===n.default?null:n.default:null,this._enumValues=t&&"enum"===t.type?t.values:null}evaluateWithoutErrorHandling(e,t,n,i,s,a,o,l){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=i||null,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=a,this._evaluator.featureTileCoord=o||null,this._evaluator.featureDistanceData=l||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,n,i,s,a,o,l){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=i||null,this._evaluator.availableImages=s||null,this._evaluator.formattedSection=a||null,this._evaluator.featureTileCoord=o||null,this._evaluator.featureDistanceData=l||null;try{const u=this.expression.evaluate(this._evaluator);if(null==u||"number"==typeof u&&u!=u)return this._defaultValue;if(this._enumValues&&!(u in this._enumValues))throw new Ue(`Expected value to be one of ${Object.keys(this._enumValues).map(c=>JSON.stringify(c)).join(", ")}, but found ${JSON.stringify(u)} instead.`);return u}catch(u){return this._warningHistory[u.message]||(this._warningHistory[u.message]=!0,typeof console<"u"&&console.warn(u.message)),this._defaultValue}}}function fi(r){return Array.isArray(r)&&r.length>0&&"string"==typeof r[0]&&r[0]in dn}function lr(r,e){const t=new Al(dn,[],e?function(i){const s={color:_t,string:ne,number:j,enum:ne,boolean:ee,formatted:rn,resolvedImage:nn};return"array"===i.type?st(s[i.value]||te,i.length):s[i.type]}(e):void 0),n=t.parse(r,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return n?jl(new ya(n,e)):Mr(t.errors)}class ma{constructor(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent="constant"!==e&&!si(t.expression)}evaluateWithoutErrorHandling(e,t,n,i,s,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,s,a)}evaluate(e,t,n,i,s,a){return this._styleExpression.evaluate(e,t,n,i,s,a)}}class ga{constructor(e,t,n,i){this.kind=e,this.zoomStops=n,this._styleExpression=t,this.isStateDependent="camera"!==e&&!si(t.expression),this.interpolationType=i}evaluateWithoutErrorHandling(e,t,n,i,s,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,i,s,a)}evaluate(e,t,n,i,s,a){return this._styleExpression.evaluate(e,t,n,i,s,a)}interpolationFactor(e,t,n){return this.interpolationType?St.interpolationFactor(this.interpolationType,e,t,n):0}}function ql(r,e){if("error"===(r=lr(r,e)).result)return r;const t=r.value.expression,n=hn(t);if(!n&&!Tr(e))return Mr([new wt("","data expressions not supported")]);const i=ai(t,["zoom","pitch","distance-from-center"]);if(!i&&!$l(e))return Mr([new wt("","zoom expressions not supported")]);const s=yi(t);return s||i?s instanceof wt?Mr([s]):s instanceof St&&!da(e)?Mr([new wt("",'"interpolate" expressions cannot be used with this property')]):jl(s?new ga(n?"camera":"composite",r.value,s.labels,s instanceof St?s.interpolation:void 0):new ma(n?"constant":"source",r.value)):Mr([new wt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class di{constructor(e,t){this._parameters=e,this._specification=t,ar(this,Ol(this._parameters,this._specification))}static deserialize(e){return new di(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function yi(r){let e=null;if(r instanceof El)e=yi(r.result);else if(r instanceof Pl){for(const t of r.args)if(e=yi(t),e)break}else(r instanceof Hs||r instanceof St)&&r.input instanceof Nt&&"zoom"===r.input.name&&(e=r);return e instanceof wt||r.eachChild(t=>{const n=yi(t);n instanceof wt?e=n:!e&&n?e=new wt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new wt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}let mi;const Me={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==mi){const r=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{mi=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):r}catch{mi=r}}return mi},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){try{const r=new URL(Me.API_URL);return"api.mapbox.cn"===r.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===r.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},xf={supported:!1,testSupport:function(r){!xa&&zr&&(Nl?Zl(r):mn=r)}};let mn,zr,xa=!1,Nl=!1;function Zl(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,zr),r.isContextLost())return;xf.supported=!0}catch{}r.deleteTexture(e),xa=!0}Z.document&&(zr=Z.document.createElement("img"),zr.onload=function(){mn&&Zl(mn),mn=null,Nl=!0},zr.onerror=function(){xa=!0,mn=null},zr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var va="2.14.0";const Gl={create:"create",load:"load",fullLoad:"fullLoad"};function vf(r){const e=r.name.split("?")[0];return Yl(e)&&e.includes("mapbox-gl.js")?"javascript":Yl(e)&&e.includes("mapbox-gl.css")?"css":Me.API_FONTS_REGEX.test(e)?"fontRange":Jl(e)?"sprite":Kl(e)?"style":Me.API_TILEJSON_REGEX.test(e)?"tilejson":"other"}const Xl="NO_ACCESS_TOKEN";function ba(r){return Me.API_URL_REGEX.test(r)}function Yl(r){return Me.API_CDN_URL_REGEX.test(r)}function Kl(r){return Me.API_STYLE_REGEX.test(r)&&!Jl(r)}function Jl(r){return Me.API_SPRITE_REGEX.test(r)}const bf=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Wl(r){const e=r.match(bf);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Hl(r){const e=r.params.length?`?${r.params.join("&")}`:"";return`${r.protocol}://${r.authority}${r.path}${e}`}function Ql(r){if(!r)return null;const e=r.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(Z.atob(e[1]).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class gi{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const t=Ql(Me.ACCESS_TOKEN);let n="";return n=t&&t.u?Z.btoa(encodeURIComponent(t.u).replace(/%([0-9A-F]{2})/g,(i,s)=>String.fromCharCode(Number("0x"+s)))):"",e?`mapbox.eventData.${e}:${n}`:`mapbox.eventData:${n}`}fetchEventData(){const e=fl("localStorage"),t=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{const i=Z.localStorage.getItem(t);i&&(this.eventData=JSON.parse(i));const s=Z.localStorage.getItem(n);s&&(this.anonId=s)}catch{Ee("Unable to read from LocalStorage")}}saveEventData(){const e=fl("localStorage"),t=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{Z.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&Z.localStorage.setItem(t,JSON.stringify(this.eventData))}catch{Ee("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,t,n,i){if(!Me.EVENTS_URL)return;const s=Wl(Me.EVENTS_URL);s.params.push(`access_token=${i||Me.ACCESS_TOKEN||""}`);const a={event:this.type,created:new Date(e).toISOString()},o=t?Re(a,t):a,l={url:Hl(s),headers:{"Content-Type":"text/plain"},body:JSON.stringify([o])};this.pendingRequest=wf(l,u=>{this.pendingRequest=null,n(u),this.saveEventData(),this.processRequests(i)})}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}const eu=new class extends gi{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){Me.EVENTS_URL&&Me.ACCESS_TOKEN&&Array.isArray(e)&&e.some(n=>0===n.indexOf("mapbox:")||ba(n))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Ql(Me.ACCESS_TOKEN),n=t?t.u:Me.ACCESS_TOKEN;let i=n!==this.eventData.tokenU;ul(this.anonId)||(this.anonId=ll(),i=!0);const s=this.queue.shift();if(this.eventData.lastSuccess){const a=new Date(this.eventData.lastSuccess),o=new Date(s),l=(s-this.eventData.lastSuccess)/864e5;i=i||l>=1||l<-1||a.getDate()!==o.getDate()}else i=!0;i?this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:va,skuId:"01","enabled.telemetry":!1,userId:this.anonId},a=>{a||(this.eventData.lastSuccess=s,this.eventData.tokenU=n)},e):this.processRequests()}};eu.postTurnstileEvent.bind(eu);const tu=new class extends gi{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,n,i){this.skuToken=t,this.errorCb=i,Me.EVENTS_URL&&(n||Me.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(Xl)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),ul(this.anonId)||(this.anonId=ll()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:va,skuId:"01",skuToken:this.skuToken,userId:this.anonId},i=>{i?this.errorCb(i):t&&(this.success[t]=!0)},e))}};tu.postMapLoadEvent.bind(tu);const ru=new class extends gi{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){Me.EVENTS_URL&&(e||Me.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:t,performanceData:n}=this.queue.shift(),i=function(s){const a=Z.performance.getEntriesByType("resource"),o=Z.performance.getEntriesByType("mark"),l=function(f){const d={};if(f)for(const y in f)if("other"!==y)for(const m of f[y]){const g=`${y}ResolveRangeMin`,b=`${y}ResolveRangeMax`,x=`${y}RequestCount`,v=`${y}RequestCachedCount`;d[g]=Math.min(d[g]||1/0,m.startTime),d[b]=Math.max(d[b]||-1/0,m.responseEnd);const _=w=>{void 0===d[w]&&(d[w]=0),++d[w]};void 0!==m.transferSize&&0===m.transferSize&&_(v),_(x)}return d}(function(f,d){const y={};if(f)for(const m of f){const g=d(m);void 0===y[g]&&(y[g]=[]),y[g].push(m)}return y}(a,vf)),u=Z.devicePixelRatio,c=Z.navigator.connection||Z.navigator.mozConnection||Z.navigator.webkitConnection,p={counters:[],metadata:[],attributes:[]},h=(f,d,y)=>{null!=y&&f.push({name:d,value:y.toString()})};for(const f in l)h(p.counters,f,l[f]);if(s.interactionRange[0]!==1/0&&s.interactionRange[1]!==-1/0&&(h(p.counters,"interactionRangeMin",s.interactionRange[0]),h(p.counters,"interactionRangeMax",s.interactionRange[1])),o)for(const f of Object.keys(Gl)){const d=Gl[f],y=o.find(m=>m.name===d);y&&h(p.counters,d,y.startTime)}return h(p.counters,"visibilityHidden",s.visibilityHidden),h(p.attributes,"style",function(f){if(f)for(const d of f){const y=d.name.split("?")[0];if(Kl(y)){const m=y.split("/").slice(-2);if(2===m.length)return`mapbox://styles/${m[0]}/${m[1]}`}}}(a)),h(p.attributes,"terrainEnabled",s.terrainEnabled?"true":"false"),h(p.attributes,"fogEnabled",s.fogEnabled?"true":"false"),h(p.attributes,"projection",s.projection),h(p.attributes,"zoom",s.zoom),h(p.metadata,"devicePixelRatio",u),h(p.metadata,"connectionEffectiveType",c?c.effectiveType:void 0),h(p.metadata,"navigatorUserAgent",Z.navigator.userAgent),h(p.metadata,"screenWidth",Z.screen.width),h(p.metadata,"screenHeight",Z.screen.height),h(p.metadata,"windowWidth",Z.innerWidth),h(p.metadata,"windowHeight",Z.innerHeight),h(p.metadata,"mapWidth",s.width/u),h(p.metadata,"mapHeight",s.height/u),h(p.metadata,"webglRenderer",s.renderer),h(p.metadata,"webglVendor",s.vendor),h(p.metadata,"sdkVersion",va),h(p.metadata,"sdkIdentifier","mapbox-gl-js"),p}(n);for(const s of i.metadata);for(const s of i.counters);for(const s of i.attributes);this.postEvent(t,i,()=>{},e)}};ru.postPerformanceEvent.bind(ru);const nu=new class extends gi{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,n,i){const s=Wl(Me.API_URL+Me.SESSION_PATH);s.params.push(`sku=${t||""}`),s.params.push(`access_token=${i||Me.ACCESS_TOKEN||""}`);const a={url:Hl(s),headers:{"Content-Type":"text/plain"}};this.pendingRequest=_f(a,o=>{this.pendingRequest=null,n(o),this.saveEventData(),this.processRequests(i)})}getSessionAPI(e,t,n,i){this.skuToken=t,this.errorCb=i,n||Me.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error(Xl))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||this.getSession(n,this.skuToken,i=>{i?this.errorCb(i):t&&(this.success[t]=!0)},e)}};let Ct,xi;function vi(){(function(){try{return Z.caches}catch{}})()&&!Ct&&(Ct=Z.caches.open("mapbox-tiles"))}function iu(r){const e=r.indexOf("?");if(e<0)return r;const n=function(i){const s=i.indexOf("?");return s>0?i.slice(s+1).split("&"):[]}(r).filter(i=>{const s=i.split("=");return"language"===s[0]||"worldview"===s[0]});return n.length?`${r.slice(0,e)}?${n.join("&")}`:r.slice(0,e)}nu.getSessionAPI.bind(nu),"function"==typeof Object.freeze&&Object.freeze({Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"});class wa extends Error{constructor(e,t,n){401===t&&ba(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=n}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const su=wr()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Z.location.protocol?Z.parent:Z).location.href,bi=function(r,e){if(!(/^file:/.test(t=r.url)||/^file:/.test(su())&&!/^\w+:/.test(t))){if(Z.fetch&&Z.Request&&Z.AbortController&&Z.Request.prototype.hasOwnProperty("signal"))return function(n,i){const s=new Z.AbortController,a=new Z.Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,referrer:su(),referrerPolicy:n.referrerPolicy,signal:s.signal});let o=!1,l=!1;const u=(c=a.url).indexOf("sku=")>0&&ba(c);var c;"json"===n.type&&a.headers.set("Accept","application/json");const p=(f,d,y)=>{if(l)return;if(f&&"SecurityError"!==f.message&&Ee(f),d&&y)return h(d);const m=Date.now();Z.fetch(a).then(g=>{if(g.ok){const b=u?g.clone():null;return h(g,b,m)}return i(new wa(g.statusText,g.status,n.url))}).catch(g=>{"AbortError"!==g.name&&i(new Error(`${g.message} ${n.url}`))})},h=(f,d,y)=>{("arrayBuffer"===n.type?f.arrayBuffer():"json"===n.type?f.json():f.text()).then(m=>{l||(d&&y&&function(g,b,x){if(vi(),!Ct)return;const v={status:b.status,statusText:b.statusText,headers:new Z.Headers};b.headers.forEach((A,S)=>v.headers.set(S,A));const _=Bs(b.headers.get("Cache-Control")||"");if(_["no-store"])return;_["max-age"]&&v.headers.set("Expires",new Date(x+1e3*_["max-age"]).toUTCString());const w=v.headers.get("Expires");w&&(new Date(w).getTime()-x<42e4||function(A,S){if(void 0===xi)try{new Response(new ReadableStream),xi=!0}catch{xi=!1}xi?S(A.body):A.blob().then(S)}(b,A=>{const S=new Z.Response(A,v);vi(),Ct&&Ct.then(z=>z.put(iu(g.url),S)).catch(z=>Ee(z.message))}))}(a,d,y),o=!0,i(null,m,f.headers.get("Cache-Control"),f.headers.get("Expires")))}).catch(m=>{l||i(new Error(m.message))})};return u?function(f,d){if(vi(),!Ct)return d(null);const y=iu(f.url);Ct.then(m=>{m.match(y).then(g=>{const b=function(x){if(!x)return!1;const v=new Date(x.headers.get("Expires")||0),_=Bs(x.headers.get("Cache-Control")||"");return v>Date.now()&&!_["no-cache"]}(g);m.delete(y),b&&m.put(y,g.clone()),d(null,g,b)}).catch(d)}).catch(d)}(a,p):p(null,null),{cancel:()=>{l=!0,o||s.abort()}}}(r,e);if(wr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var t;return function(n,i){const s=new Z.XMLHttpRequest;s.open(n.method||"GET",n.url,!0),"arrayBuffer"===n.type&&(s.responseType="arraybuffer");for(const a in n.headers)s.setRequestHeader(a,n.headers[a]);return"json"===n.type&&(s.responseType="text",s.setRequestHeader("Accept","application/json")),s.withCredentials="include"===n.credentials,s.onerror=()=>{i(new Error(s.statusText))},s.onload=()=>{if((s.status>=200&&s.status<300||0===s.status)&&null!==s.response){let a=s.response;if("json"===n.type)try{a=JSON.parse(s.response)}catch(o){return i(o)}i(null,a,s.getResponseHeader("Cache-Control"),s.getResponseHeader("Expires"))}else i(new wa(s.statusText,s.status,n.url))},s.send(n.body),{cancel:()=>s.abort()}}(r,e)},au=function(r,e){return bi(Re(r,{type:"arrayBuffer"}),e)},wf=function(r,e){return bi(Re(r,{method:"POST"}),e)},_f=function(r,e){return bi(Re(r,{method:"GET"}),e)},wi={};function U(r,e,t={}){Object.defineProperty(r,"_classRegistryKey",{value:e,writeable:!1}),wi[e]={klass:r,omit:t.omit||[]}}U(Object,"Object"),_r.serialize=function(r,e){const t=r.toArrayBuffer();return e&&e.push(t),{buffer:t}},_r.deserialize=function(r){return new _r(r.buffer)},Object.defineProperty(_r,"name",{value:"Grid"}),U(_r,"Grid"),U(Be,"Color"),U(Error,"Error"),U(wa,"AJAXError"),U(at,"ResolvedImage"),U(di,"StylePropertyFunction"),U(ya,"StyleExpression",{omit:["_evaluator"]}),U(ga,"ZoomDependentExpression"),U(ma,"ZoomConstantExpression"),U(Nt,"CompoundExpression",{omit:["_evaluate"]});for(const r in dn)wi[dn[r]._classRegistryKey]||U(dn[r],`Expression${r}`);function ou(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&"ArrayBuffer"===r.constructor.name)}function lu(r){return Z.ImageBitmap&&r instanceof Z.ImageBitmap}function gn(r,e){if(null==r||"boolean"==typeof r||"number"==typeof r||"string"==typeof r||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(ou(r)||lu(r))return e&&e.push(r),r;if(ArrayBuffer.isView(r)){const t=r;return e&&e.push(t.buffer),t}if(r instanceof Z.ImageData)return e&&e.push(r.data.buffer),r;if(Array.isArray(r)){const t=[];for(const n of r)t.push(gn(n,e));return t}if("object"==typeof r){const t=r.constructor,n=t._classRegistryKey;if(!n)throw new Error(`can't serialize object of unregistered class ${n}`);const i=t.serialize?t.serialize(r,e):{};if(!t.serialize){for(const s in r)r.hasOwnProperty(s)&&(wi[n].omit.indexOf(s)>=0||(i[s]=gn(r[s],e)));r instanceof Error&&(i.message=r.message)}if(i.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==n&&(i.$name=n),i}throw new Error("can't serialize object of type "+typeof r)}function xn(r){if(null==r||"boolean"==typeof r||"number"==typeof r||"string"==typeof r||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||ou(r)||lu(r)||ArrayBuffer.isView(r)||r instanceof Z.ImageData)return r;if(Array.isArray(r))return r.map(xn);if("object"==typeof r){const e=r.$name||"Object",{klass:t}=wi[e];if(!t)throw new Error(`can't deserialize unregistered class ${e}`);if(t.deserialize)return t.deserialize(r);const n=Object.create(t.prototype);for(const i of Object.keys(r))"$name"!==i&&(n[i]=xn(r[i]));return n}throw new Error("can't deserialize object of type "+typeof r)}class Sf{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}const Af=Z.performance;function uu(r){const e=r?r.url.toString():void 0;return Af.getEntriesByName(e)}class kf{constructor(){this.tasks={},this.taskQueue=[],cl(["process"],this),this.invoker=new Sf(this.process),this.nextId=0}add(e,t){const n=this.nextId++,i=function({type:s,isSymbolTile:a,zoom:o}){return o=o||0,"message"===s?0:"maybePrepare"!==s||a?"parseTile"!==s||a?"parseTile"===s&&a?300-o:"maybePrepare"===s&&a?400-o:500:200-o:100-o}(t);if(0===i){wr();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[n]={fn:e,metadata:t,priority:i,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){wr();try{if(this.taskQueue=this.taskQueue.filter(n=>!!this.tasks[n]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let i=0;i<this.taskQueue.length;i++){const s=this.tasks[this.taskQueue[i]];s.priority<t&&(t=s.priority,e=i)}if(null===e)return null;const n=this.taskQueue[e];return this.taskQueue.splice(e,1),n}remove(){this.invoker.remove()}}class If{constructor(e,t,n){this.target=e,this.parent=t,this.mapId=n,this.callbacks={},this.cancelCallbacks={},cl(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=wr()?e:Z,this.scheduler=new kf}send(e,t,n,i,s=!1,a){const o=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=a,this.callbacks[o]=n);const l=pl(this.globalScope)?void 0:[];return this.target.postMessage({id:o,type:e,hasCallback:!!n,targetMapId:i,mustQueue:s,sourceMapId:this.mapId,data:gn(t,l)},l),{cancel:()=>{n&&delete this.callbacks[o],this.target.postMessage({id:o,type:"<cancel>",targetMapId:i,sourceMapId:this.mapId})}}}receive(e){const t=e.data,n=t.id;if(n&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const i=this.cancelCallbacks[n];delete this.cancelCallbacks[n],i&&i.cancel()}else if(t.mustQueue||wr()){const i=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,t),i&&i.metadata||{type:"message"})}else this.processTask(n,t)}processTask(e,t){if("<response>"===t.type){const n=this.callbacks[e];delete this.callbacks[e],n&&(t.error?n(xn(t.error)):n(null,xn(t.data)))}else{const n=pl(this.globalScope)?void 0:[],i=t.hasCallback?(a,o)=>{delete this.cancelCallbacks[e],this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:a?gn(a):null,data:gn(o,n)},n)}:a=>{},s=xn(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,s,i);else if(this.parent.getWorkerSource){const a=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,a[0],s.source)[a[1]](s,i)}else i(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var T=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function cu(r,e,t){t[r]&&-1!==t[r].indexOf(e)||(t[r]=t[r]||[],t[r].push(e))}function _a(r,e,t){if(t&&t[r]){const n=t[r].indexOf(e);-1!==n&&t[r].splice(n,1)}}class Br{constructor(e,t={}){Re(this,t),this.type=e}}class Sa extends Br{constructor(e,t={}){super("error",Re({error:e},t))}}class _i{on(e,t){return this._listeners=this._listeners||{},cu(e,t,this._listeners),this}off(e,t){return _a(e,t,this._listeners),_a(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},cu(e,t,this._oneTimeListeners),this):new Promise(n=>this.once(e,n))}fire(e,t){"string"==typeof e&&(e=new Br(e,t||{}));const n=e.type;if(this.listens(n)){e.target=this;const i=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const o of i)o.call(this,e);const s=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const o of s)_a(n,o,this._oneTimeListeners),o.call(this,e);const a=this._eventedParent;a&&(Re(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),a.fire(e))}else e instanceof Sa&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}function Ve(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Gt(r){if(Array.isArray(r))return r.map(Gt);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const t in r)e[t]=Gt(r[t]);return e}return Ve(r)}class ${constructor(e,t,n,i){this.message=(e?`${e}: `:"")+n,i&&(this.identifier=i),null!=t&&t.__line__&&(this.line=t.__line__)}}function ht(r){const e=r.key,t=r.value,n=r.valueSpec||{},i=r.objectElementValidators||{},s=r.style,a=r.styleSpec;let o=[];const l=oe(t);if("object"!==l)return[new $(e,t,`object expected, ${l} found`)];for(const u in t){const c=u.split(".")[0];let h;i[c]?h=i[c]:n[c]?h=Ye:i["*"]?h=i["*"]:n["*"]&&(h=Ye),h?o=o.concat(h({key:(e&&`${e}.`)+u,value:t[u],valueSpec:n[c]||n["*"],style:s,styleSpec:a,object:t,objectKey:u},t)):o.push(new $(e,t[u],`unknown property "${u}"`))}for(const u in n)i[u]||n[u].required&&void 0===n[u].default&&void 0===t[u]&&o.push(new $(e,t,`missing required property "${u}"`));return o}function hu(r){const e=r.value,t=r.valueSpec,n=r.style,i=r.styleSpec,s=r.key,a=r.arrayElementValidator||Ye;if("array"!==oe(e))return[new $(s,e,`array expected, ${oe(e)} found`)];if(t.length&&e.length!==t.length)return[new $(s,e,`array length ${t.length} expected, length ${e.length} found`)];if(t["min-length"]&&e.length<t["min-length"])return[new $(s,e,`array length at least ${t["min-length"]} expected, length ${e.length} found`)];let o={type:t.value,values:t.values,minimum:t.minimum,maximum:t.maximum,function:void 0};i.$version<7&&(o.function=t.function),"object"===oe(t.value)&&(o=t.value);let l=[];for(let u=0;u<e.length;u++)l=l.concat(a({array:e,arrayIndex:u,value:e[u],valueSpec:o,style:n,styleSpec:i,key:`${s}[${u}]`}));return l}function pu(r){const e=r.key,t=r.value,n=r.valueSpec;let i=oe(t);if("number"===i&&t!=t&&(i="NaN"),"number"!==i)return[new $(e,t,`number expected, ${i} found`)];if("minimum"in n){let s=n.minimum;if("array"===oe(n.minimum)&&(s=n.minimum[r.arrayIndex]),t<s)return[new $(e,t,`${t} is less than the minimum value ${s}`)]}if("maximum"in n){let s=n.maximum;if("array"===oe(n.maximum)&&(s=n.maximum[r.arrayIndex]),t>s)return[new $(e,t,`${t} is greater than the maximum value ${s}`)]}return[]}function fu(r){const e=r.valueSpec,t=Ve(r.value.type);let n,i,s,a={};const o="categorical"!==t&&void 0===r.value.property,l=!o,u="array"===oe(r.value.stops)&&"array"===oe(r.value.stops[0])&&"object"===oe(r.value.stops[0][0]),c=ht({key:r.key,value:r.value,valueSpec:r.styleSpec.function,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(f){if("identity"===t)return[new $(f.key,f.value,'identity function may not have a "stops" property')];let d=[];const y=f.value;return d=d.concat(hu({key:f.key,value:y,valueSpec:f.valueSpec,style:f.style,styleSpec:f.styleSpec,arrayElementValidator:p})),"array"===oe(y)&&0===y.length&&d.push(new $(f.key,y,"array must have at least one stop")),d},default:function(f){return Ye({key:f.key,value:f.value,valueSpec:e,style:f.style,styleSpec:f.styleSpec})}}});return"identity"===t&&o&&c.push(new $(r.key,r.value,'missing required property "property"')),"identity"===t||r.value.stops||c.push(new $(r.key,r.value,'missing required property "stops"')),"exponential"===t&&r.valueSpec.expression&&!da(r.valueSpec)&&c.push(new $(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(l&&!Tr(r.valueSpec)?c.push(new $(r.key,r.value,"property functions not supported")):o&&!$l(r.valueSpec)&&c.push(new $(r.key,r.value,"zoom functions not supported"))),"categorical"!==t&&!u||void 0!==r.value.property||c.push(new $(r.key,r.value,'"property" property is required')),c;function p(f){let d=[];const y=f.value,m=f.key;if("array"!==oe(y))return[new $(m,y,`array expected, ${oe(y)} found`)];if(2!==y.length)return[new $(m,y,`array length 2 expected, length ${y.length} found`)];if(u){if("object"!==oe(y[0]))return[new $(m,y,`object expected, ${oe(y[0])} found`)];if(void 0===y[0].zoom)return[new $(m,y,"object stop key must have zoom")];if(void 0===y[0].value)return[new $(m,y,"object stop key must have value")];const g=Ve(y[0].zoom);if("number"!=typeof g)return[new $(m,y[0].zoom,"stop zoom values must be numbers")];if(s&&s>g)return[new $(m,y[0].zoom,"stop zoom values must appear in ascending order")];g!==s&&(s=g,i=void 0,a={}),d=d.concat(ht({key:`${m}[0]`,value:y[0],valueSpec:{zoom:{}},style:f.style,styleSpec:f.styleSpec,objectElementValidators:{zoom:pu,value:h}}))}else d=d.concat(h({key:`${m}[0]`,value:y[0],valueSpec:{},style:f.style,styleSpec:f.styleSpec},y));return fi(Gt(y[1]))?d.concat([new $(`${m}[1]`,y[1],"expressions are not allowed in function stops.")]):d.concat(Ye({key:`${m}[1]`,value:y[1],valueSpec:e,style:f.style,styleSpec:f.styleSpec}))}function h(f,d){const y=oe(f.value),m=Ve(f.value),g=null!==f.value?f.value:d;if(n){if(y!==n)return[new $(f.key,g,`${y} stop domain type must match previous stop domain type ${n}`)]}else n=y;if("number"!==y&&"string"!==y&&"boolean"!==y&&"number"!=typeof m&&"string"!=typeof m&&"boolean"!=typeof m)return[new $(f.key,g,"stop domain value must be a number, string, or boolean")];if("number"!==y&&"categorical"!==t){let b=`number expected, ${y} found`;return Tr(e)&&void 0===t&&(b+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new $(f.key,g,b)]}return"categorical"!==t||"number"!==y||"number"==typeof m&&isFinite(m)&&Math.floor(m)===m?"categorical"!==t&&"number"===y&&"number"==typeof m&&"number"==typeof i&&void 0!==i&&m<i?[new $(f.key,g,"stop domain values must appear in ascending order")]:(i=m,"categorical"===t&&m in a?[new $(f.key,g,"stop domain values must be unique")]:(a[m]=!0,[])):[new $(f.key,g,`integer expected, found ${String(m)}`)]}}function Cr(r){const e=("property"===r.expressionContext?ql:lr)(Gt(r.value),r.valueSpec);if("error"===e.result)return e.value.map(n=>new $(`${r.key}${n.key}`,r.value,n.message));const t=e.value.expression||e.value._styleExpression.expression;if("property"===r.expressionContext&&"text-font"===r.propertyKey&&!t.outputDefined())return[new $(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===r.expressionContext&&"layout"===r.propertyType&&!si(t))return[new $(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===r.expressionContext)return du(t,r);if(r.expressionContext&&0===r.expressionContext.indexOf("cluster")){if(!ai(t,["zoom","feature-state"]))return[new $(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===r.expressionContext&&!hn(t))return[new $(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function du(r,e){const t=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const i of e.valueSpec.expression.parameters)t.delete(i);if(0===t.size)return[];const n=[];return r instanceof Nt&&t.has(r.name)?[new $(e.key,e.value,`["${r.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(r.eachChild(i=>{n.push(...du(i,e))}),n)}function Si(r){const e=r.key,t=r.value,n=r.valueSpec,i=[];return Array.isArray(n.values)?-1===n.values.indexOf(Ve(t))&&i.push(new $(e,t,`expected one of [${n.values.join(", ")}], ${JSON.stringify(t)} found`)):-1===Object.keys(n.values).indexOf(Ve(t))&&i.push(new $(e,t,`expected one of [${Object.keys(n.values).join(", ")}], ${JSON.stringify(t)} found`)),i}function Aa(r){if(!0===r||!1===r)return!0;if(!Array.isArray(r)||0===r.length)return!1;switch(r[0]){case"has":return r.length>=2&&"$id"!==r[1]&&"$type"!==r[1];case"in":return r.length>=3&&("string"!=typeof r[1]||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==r.length||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!Aa(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function Ai(r,e="fill"){if(null==r)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Aa(r)||(r=ki(r));const t=r;let n=!0;try{n=function(u){if(!Pr(u))return u;let c=Gt(u);return mu(c),c=yu(c),c}(t)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(t,null,2)}\n        `)}const i=T[`filter_${e}`],s=lr(n,i);let a=null;if("error"===s.result)throw new Error(s.value.map(u=>`${u.key}: ${u.message}`).join(", "));a=(u,c,p)=>s.value.evaluate(u,c,{},p);let o=null,l=null;if(n!==t){const u=lr(t,i);if("error"===u.result)throw new Error(u.value.map(c=>`${c.key}: ${c.message}`).join(", "));o=(c,p,h,f,d)=>u.value.evaluate(c,p,{},h,void 0,void 0,f,d),l=!hn(u.value.expression)}return{filter:a,dynamicFilter:o||void 0,needGeometry:gu(n),needFeature:!!l}}function yu(r){if(!Array.isArray(r))return r;const e=function(t){if(Mf.has(t[0]))for(let n=1;n<t.length;n++)if(Pr(t[n]))return!0;return t}(r);return!0===e?e:e.map(t=>yu(t))}function mu(r){let e=!1;const t=[];if("case"===r[0]){for(let n=1;n<r.length-1;n+=2)e=e||Pr(r[n]),t.push(r[n+1]);t.push(r[r.length-1])}else if("match"===r[0]){e=e||Pr(r[1]);for(let n=2;n<r.length-1;n+=2)t.push(r[n+1]);t.push(r[r.length-1])}else if("step"===r[0]){e=e||Pr(r[1]);for(let n=1;n<r.length-1;n+=2)t.push(r[n+1])}e&&(r.length=0,r.push("any",...t));for(let n=1;n<r.length;n++)mu(r[n])}function Pr(r){if(!Array.isArray(r))return!1;if("pitch"===(e=r[0])||"distance-from-center"===e)return!0;var e;for(let t=1;t<r.length;t++)if(Pr(r[t]))return!0;return!1}const Mf=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Tf(r,e){return r<e?-1:r>e?1:0}function gu(r){if(!Array.isArray(r))return!1;if("within"===r[0])return!0;for(let e=1;e<r.length;e++)if(gu(r[e]))return!0;return!1}function ki(r){if(!r)return!0;const e=r[0];return r.length<=1?"any"!==e:"=="===e?ka(r[1],r[2],"=="):"!="===e?Ii(ka(r[1],r[2],"==")):"<"===e||">"===e||"<="===e||">="===e?ka(r[1],r[2],e):"any"===e?(t=r.slice(1),["any"].concat(t.map(ki))):"all"===e?["all"].concat(r.slice(1).map(ki)):"none"===e?["all"].concat(r.slice(1).map(ki).map(Ii)):"in"===e?xu(r[1],r.slice(2)):"!in"===e?Ii(xu(r[1],r.slice(2))):"has"===e?vu(r[1]):"!has"===e?Ii(vu(r[1])):"within"!==e||r;var t}function ka(r,e,t){switch(r){case"$type":return[`filter-type-${t}`,e];case"$id":return[`filter-id-${t}`,e];default:return[`filter-${t}`,r,e]}}function xu(r,e){if(0===e.length)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",r,["literal",e.sort(Tf)]]:["filter-in-small",r,["literal",e]]}}function vu(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Ii(r){return["!",r]}function bu(r){return Aa(Gt(r.value))?Cr(ar({},r,{expressionContext:"filter",valueSpec:r.styleSpec[`filter_${r.layerType||"fill"}`]})):wu(r)}function wu(r){const e=r.value,t=r.key;if("array"!==oe(e))return[new $(t,e,`array expected, ${oe(e)} found`)];const n=r.styleSpec;let i,s=[];if(e.length<1)return[new $(t,e,"filter array must have at least 1 element")];switch(s=s.concat(Si({key:`${t}[0]`,value:e[0],valueSpec:n.filter_operator,style:r.style,styleSpec:r.styleSpec})),Ve(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===Ve(e[1])&&s.push(new $(t,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&s.push(new $(t,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(i=oe(e[1]),"string"!==i&&s.push(new $(`${t}[1]`,e[1],`string expected, ${i} found`)));for(let a=2;a<e.length;a++)i=oe(e[a]),"$type"===Ve(e[1])?s=s.concat(Si({key:`${t}[${a}]`,value:e[a],valueSpec:n.geometry_type,style:r.style,styleSpec:r.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&s.push(new $(`${t}[${a}]`,e[a],`string, number, or boolean expected, ${i} found`));break;case"any":case"all":case"none":for(let a=1;a<e.length;a++)s=s.concat(wu({key:`${t}[${a}]`,value:e[a],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":i=oe(e[1]),2!==e.length?s.push(new $(t,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==i&&s.push(new $(`${t}[1]`,e[1],`string expected, ${i} found`));break;case"within":i=oe(e[1]),2!==e.length?s.push(new $(t,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==i&&s.push(new $(`${t}[1]`,e[1],`object expected, ${i} found`))}return s}function _u(r,e){const t=r.key,n=r.style,i=r.styleSpec,s=r.value,a=r.objectKey,o=i[`${e}_${r.layerType}`];if(!o)return[];const l=a.match(/^(.*)-transition$/);if("paint"===e&&l&&o[l[1]]&&o[l[1]].transition)return Ye({key:t,value:s,valueSpec:i.transition,style:n,styleSpec:i});const u=r.valueSpec||o[a];if(!u)return[new $(t,s,`unknown property "${a}"`)];let c;if("string"===oe(s)&&Tr(u)&&!u.tokens&&(c=/^{([^}]+)}$/.exec(s))){const h=`\`{ "type": "identity", "property": ${c?JSON.stringify(c[1]):'"_"'} }\``;return[new $(t,s,`"${a}" does not support interpolation syntax\nUse an identity property function instead: ${h}.`)]}const p=[];return"symbol"===r.layerType&&("text-field"===a&&n&&!n.glyphs&&p.push(new $(t,s,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&pi(Gt(s))&&"identity"===Ve(s.type)&&p.push(new $(t,s,'"text-font" does not support identity functions'))),p.concat(Ye({key:r.key,value:s,valueSpec:u,style:n,styleSpec:i,expressionContext:"property",propertyType:e,propertyKey:a}))}function Su(r){return _u(r,"paint")}function Au(r){return _u(r,"layout")}function Er(r){const e=r.value,t=r.key,n=oe(e);return"string"!==n?[new $(t,e,`string expected, ${n} found`)]:[]}const ku={promoteId:function({key:r,value:e}){if("string"===oe(e))return Er({key:r,value:e});{const t=[];for(const n in e)t.push(...Er({key:`${r}.${n}`,value:e[n]}));return t}}};function zf(r){return r.source.reduce((e,t)=>{const n=r[t];return"enum"===n.type.type&&(e=e.concat(Object.keys(n.type.values))),e},[])}const Iu={"*":()=>[],array:hu,boolean:function(r){const e=r.value,t=r.key,n=oe(e);return"boolean"!==n?[new $(t,e,`boolean expected, ${n} found`)]:[]},number:pu,color:function(r){const e=r.key,t=r.value,n=oe(t);return"string"!==n?[new $(e,t,`color expected, ${n} found`)]:null===Es(t)?[new $(e,t,`color expected, "${t}" found`)]:[]},enum:Si,filter:bu,function:fu,layer:function(r){let e=[];const t=r.value,n=r.key,i=r.style,s=r.styleSpec;t.type||t.ref||e.push(new $(n,t,'either "type" or "ref" is required'));let a=Ve(t.type);const o=Ve(t.ref);if(t.id){const l=Ve(t.id);for(let u=0;u<r.arrayIndex;u++){const c=i.layers[u];Ve(c.id)===l&&e.push(new $(n,t.id,`duplicate layer id "${t.id}", previously used at line ${c.id.__line__}`))}}if("ref"in t){let l;["type","source","source-layer","filter","layout"].forEach(u=>{u in t&&e.push(new $(n,t[u],`"${u}" is prohibited for ref layers`))}),i.layers.forEach(u=>{Ve(u.id)===o&&(l=u)}),l?l.ref?e.push(new $(n,t.ref,"ref cannot reference another ref layer")):a=Ve(l.type):"string"==typeof o&&e.push(new $(n,t.ref,`ref layer "${o}" not found`))}else if("background"!==a&&"sky"!==a)if(t.source){const l=i.sources&&i.sources[t.source],u=l&&Ve(l.type);l?"vector"===u&&"raster"===a?e.push(new $(n,t.source,`layer "${t.id}" requires a raster source`)):"raster"===u&&"raster"!==a?e.push(new $(n,t.source,`layer "${t.id}" requires a vector source`)):"vector"!==u||t["source-layer"]?"raster-dem"===u&&"hillshade"!==a?e.push(new $(n,t.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==a||!t.paint||!t.paint["line-gradient"]&&!t.paint["line-trim-offset"]||"geojson"===u&&l.lineMetrics||e.push(new $(n,t,`layer "${t.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new $(n,t,`layer "${t.id}" must specify a "source-layer"`)):e.push(new $(n,t.source,`source "${t.source}" not found`))}else e.push(new $(n,t,'missing required property "source"'));return e=e.concat(ht({key:n,value:t,valueSpec:s.layer,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Ye({key:`${n}.type`,value:t.type,valueSpec:s.layer.type,style:r.style,styleSpec:r.styleSpec,object:t,objectKey:"type"}),filter:l=>bu(ar({layerType:a},l)),layout:l=>ht({layer:t,key:l.key,value:l.value,valueSpec:{},style:l.style,styleSpec:l.styleSpec,objectElementValidators:{"*":u=>Au(ar({layerType:a},u))}}),paint:l=>ht({layer:t,key:l.key,value:l.value,valueSpec:{},style:l.style,styleSpec:l.styleSpec,objectElementValidators:{"*":u=>Su(ar({layerType:a},u))}})}})),e},object:ht,source:function(r){const e=r.value,t=r.key,n=r.styleSpec,i=r.style;if(!e.type)return[new $(t,e,'"type" is required')];const s=Ve(e.type);let a;switch(s){case"vector":case"raster":case"raster-dem":return a=ht({key:t,value:e,valueSpec:n[`source_${s.replace("-","_")}`],style:r.style,styleSpec:n,objectElementValidators:ku}),a;case"geojson":if(a=ht({key:t,value:e,valueSpec:n.source_geojson,style:i,styleSpec:n,objectElementValidators:ku}),e.cluster)for(const o in e.clusterProperties){const[l,u]=e.clusterProperties[o],c="string"==typeof l?[l,["accumulated"],["get",o]]:l;a.push(...Cr({key:`${t}.${o}.map`,value:u,expressionContext:"cluster-map"})),a.push(...Cr({key:`${t}.${o}.reduce`,value:c,expressionContext:"cluster-reduce"}))}return a;case"video":return ht({key:t,value:e,valueSpec:n.source_video,style:i,styleSpec:n});case"image":return ht({key:t,value:e,valueSpec:n.source_image,style:i,styleSpec:n});case"canvas":return[new $(t,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Si({key:`${t}.type`,value:e.type,valueSpec:{values:zf(n)},style:i,styleSpec:n})}},light:function(r){const e=r.value,t=r.styleSpec,n=t.light,i=r.style;let s=[];const a=oe(e);if(void 0===e)return s;if("object"!==a)return s=s.concat([new $("light",e,`object expected, ${a} found`)]),s;for(const o in e){const l=o.match(/^(.*)-transition$/);s=s.concat(l&&n[l[1]]&&n[l[1]].transition?Ye({key:o,value:e[o],valueSpec:t.transition,style:i,styleSpec:t}):n[o]?Ye({key:o,value:e[o],valueSpec:n[o],style:i,styleSpec:t}):[new $(o,e[o],`unknown property "${o}"`)])}return s},terrain:function(r){const e=r.value,t=r.key,n=r.style,i=r.styleSpec,s=i.terrain;let a=[];const o=oe(e);if(void 0===e)return a;if("object"!==o)return a=a.concat([new $("terrain",e,`object expected, ${o} found`)]),a;for(const l in e){const u=l.match(/^(.*)-transition$/);a=a.concat(u&&s[u[1]]&&s[u[1]].transition?Ye({key:l,value:e[l],valueSpec:i.transition,style:n,styleSpec:i}):s[l]?Ye({key:l,value:e[l],valueSpec:s[l],style:n,styleSpec:i}):[new $(l,e[l],`unknown property "${l}"`)])}if(e.source){const l=n.sources&&n.sources[e.source],u=l&&Ve(l.type);l?"raster-dem"!==u&&a.push(new $(t,e.source,`terrain cannot be used with a source of type ${String(u)}, it only be used with a "raster-dem" source type`)):a.push(new $(t,e.source,`source "${e.source}" not found`))}else a.push(new $(t,e,'terrain is missing required property "source"'));return a},fog:function(r){const e=r.value,t=r.style,n=r.styleSpec,i=n.fog;let s=[];const a=oe(e);if(void 0===e)return s;if("object"!==a)return s=s.concat([new $("fog",e,`object expected, ${a} found`)]),s;for(const o in e){const l=o.match(/^(.*)-transition$/);s=s.concat(l&&i[l[1]]&&i[l[1]].transition?Ye({key:o,value:e[o],valueSpec:n.transition,style:t,styleSpec:n}):i[o]?Ye({key:o,value:e[o],valueSpec:i[o],style:t,styleSpec:n}):[new $(o,e[o],`unknown property "${o}"`)])}return s},string:Er,formatted:function(r){return 0===Er(r).length?[]:Cr(r)},resolvedImage:function(r){return 0===Er(r).length?[]:Cr(r)},projection:function(r){const e=r.value,t=r.styleSpec,n=t.projection,i=r.style;let s=[];const a=oe(e);if("object"===a)for(const o in e)s=s.concat(Ye({key:o,value:e[o],valueSpec:n[o],style:i,styleSpec:t}));else"string"!==a&&(s=s.concat([new $("projection",e,`object or string expected, ${a} found`)]));return s}};function Ye(r){const e=r.value,t=r.valueSpec,n=r.styleSpec;return t.expression&&pi(Ve(e))?fu(r):t.expression&&fi(Gt(e))?Cr(r):t.type&&Iu[t.type]?Iu[t.type](r):ht(ar({},r,{valueSpec:t.type?n[t.type]:t}))}function Bf(r){const e=r.value,t=r.key,n=Er(r);return n.length||(-1===e.indexOf("{fontstack}")&&n.push(new $(t,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&n.push(new $(t,e,'"glyphs" url must include a "{range}" token'))),n}function Cf(r,e=T){return Ia(Ye({key:"",value:r,valueSpec:e.$root,styleSpec:e,style:r,objectElementValidators:{glyphs:Bf,"*":()=>[]}}))}const Pf=r=>Ia(Su(r)),Ef=r=>Ia(Au(r));function Ia(r){return r.slice().sort((e,t)=>e.line&&t.line?e.line-t.line:0)}const Mu=r=>r>=1536&&r<=1791,Tu=r=>r>=1872&&r<=1919,zu=r=>r>=2208&&r<=2303,Bu=r=>r>=11904&&r<=12031,Cu=r=>r>=12032&&r<=12255,Pu=r=>r>=12272&&r<=12287,Ma=r=>r>=12288&&r<=12351,Eu=r=>r>=12352&&r<=12447,Ta=r=>r>=12448&&r<=12543,Du=r=>r>=12544&&r<=12591,Vu=r=>r>=12704&&r<=12735,Lu=r=>r>=12736&&r<=12783,Fu=r=>r>=12784&&r<=12799,Ru=r=>r>=12800&&r<=13055,ju=r=>r>=13056&&r<=13311,$u=r=>r>=13312&&r<=19903,Ou=r=>r>=19968&&r<=40959,Uu=r=>r>=40960&&r<=42127,qu=r=>r>=42128&&r<=42191,Nu=r=>r>=63744&&r<=64255,za=r=>r>=64336&&r<=65023,Zu=r=>r>=65040&&r<=65055,Ba=r=>r>=65072&&r<=65103,Gu=r=>r>=65104&&r<=65135,Ca=r=>r>=65136&&r<=65279,Pa=r=>r>=65280&&r<=65519;function Ea(r){for(const e of r)if(Da(e.charCodeAt(0)))return!0;return!1}function Df(r){for(const e of r)if(!Vf(e.charCodeAt(0)))return!1;return!0}function Vf(r){return!(Mu(r)||Tu(r)||zu(r)||za(r)||Ca(r))}function Da(r){return!(746!==r&&747!==r&&(r<4352||!(Vu(r)||Du(r)||Ba(r)&&!(r>=65097&&r<=65103)||Nu(r)||ju(r)||Bu(r)||Lu(r)||!(!Ma(r)||r>=12296&&r<=12305||r>=12308&&r<=12319||12336===r)||$u(r)||Ou(r)||Ru(r)||(e=r,e>=12592&&e<=12687)||(e=>e>=43360&&e<=43391)(r)||(e=>e>=55216&&e<=55295)(r)||(e=>e>=4352&&e<=4607)(r)||(e=>e>=44032&&e<=55215)(r)||Eu(r)||Pu(r)||(e=>e>=12688&&e<=12703)(r)||Cu(r)||Fu(r)||Ta(r)&&12540!==r||!(!Pa(r)||65288===r||65289===r||65293===r||r>=65306&&r<=65310||65339===r||65341===r||65343===r||r>=65371&&r<=65503||65507===r||r>=65512&&r<=65519)||!(!Gu(r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||(e=>e>=5120&&e<=5759)(r)||(e=>e>=6320&&e<=6399)(r)||Zu(r)||(e=>e>=19904&&e<=19967)(r)||Uu(r)||qu(r))));var e}function Xu(r){return!(Da(r)||(e=r,(t=e)>=128&&t<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(t=>t>=8192&&t<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(t=>t>=8448&&t<=8527)(e)||(t=>t>=8528&&t<=8591)(e)||(t=>t>=8960&&t<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(t=>t>=9216&&t<=9279)(e)&&9251!==e||(t=>t>=9280&&t<=9311)(e)||(t=>t>=9312&&t<=9471)(e)||(t=>t>=9632&&t<=9727)(e)||(t=>t>=9728&&t<=9983)(e)&&!(e>=9754&&e<=9759)||(t=>t>=11008&&t<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ma(e)||Ta(e)||(t=>t>=57344&&t<=63743)(e)||Ba(e)||Gu(e)||Pa(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,t}function Yu(r){return r>=1424&&r<=2303||za(r)||Ca(r)}function Lf(r,e){return!(!e&&Yu(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||(t=r,t>=6016&&t<=6143));var t}function Ff(r){for(const e of r)if(Yu(e.charCodeAt(0)))return!0;return!1}let Mi,Va,Ti,ur;const Dr={now:()=>void 0!==Ti?Ti:Z.performance.now(),setNow(r){Ti=r},restoreNow(){Ti=void 0},frame(r){const e=Z.requestAnimationFrame(r);return{cancel:()=>Z.cancelAnimationFrame(e)}},getImageData(r,e=0){const{width:t,height:n}=r;ur||(ur=Z.document.createElement("canvas"));const i=ur.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return(t>ur.width||n>ur.height)&&(ur.width=t,ur.height=n),i.clearRect(-e,-e,t+2*e,n+2*e),i.drawImage(r,0,0,t,n),i.getImageData(-e,-e,t+2*e,n+2*e)},resolveURL:r=>(Mi||(Mi=Z.document.createElement("a")),Mi.href=r,Mi.href),get devicePixelRatio(){return Z.devicePixelRatio},get prefersReducedMotion(){return!!Z.matchMedia&&(null==Va&&(Va=Z.matchMedia("(prefers-reduced-motion: reduce)")),Va.matches)}},Ku="loading";let Pt="unavailable",Vr=null;function Wu(){Rf.fire(new Br("pluginStateChange",{pluginStatus:Pt,pluginURL:Vr}))}const Rf=new _i,Hu=function(){return Pt},jf=function(){if("deferred"!==Pt||!Vr)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Pt=Ku,Wu(),Vr&&au({url:Vr},r=>{var e;r?(e=r)&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(Pt="error"):(Pt="loaded",Wu())})},Le={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>"loaded"===Pt||null!=Le.applyArabicShaping,isLoading:()=>Pt===Ku,setState(r){Pt=r.pluginStatus,Vr=r.pluginURL},isParsed:()=>null!=Le.applyArabicShaping&&null!=Le.processBidirectionalText&&null!=Le.processStyledBidirectionalText,getPluginURL:()=>Vr};class Se{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.transition=t.transition,this.pitch=t.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(t,n){for(const i of t)if(!Lf(i.charCodeAt(0),n))return!1;return!0}(e,Le.isLoaded())}}class zi{constructor(e,t){this.property=e,this.value=t,this.expression=function(n,i){if(pi(n))return new di(n,i);if(fi(n)){const s=ql(n,i);if("error"===s.result)throw new Error(s.value.map(a=>`${a.key}: ${a.message}`).join(", "));return s.value}{let s=n;return"string"==typeof n&&"color"===i.type&&(s=Be.parse(n)),{kind:"constant",evaluate:()=>s}}}(void 0===t?e.specification.default:t,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,n){return this.property.possiblyEvaluate(this,e,t,n)}}class La{constructor(e){this.property=e,this.value=new zi(e,void 0)}transitioned(e,t){return new Qu(this.property,this.value,t,Re({},e.transition,this.transition),e.now)}untransitioned(){return new Qu(this.property,this.value,null,{},0)}}class $f{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Ut(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new La(this._values[e].property)),this._values[e].value=new zi(this._values[e].property,null===t?void 0:Ut(t))}getTransition(e){return Ut(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new La(this._values[e].property)),this._values[e].transition=Ut(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);void 0!==n&&(e[t]=n);const i=this.getTransition(t);void 0!==i&&(e[`${t}-transition`]=i)}return e}transitioned(e,t){const n=new ec(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].transitioned(e,t._values[i]);return n}untransitioned(){const e=new ec(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}}class Qu{constructor(e,t,n,i,s){const a=i.delay||0,o=i.duration||0;s=s||0,this.property=e,this.value=t,this.begin=s+a,this.end=this.begin+o,e.specification.transition&&(i.delay||i.duration)&&(this.prior=n)}possiblyEvaluate(e,t,n){const i=e.now||0,s=this.value.possiblyEvaluate(e,t,n),a=this.prior;if(a){if(i>this.end)return this.prior=null,s;if(this.value.isDataDriven())return this.prior=null,s;if(i<this.begin)return a.possiblyEvaluate(e,t,n);{const o=(i-this.begin)/(this.end-this.begin);return this.property.interpolate(a.possiblyEvaluate(e,t,n),s,function(l){if(l<=0)return 0;if(l>=1)return 1;const u=l*l,c=u*l;return 4*(l<.5?c:3*(l-u)+c-.75)}(o))}}return s}}class ec{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,n){const i=new Bi(this._properties);for(const s of Object.keys(this._values))i._values[s]=this._values[s].possiblyEvaluate(e,t,n);return i}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Of{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Ut(this._values[e].value)}setValue(e,t){this._values[e]=new zi(this._values[e].property,null===t?void 0:Ut(t))}serialize(){const e={};for(const t of Object.keys(this._values)){const n=this.getValue(t);void 0!==n&&(e[t]=n)}return e}possiblyEvaluate(e,t,n){const i=new Bi(this._properties);for(const s of Object.keys(this._values))i._values[s]=this._values[s].possiblyEvaluate(e,t,n);return i}}class Lr{constructor(e,t,n){this.property=e,this.value=t,this.parameters=n}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,n,i){return this.property.evaluate(this.value,this.parameters,e,t,n,i)}}class Bi{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class q{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,n){const i=li[this.specification.type];return i?i(e,t,n):e}}class X{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,n,i){return new Lr(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},n,i)}:e.expression,t)}interpolate(e,t,n){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new Lr(this,{kind:"constant",value:void 0},e.parameters);const i=li[this.specification.type];return i?new Lr(this,{kind:"constant",value:i(e.value.value,t.value.value,n)},e.parameters):e}evaluate(e,t,n,i,s,a){return"constant"===e.kind?e.value:e.evaluate(t,n,i,s,a)}}class Ci{constructor(e){this.specification=e}possiblyEvaluate(e,t,n,i){return!!e.expression.evaluate(t,null,{},n,i)}interpolate(){return!1}}class We{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new Se(0,{});for(const n in e){const i=e[n];i.specification.overridable&&this.overridableProperties.push(n);const s=this.defaultPropertyValues[n]=new zi(i,void 0),a=this.defaultTransitionablePropertyValues[n]=new La(i);this.defaultTransitioningPropertyValues[n]=a.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=s.possiblyEvaluate(t)}}}function tc(r,e){return 256*(r=ue(Math.floor(r),0,255))+ue(Math.floor(e),0,255)}U(X,"DataDrivenProperty"),U(q,"DataConstantProperty"),U(Ci,"ColorRampProperty");const Uf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Pi{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ae{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function be(r,e=1){let t=0,n=0;return{members:r.map(i=>{const s=Uf[i.type].BYTES_PER_ELEMENT,a=t=rc(t,Math.max(e,s)),o=i.components||1;return n=Math.max(n,s),t+=s*o,{name:i.name,type:i.type,components:o,offset:a}}),size:rc(t,Math.max(n,e)),alignment:e}}function rc(r,e){return Math.ceil(r/e)*e}class Xt extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.int16[i+0]=t,this.int16[i+1]=n,e}}Xt.prototype.bytesPerElement=4,U(Xt,"StructArrayLayout2i4");class Ei extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const s=3*e;return this.int16[s+0]=t,this.int16[s+1]=n,this.int16[s+2]=i,e}}Ei.prototype.bytesPerElement=6,U(Ei,"StructArrayLayout3i6");class vn extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i)}emplace(e,t,n,i,s){const a=4*e;return this.int16[a+0]=t,this.int16[a+1]=n,this.int16[a+2]=i,this.int16[a+3]=s,e}}vn.prototype.bytesPerElement=8,U(vn,"StructArrayLayout4i8");class Fa extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s,a,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,n,i,s,a,o)}emplace(e,t,n,i,s,a,o,l){const u=6*e,c=12*e,p=3*e;return this.int16[u+0]=t,this.int16[u+1]=n,this.uint8[c+4]=i,this.uint8[c+5]=s,this.uint8[c+6]=a,this.uint8[c+7]=o,this.float32[p+2]=l,e}}Fa.prototype.bytesPerElement=12,U(Fa,"StructArrayLayout2i4ub1f12");class bn extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i)}emplace(e,t,n,i,s){const a=4*e;return this.float32[a+0]=t,this.float32[a+1]=n,this.float32[a+2]=i,this.float32[a+3]=s,e}}bn.prototype.bytesPerElement=16,U(bn,"StructArrayLayout4f16");class Yt extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,s)}emplace(e,t,n,i,s,a){const o=6*e,l=3*e;return this.uint16[o+0]=t,this.uint16[o+1]=n,this.uint16[o+2]=i,this.uint16[o+3]=s,this.float32[l+2]=a,e}}Yt.prototype.bytesPerElement=12,U(Yt,"StructArrayLayout4ui1f12");class Di extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i)}emplace(e,t,n,i,s){const a=4*e;return this.uint16[a+0]=t,this.uint16[a+1]=n,this.uint16[a+2]=i,this.uint16[a+3]=s,e}}Di.prototype.bytesPerElement=8,U(Di,"StructArrayLayout4ui8");class Vi extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,s,a)}emplace(e,t,n,i,s,a,o){const l=6*e;return this.int16[l+0]=t,this.int16[l+1]=n,this.int16[l+2]=i,this.int16[l+3]=s,this.int16[l+4]=a,this.int16[l+5]=o,e}}Vi.prototype.bytesPerElement=12,U(Vi,"StructArrayLayout6i12");class Ra extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s,a,o,l,u,c,p,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,t,n,i,s,a,o,l,u,c,p,h)}emplace(e,t,n,i,s,a,o,l,u,c,p,h,f){const d=12*e;return this.int16[d+0]=t,this.int16[d+1]=n,this.int16[d+2]=i,this.int16[d+3]=s,this.uint16[d+4]=a,this.uint16[d+5]=o,this.uint16[d+6]=l,this.uint16[d+7]=u,this.int16[d+8]=c,this.int16[d+9]=p,this.int16[d+10]=h,this.int16[d+11]=f,e}}Ra.prototype.bytesPerElement=24,U(Ra,"StructArrayLayout4i4ui4i24");class ja extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s,a){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,i,s,a)}emplace(e,t,n,i,s,a,o){const l=10*e,u=5*e;return this.int16[l+0]=t,this.int16[l+1]=n,this.int16[l+2]=i,this.float32[u+2]=s,this.float32[u+3]=a,this.float32[u+4]=o,e}}ja.prototype.bytesPerElement=20,U(ja,"StructArrayLayout3i3f20");class $a extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}$a.prototype.bytesPerElement=4,U($a,"StructArrayLayout1ul4");class Oa extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s,a,o,l,u,c,p,h,f){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,n,i,s,a,o,l,u,c,p,h,f)}emplace(e,t,n,i,s,a,o,l,u,c,p,h,f,d){const y=20*e,m=10*e;return this.int16[y+0]=t,this.int16[y+1]=n,this.int16[y+2]=i,this.int16[y+3]=s,this.int16[y+4]=a,this.float32[m+3]=o,this.float32[m+4]=l,this.float32[m+5]=u,this.float32[m+6]=c,this.int16[y+14]=p,this.uint32[m+8]=h,this.uint16[y+18]=f,this.uint16[y+19]=d,e}}Oa.prototype.bytesPerElement=40,U(Oa,"StructArrayLayout5i4f1i1ul2ui40");class Li extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s,a,o){const l=this.length;return this.resize(l+1),this.emplace(l,e,t,n,i,s,a,o)}emplace(e,t,n,i,s,a,o,l){const u=8*e;return this.int16[u+0]=t,this.int16[u+1]=n,this.int16[u+2]=i,this.int16[u+4]=s,this.int16[u+5]=a,this.int16[u+6]=o,this.int16[u+7]=l,e}}Li.prototype.bytesPerElement=16,U(Li,"StructArrayLayout3i2i2i16");class nc extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,s)}emplace(e,t,n,i,s,a){const o=4*e,l=8*e;return this.float32[o+0]=t,this.float32[o+1]=n,this.float32[o+2]=i,this.int16[l+6]=s,this.int16[l+7]=a,e}}nc.prototype.bytesPerElement=16,U(nc,"StructArrayLayout2f1f2i16");class Ua extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i)}emplace(e,t,n,i,s){const a=12*e,o=3*e;return this.uint8[a+0]=t,this.uint8[a+1]=n,this.float32[o+1]=i,this.float32[o+2]=s,e}}Ua.prototype.bytesPerElement=12,U(Ua,"StructArrayLayout2ub2f12");class qa extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const s=3*e;return this.float32[s+0]=t,this.float32[s+1]=n,this.float32[s+2]=i,e}}qa.prototype.bytesPerElement=12,U(qa,"StructArrayLayout3f12");class At extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,n)}emplace(e,t,n,i){const s=3*e;return this.uint16[s+0]=t,this.uint16[s+1]=n,this.uint16[s+2]=i,e}}At.prototype.bytesPerElement=6,U(At,"StructArrayLayout3ui6");class Na extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s,a,o,l,u,c,p,h,f,d,y,m,g,b,x,v,_){const w=this.length;return this.resize(w+1),this.emplace(w,e,t,n,i,s,a,o,l,u,c,p,h,f,d,y,m,g,b,x,v,_)}emplace(e,t,n,i,s,a,o,l,u,c,p,h,f,d,y,m,g,b,x,v,_,w){const A=30*e,S=15*e,z=60*e;return this.int16[A+0]=t,this.int16[A+1]=n,this.int16[A+2]=i,this.float32[S+2]=s,this.float32[S+3]=a,this.uint16[A+8]=o,this.uint16[A+9]=l,this.uint32[S+5]=u,this.uint32[S+6]=c,this.uint32[S+7]=p,this.uint16[A+16]=h,this.uint16[A+17]=f,this.uint16[A+18]=d,this.float32[S+10]=y,this.float32[S+11]=m,this.uint8[z+48]=g,this.uint8[z+49]=b,this.uint8[z+50]=x,this.uint32[S+13]=v,this.int16[A+28]=_,this.uint8[z+58]=w,e}}Na.prototype.bytesPerElement=60,U(Na,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Za extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s,a,o,l,u,c,p,h,f,d,y,m,g,b,x,v,_,w,A,S,z,P,k,M,B,C){const D=this.length;return this.resize(D+1),this.emplace(D,e,t,n,i,s,a,o,l,u,c,p,h,f,d,y,m,g,b,x,v,_,w,A,S,z,P,k,M,B,C)}emplace(e,t,n,i,s,a,o,l,u,c,p,h,f,d,y,m,g,b,x,v,_,w,A,S,z,P,k,M,B,C,D){const I=38*e,F=19*e;return this.int16[I+0]=t,this.int16[I+1]=n,this.int16[I+2]=i,this.float32[F+2]=s,this.float32[F+3]=a,this.int16[I+8]=o,this.int16[I+9]=l,this.int16[I+10]=u,this.int16[I+11]=c,this.int16[I+12]=p,this.int16[I+13]=h,this.uint16[I+14]=f,this.uint16[I+15]=d,this.uint16[I+16]=y,this.uint16[I+17]=m,this.uint16[I+18]=g,this.uint16[I+19]=b,this.uint16[I+20]=x,this.uint16[I+21]=v,this.uint16[I+22]=_,this.uint16[I+23]=w,this.uint16[I+24]=A,this.uint16[I+25]=S,this.uint16[I+26]=z,this.uint16[I+27]=P,this.uint16[I+28]=k,this.uint32[F+15]=M,this.float32[F+16]=B,this.float32[F+17]=C,this.float32[F+18]=D,e}}Za.prototype.bytesPerElement=76,U(Za,"StructArrayLayout3i2f6i15ui1ul3f76");class Fi extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}Fi.prototype.bytesPerElement=4,U(Fi,"StructArrayLayout1f4");class ic extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,n,i,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,i,s)}emplace(e,t,n,i,s,a){const o=5*e;return this.float32[o+0]=t,this.float32[o+1]=n,this.float32[o+2]=i,this.float32[o+3]=s,this.float32[o+4]=a,e}}ic.prototype.bytesPerElement=20,U(ic,"StructArrayLayout5f20");class Ga extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,n,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,i)}emplace(e,t,n,i,s){const a=6*e;return this.uint32[3*e+0]=t,this.uint16[a+2]=n,this.uint16[a+3]=i,this.uint16[a+4]=s,e}}Ga.prototype.bytesPerElement=12,U(Ga,"StructArrayLayout1ul3ui12");class Fr extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.uint16[i+0]=t,this.uint16[i+1]=n,e}}Fr.prototype.bytesPerElement=4,U(Fr,"StructArrayLayout2ui4");class Ri extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}Ri.prototype.bytesPerElement=2,U(Ri,"StructArrayLayout1ui2");class ji extends Ae{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const n=this.length;return this.resize(n+1),this.emplace(n,e,t)}emplace(e,t,n){const i=2*e;return this.float32[i+0]=t,this.float32[i+1]=n,e}}ji.prototype.bytesPerElement=8,U(ji,"StructArrayLayout2f8");class sc extends Pi{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}sc.prototype.size=40;class Xa extends Oa{get(e){return new sc(this,e)}}U(Xa,"CollisionBoxArray");class ac extends Pi{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}ac.prototype.size=60;class oc extends Na{get(e){return new ac(this,e)}}U(oc,"PlacedSymbolArray");class lc extends Pi{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}lc.prototype.size=76;class uc extends Za{get(e){return new lc(this,e)}}U(uc,"SymbolInstanceArray");class cc extends Fi{getoffsetX(e){return this.float32[1*e+0]}}U(cc,"GlyphOffsetArray");class hc extends Xt{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}U(hc,"SymbolLineVertexArray");class pc extends Pi{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}pc.prototype.size=12;class fc extends Ga{get(e){return new pc(this,e)}}U(fc,"FeatureIndexArray");class dc extends Fr{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}U(dc,"FillExtrusionCentroidArray");const qf=be([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Nf=be([{name:"a_dash",components:4,type:"Uint16"}]);var cr={},Zf={get exports(){return cr},set exports(r){cr=r}},Ya={};({get exports(){return Ya},set exports(r){Ya=r}}).exports=function(r,e){var t,n,i,s,a,o,l,u;for(n=r.length-(t=3&r.length),i=e,a=3432918353,o=461845907,u=0;u<n;)l=255&r.charCodeAt(u)|(255&r.charCodeAt(++u))<<8|(255&r.charCodeAt(++u))<<16|(255&r.charCodeAt(++u))<<24,++u,i=27492+(65535&(s=5*(65535&(i=(i^=l=(65535&(l=(l=(65535&l)*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(s>>>16)&65535)<<16);switch(l=0,t){case 3:l^=(255&r.charCodeAt(u+2))<<16;case 2:l^=(255&r.charCodeAt(u+1))<<8;case 1:i^=l=(65535&(l=(l=(65535&(l^=255&r.charCodeAt(u)))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*o+(((l>>>16)*o&65535)<<16)&4294967295}return i^=r.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0};var Ka={};({get exports(){return Ka},set exports(r){Ka=r}}).exports=function(r,e){for(var t,n=r.length,i=e^n,s=0;n>=4;)t=1540483477*(65535&(t=255&r.charCodeAt(s)|(255&r.charCodeAt(++s))<<8|(255&r.charCodeAt(++s))<<16|(255&r.charCodeAt(++s))<<24))+((1540483477*(t>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(t=1540483477*(65535&(t^=t>>>24))+((1540483477*(t>>>16)&65535)<<16)),n-=4,++s;switch(n){case 3:i^=(255&r.charCodeAt(s+2))<<16;case 2:i^=(255&r.charCodeAt(s+1))<<8;case 1:i=1540483477*(65535&(i^=255&r.charCodeAt(s)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0};var yc=Ya,Gf=Ka;Zf.exports=yc,cr.murmur3=yc,cr.murmur2=Gf;class $i{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,t,n,i){this.ids.push(mc(e)),this.positions.push(t,n,i)}getPositions(e){const t=mc(e);let n=0,i=this.ids.length-1;for(;n<i;){const a=n+i>>1;this.ids[a]>=t?i=a:n=a+1}const s=[];for(;this.ids[n]===t;)s.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return s}static serialize(e,t){const n=new Float64Array(e.ids),i=new Uint32Array(e.positions);return Ja(n,i,0,n.length-1),t&&t.push(n.buffer,i.buffer),{ids:n,positions:i}}static deserialize(e){const t=new $i;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t}}function mc(r){const e=+r;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:cr(String(r))}function Ja(r,e,t,n){for(;t<n;){const i=r[t+n>>1];let s=t-1,a=n+1;for(;;){do{s++}while(r[s]<i);do{a--}while(r[a]>i);if(s>=a)break;Oi(r,s,a),Oi(e,3*s,3*a),Oi(e,3*s+1,3*a+1),Oi(e,3*s+2,3*a+2)}a-t<n-a?(Ja(r,e,t,a),t=a+1):(Ja(r,e,a+1,n),n=a)}}function Oi(r,e,t){const n=r[e];r[e]=r[t],r[t]=n}U($i,"FeaturePositionMap");class Wa{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}}class Ha extends Wa{constructor(e){super(e),this.current=0}set(e,t,n){this.fetchUniformLocation(e,t)&&this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class Xf extends Wa{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,n){this.fetchUniformLocation(e,t)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3])))}}class Yf extends Wa{constructor(e){super(e),this.current=Be.transparent}set(e,t,n){this.fetchUniformLocation(e,t)&&(n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a)))}}function Qa(r){return[tc(255*r.r,255*r.g),tc(255*r.b,255*r.a)]}class wn{constructor(e,t,n){this.value=e,this.uniformNames=t.map(i=>`u_${i}`),this.type=n}setUniform(e,t,n,i,s){t.set(e,s,i.constantOr(this.value))}getBinding(e,t){return"color"===this.type?new Yf(e):new Ha(e)}}class Rr{constructor(e,t){this.uniformNames=t.map(n=>`u_${n}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,t,n,i,s){const a="u_pattern"===s||"u_dash"===s?this.pattern:"u_pixel_ratio"===s?this.pixelRatio:null;a&&t.set(e,s,a)}getBinding(e,t){return"u_pattern"===t||"u_dash"===t?new Xf(e):new Ha(e)}}class Et{constructor(e,t,n,i){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=t.map(s=>({name:`a_${s}`,type:"Float32",components:"color"===n?2:1,offset:0})),this.paintVertexArray=new i}populatePaintArray(e,t,n,i,s,a){const o=this.paintVertexArray.length,l=this.expression.evaluate(new Se(0),t,{},s,i,a);this.paintVertexArray.resize(e),this._setPaintValue(o,e,l)}updatePaintArray(e,t,n,i,s){const a=this.expression.evaluate({zoom:0},n,i,void 0,s);this._setPaintValue(e,t,a)}_setPaintValue(e,t,n){if("color"===this.type){const i=Qa(n);for(let s=e;s<t;s++)this.paintVertexArray.emplace(s,i[0],i[1])}else{for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class pt{constructor(e,t,n,i,s,a){this.expression=e,this.uniformNames=t.map(o=>`u_${o}_t`),this.type=n,this.useIntegerZoom=i,this.zoom=s,this.maxValue=0,this.paintVertexAttributes=t.map(o=>({name:`a_${o}`,type:"Float32",components:"color"===n?4:2,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,t,n,i,s,a){const o=this.expression.evaluate(new Se(this.zoom),t,{},s,i,a),l=this.expression.evaluate(new Se(this.zoom+1),t,{},s,i,a),u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(u,e,o,l)}updatePaintArray(e,t,n,i,s){const a=this.expression.evaluate({zoom:this.zoom},n,i,void 0,s),o=this.expression.evaluate({zoom:this.zoom+1},n,i,void 0,s);this._setPaintValue(e,t,a,o)}_setPaintValue(e,t,n,i){if("color"===this.type){const s=Qa(n),a=Qa(i);for(let o=e;o<t;o++)this.paintVertexArray.emplace(o,s[0],s[1],a[0],a[1])}else{for(let s=e;s<t;s++)this.paintVertexArray.emplace(s,n,i);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,n,i,s){const a=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,o=ue(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(e,s,o)}getBinding(e,t){return new Ha(e)}}class Kt{constructor(e,t,n,i,s){this.expression=e,this.layerId=s,this.paintVertexAttributes=("array"===n?Nf:qf).members;for(let a=0;a<t.length;++a);this.paintVertexArray=new i}populatePaintArray(e,t,n){const i=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(i,e,t.patterns&&t.patterns[this.layerId],n)}updatePaintArray(e,t,n,i,s,a){this._setPaintValues(e,t,n.patterns&&n.patterns[this.layerId],a)}_setPaintValues(e,t,n,i){if(!i||!n)return;const s=i[n];if(!s)return;const{tl:a,br:o,pixelRatio:l}=s;for(let u=e;u<t;u++)this.paintVertexArray.emplace(u,a[0],a[1],o[0],o[1],l)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Jt{constructor(e,t,n=(()=>!0)){this.binders={},this._buffers=[];const i=[];for(const s in e.paint._values){if(!n(s))continue;const a=e.paint.get(s);if(!(a instanceof Lr&&Tr(a.property.specification)))continue;const o=Jf(s,e.type),l=a.value,u=a.property.specification.type,c=!!a.property.useIntegerZoom,p="line-dasharray"===s||s.endsWith("pattern"),h="line-dasharray"===s&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==l.kind||h)if("source"===l.kind||h||p){const f=gc(s,u,"source");this.binders[s]=p?new Kt(l,o,u,f,e.id):new Et(l,o,u,f),i.push(`/a_${s}`)}else{const f=gc(s,u,"composite");this.binders[s]=new pt(l,o,u,c,t,f),i.push(`/z_${s}`)}else this.binders[s]=p?new Rr(l.value,o):new wn(l.value,o,u),i.push(`/u_${s}`)}this.cacheKey=i.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof Et||t instanceof pt?t.maxValue:0}populatePaintArrays(e,t,n,i,s,a){for(const o in this.binders){const l=this.binders[o];(l instanceof Et||l instanceof pt||l instanceof Kt)&&l.populatePaintArray(e,t,n,i,s,a)}}setConstantPatternPositions(e){for(const t in this.binders){const n=this.binders[t];n instanceof Rr&&n.setConstantPatternPositions(e)}}updatePaintArrays(e,t,n,i,s,a){let o=!1;for(const l in e){const u=t.getPositions(l);for(const c of u){const p=n.feature(c.index);for(const h in this.binders){const f=this.binders[h];if((f instanceof Et||f instanceof pt||f instanceof Kt)&&!0===f.expression.isStateDependent){const d=i.paint.get(h);f.expression=d.value,f.updatePaintArray(c.start,c.end,p,e[l],s,a),o=!0}}}}return o}defines(){const e=[];for(const t in this.binders){const n=this.binders[t];(n instanceof wn||n instanceof Rr)&&e.push(...n.uniformNames.map(i=>`#define HAS_UNIFORM_${i}`))}return e}getBinderAttributes(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof Et||n instanceof pt||n instanceof Kt)for(let i=0;i<n.paintVertexAttributes.length;i++)e.push(n.paintVertexAttributes[i].name)}return e}getBinderUniforms(){const e=[];for(const t in this.binders){const n=this.binders[t];if(n instanceof wn||n instanceof Rr||n instanceof pt)for(const i of n.uniformNames)e.push(i)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const n in this.binders){const i=this.binders[n];if(i instanceof wn||i instanceof Rr||i instanceof pt)for(const s of i.uniformNames)t.push({name:s,property:n,binding:i.getBinding(e,s)})}return t}setUniforms(e,t,n,i,s){for(const{name:a,property:o,binding:l}of n)this.binders[o].setUniform(e,l,s,i.get(o),a)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const t=this.binders[e];(t instanceof Et||t instanceof pt||t instanceof Kt)&&t.paintVertexBuffer&&this._buffers.push(t.paintVertexBuffer)}}upload(e){for(const t in this.binders){const n=this.binders[t];(n instanceof Et||n instanceof pt||n instanceof Kt)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Et||t instanceof pt||t instanceof Kt)&&t.destroy()}}}class hr{constructor(e,t,n=(()=>!0)){this.programConfigurations={};for(const i of e)this.programConfigurations[i.id]=new Jt(i,t,n);this.needsUpload=!1,this._featureMap=new $i,this._bufferOffset=0}populatePaintArrays(e,t,n,i,s,a,o){for(const l in this.programConfigurations)this.programConfigurations[l].populatePaintArrays(e,t,i,s,a,o);void 0!==t.id&&this._featureMap.add(t.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,n,i,s){for(const a of n)this.needsUpload=this.programConfigurations[a.id].updatePaintArrays(e,this._featureMap,t,a,i,s)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Kf={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Jf(r,e){return Kf[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}const Wf={"line-pattern":{source:Yt,composite:Yt},"fill-pattern":{source:Yt,composite:Yt},"fill-extrusion-pattern":{source:Yt,composite:Yt},"line-dasharray":{source:Di,composite:Di}},Hf={color:{source:ji,composite:bn},number:{source:Fi,composite:ji}};function gc(r,e,t){const n=Wf[r];return n&&n[t]||Hf[e][t]}U(wn,"ConstantBinder"),U(Rr,"PatternConstantBinder"),U(Et,"SourceExpressionBinder"),U(Kt,"PatternCompositeBinder"),U(pt,"CompositeExpressionBinder"),U(Jt,"ProgramConfiguration",{omit:["_buffers"]}),U(hr,"ProgramConfigurationSet");const Ui="-transition";class ft extends _i{constructor(e,t){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),t.layout&&(this._unevaluatedLayout=new Of(t.layout)),t.paint)){this._transitionablePaint=new $f(t.paint);for(const n in e.paint)this.setPaintProperty(n,e.paint[n],{validate:!1});for(const n in e.layout)this.setLayoutProperty(n,e.layout[n],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Bi(t.paint)}}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t,n={}){null!=t&&this._validate(Ef,`layers.${this.id}.layout.${e}`,e,t,n)||("visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}getPaintProperty(e){return Ts(e,Ui)?this._transitionablePaint.getTransition(e.slice(0,-Ui.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,t,n={}){if(null!=t&&this._validate(Pf,`layers.${this.id}.paint.${e}`,e,t,n))return!1;if(Ts(e,Ui))return this._transitionablePaint.setTransition(e.slice(0,-Ui.length),t||void 0),!1;{const i=this._transitionablePaint._values[e],s=i.value.isDataDriven(),a=i.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);const o=this._transitionablePaint._values[e].value,l=o.isDataDriven(),u=Ts(e,"pattern")||"line-dasharray"===e;return l||s||u||this._handleOverridablePaintPropertyUpdate(e,a,o)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,t,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),function(t,n,i){const s={};for(const a in t)n.call(this,t[a],a,t)&&(s[a]=t[a]);return s}(e,(t,n)=>!(void 0===t||"layout"===n&&!Object.keys(t).length||"paint"===n&&!Object.keys(t).length))}_validate(e,t,n,i,s={}){return(!s||!1!==s.validate)&&function(a,o){let l=!1;if(o&&o.length)for(const u of o)a.fire(new Sa(new Error(u.message))),l=!0;return l}(this,e.call(Cf,{key:t,layerType:this.type,objectKey:n,value:i,styleSpec:T,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof Lr&&Tr(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ai(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Qf=be([{name:"a_pos",components:2,type:"Int16"}],4),ed=be([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Oe{constructor(e=[]){this.segments=e}prepareSegment(e,t,n,i){let s=this.segments[this.segments.length-1];return e>Oe.MAX_VERTEX_ARRAY_LENGTH&&Ee(`Max vertices per segment is ${Oe.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!s||s.vertexLength+e>Oe.MAX_VERTEX_ARRAY_LENGTH||s.sortKey!==i)&&(s={vertexOffset:t.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},void 0!==i&&(s.sortKey=i),this.segments.push(s)),s}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,n,i){return new Oe([{vertexOffset:e,primitiveOffset:t,vertexLength:n,primitiveLength:i,vaos:{},sortKey:0}])}}Oe.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,U(Oe,"SegmentVector");var K=8192;class pr{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof ae?new ae(e.lng,e.lat):ae.convert(e),this}setSouthWest(e){return this._sw=e instanceof ae?new ae(e.lng,e.lat):ae.convert(e),this}extend(e){const t=this._sw,n=this._ne;let i,s;if(e instanceof ae)i=e,s=e;else{if(!(e instanceof pr))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(pr.convert(e)):this.extend(ae.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(ae.convert(e)):this;if(i=e._sw,s=e._ne,!i||!s)return this}return t||n?(t.lng=Math.min(i.lng,t.lng),t.lat=Math.min(i.lat,t.lat),n.lng=Math.max(s.lng,n.lng),n.lat=Math.max(s.lat,n.lat)):(this._sw=new ae(i.lng,i.lat),this._ne=new ae(s.lng,s.lat)),this}getCenter(){return new ae((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ae(this.getWest(),this.getNorth())}getSouthEast(){return new ae(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:n}=ae.convert(e);let i=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&i}static convert(e){return!e||e instanceof pr?e:new pr(e)}}var eo=1e-6,kt=typeof Float32Array<"u"?Float32Array:Array;function _n(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function xc(r,e){var t=e[0],n=e[1],i=e[2],s=e[3],a=e[4],o=e[5],l=e[6],u=e[7],c=e[8],p=e[9],h=e[10],f=e[11],d=e[12],y=e[13],m=e[14],g=e[15],b=t*o-n*a,x=t*l-i*a,v=t*u-s*a,_=n*l-i*o,w=n*u-s*o,A=i*u-s*l,S=c*y-p*d,z=c*m-h*d,P=c*g-f*d,k=p*m-h*y,M=p*g-f*y,B=h*g-f*m,C=b*B-x*M+v*k+_*P-w*z+A*S;return C?(r[0]=(o*B-l*M+u*k)*(C=1/C),r[1]=(i*M-n*B-s*k)*C,r[2]=(y*A-m*w+g*_)*C,r[3]=(h*w-p*A-f*_)*C,r[4]=(l*P-a*B-u*z)*C,r[5]=(t*B-i*P+s*z)*C,r[6]=(m*v-d*A-g*x)*C,r[7]=(c*A-h*v+f*x)*C,r[8]=(a*M-o*P+u*S)*C,r[9]=(n*P-t*M-s*S)*C,r[10]=(d*w-y*v+g*b)*C,r[11]=(p*v-c*w-f*b)*C,r[12]=(o*z-a*k-l*S)*C,r[13]=(t*k-n*z+i*S)*C,r[14]=(y*x-d*_-m*b)*C,r[15]=(c*_-p*x+h*b)*C,r):null}function vc(r,e,t){var n=e[0],i=e[1],s=e[2],a=e[3],o=e[4],l=e[5],u=e[6],c=e[7],p=e[8],h=e[9],f=e[10],d=e[11],y=e[12],m=e[13],g=e[14],b=e[15],x=t[0],v=t[1],_=t[2],w=t[3];return r[0]=x*n+v*o+_*p+w*y,r[1]=x*i+v*l+_*h+w*m,r[2]=x*s+v*u+_*f+w*g,r[3]=x*a+v*c+_*d+w*b,r[4]=(x=t[4])*n+(v=t[5])*o+(_=t[6])*p+(w=t[7])*y,r[5]=x*i+v*l+_*h+w*m,r[6]=x*s+v*u+_*f+w*g,r[7]=x*a+v*c+_*d+w*b,r[8]=(x=t[8])*n+(v=t[9])*o+(_=t[10])*p+(w=t[11])*y,r[9]=x*i+v*l+_*h+w*m,r[10]=x*s+v*u+_*f+w*g,r[11]=x*a+v*c+_*d+w*b,r[12]=(x=t[12])*n+(v=t[13])*o+(_=t[14])*p+(w=t[15])*y,r[13]=x*i+v*l+_*h+w*m,r[14]=x*s+v*u+_*f+w*g,r[15]=x*a+v*c+_*d+w*b,r}function bc(r,e,t){var n,i,s,a,o,l,u,c,p,h,f,d,y=t[0],m=t[1],g=t[2];return e===r?(r[12]=e[0]*y+e[4]*m+e[8]*g+e[12],r[13]=e[1]*y+e[5]*m+e[9]*g+e[13],r[14]=e[2]*y+e[6]*m+e[10]*g+e[14],r[15]=e[3]*y+e[7]*m+e[11]*g+e[15]):(i=e[1],s=e[2],a=e[3],o=e[4],l=e[5],u=e[6],c=e[7],p=e[8],h=e[9],f=e[10],d=e[11],r[0]=n=e[0],r[1]=i,r[2]=s,r[3]=a,r[4]=o,r[5]=l,r[6]=u,r[7]=c,r[8]=p,r[9]=h,r[10]=f,r[11]=d,r[12]=n*y+o*m+p*g+e[12],r[13]=i*y+l*m+h*g+e[13],r[14]=s*y+u*m+f*g+e[14],r[15]=a*y+c*m+d*g+e[15]),r}function qi(r,e,t){var n=t[0],i=t[1],s=t[2];return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*i,r[5]=e[5]*i,r[6]=e[6]*i,r[7]=e[7]*i,r[8]=e[8]*s,r[9]=e[9]*s,r[10]=e[10]*s,r[11]=e[11]*s,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function to(){var r=new kt(3);return kt!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function wc(r){var e=new kt(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function ro(r){return Math.hypot(r[0],r[1],r[2])}function Ni(r,e,t){var n=new kt(3);return n[0]=r,n[1]=e,n[2]=t,n}function jr(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r}function td(r,e,t){return r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r}function rd(r,e,t){return r[0]=Math.max(e[0],t[0]),r[1]=Math.max(e[1],t[1]),r[2]=Math.max(e[2],t[2]),r}function Wt(r,e,t){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r}function no(r,e,t,n){return r[0]=e[0]+t[0]*n,r[1]=e[1]+t[1]*n,r[2]=e[2]+t[2]*n,r}function dt(r,e){var t=e[0],n=e[1],i=e[2],s=t*t+n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r}function Ht(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function yt(r,e,t){var n=e[0],i=e[1],s=e[2],a=t[3]*n+t[7]*i+t[11]*s+t[15];return r[0]=(t[0]*n+t[4]*i+t[8]*s+t[12])/(a=a||1),r[1]=(t[1]*n+t[5]*i+t[9]*s+t[13])/a,r[2]=(t[2]*n+t[6]*i+t[10]*s+t[14])/a,r}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var It,r,$r=function(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r};function Sn(r,e,t){var n=e[0],i=e[1],s=e[2],a=e[3];return r[0]=t[0]*n+t[4]*i+t[8]*s+t[12]*a,r[1]=t[1]*n+t[5]*i+t[9]*s+t[13]*a,r[2]=t[2]*n+t[6]*i+t[10]*s+t[14]*a,r[3]=t[3]*n+t[7]*i+t[11]*s+t[15]*a,r}function _c(){var r=new kt(4);return kt!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}to(),r=new kt(4),kt!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),to(),Ni(1,0,0),Ni(0,1,0),_c(),_c(),It=new kt(9),kt!=Float32Array&&(It[1]=0,It[2]=0,It[3]=0,It[5]=0,It[6]=0,It[7]=0),It[0]=1,It[4]=1,It[8]=1,be([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);const Sc=be([{name:"a_pos_3",components:3,type:"Int16"}]);var io=be([{name:"a_pos",type:"Int16",components:2}]);class Ac{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,n){const i=Ht(t,this.dir);if(Math.abs(i)<1e-6)return!1;const s=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/i;return n[0]=this.pos[0]+this.dir[0]*s,n[1]=this.pos[1]+this.dir[1]*s,n[2]=this.pos[2]+this.dir[2]*s,!0}closestPointOnSphere(e,t,n){if(y=(f=this.pos)[0],m=f[1],g=f[2],b=(d=e)[0],x=d[1],v=d[2],Math.abs(y-b)<=eo*Math.max(1,Math.abs(y),Math.abs(b))&&Math.abs(m-x)<=eo*Math.max(1,Math.abs(m),Math.abs(x))&&Math.abs(g-v)<=eo*Math.max(1,Math.abs(g),Math.abs(v))||0===t)return n[0]=n[1]=n[2]=0,!1;var f,d,y,m,g,b,x,v;const[i,s,a]=this.dir,o=this.pos[0]-e[0],l=this.pos[1]-e[1],u=this.pos[2]-e[2],c=i*i+s*s+a*a,p=2*(o*i+l*s+u*a),h=p*p-4*c*(o*o+l*l+u*u-t*t);if(h<0){const f=Math.max(-p/2,0),d=o+i*f,y=l+s*f,m=u+a*f,g=Math.hypot(d,y,m);return n[0]=d*t/g,n[1]=y*t/g,n[2]=m*t/g,!1}{const f=(-p-Math.sqrt(h))/(2*c);if(f<0){const d=Math.hypot(o,l,u);return n[0]=o*t/d,n[1]=l*t/d,n[2]=u*t/d,!1}return n[0]=o+i*f,n[1]=l+s*f,n[2]=u+a*f,!0}}}class mt{static fromPoints(e){const t=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0];for(const i of e)td(t,t,i),rd(n,n,i);return new mt(t,n)}static applyTransform(e,t){const n=e.getCorners();for(let i=0;i<n.length;++i)yt(n[i],n[i],t);return mt.fromPoints(n)}constructor(e,t){this.min=e,this.max=t,this.center=Wt([],jr([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],n=wc(this.min),i=wc(this.max);for(let s=0;s<t.length;s++)n[s]=t[s]?this.min[s]:this.center[s],i[s]=t[s]?this.center[s]:this.max[s];return i[2]=this.max[2],new mt(n,i)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){const t=this.getCorners();let n=!0;for(let i=0;i<e.planes.length;i++){const s=e.planes[i];let a=0;for(let o=0;o<t.length;o++)a+=Ht(s,t[o])+s[3]>=0;if(0===a)return 0;a!==t.length&&(n=!1)}if(n)return 2;for(let i=0;i<3;i++){let s=Number.MAX_VALUE,a=-Number.MAX_VALUE;for(let o=0;o<e.points.length;o++){const l=e.points[o][i]-this.min[i];s=Math.min(s,l),a=Math.max(a,l)}if(a<0||s>this.max[i]-this.min[i])return 0}return 1}}const An=K/Math.PI/2,gt=-An,xt=An,nd=[new mt([gt,gt,gt],[xt,xt,xt]),new mt([gt,gt,gt],[0,0,xt]),new mt([0,gt,gt],[xt,0,xt]),new mt([gt,0,gt],[0,xt,xt]),new mt([0,0,gt],[xt,xt,xt])];function kc(r){return r*An/Zi}function Ic(r,e,t,n=!0){const i=Wt([],r._camera.position,r.worldSize),s=[e,t,1,1];var P,k,M;Sn(s,s,r.pixelMatrixInverse),(P=s)[0]=(k=s)[0]*(M=1/s[3]),P[1]=k[1]*M,P[2]=k[2]*M,P[3]=k[3]*M;const a=dt([],$r([],s,i)),o=r.globeMatrix,l=[o[12],o[13],o[14]],u=$r([],l,i),c=ro(u),p=dt([],u),h=r.worldSize/(2*Math.PI),f=Ht(p,a),d=Math.asin(h/c);if(d<Math.acos(f)){if(!n)return null;const P=[],k=[];Wt(P,a,c/f),dt(k,$r(k,P,u)),dt(a,jr(a,u,Wt(a,k,Math.tan(d)*c)))}const y=[];new Ac(i,a).closestPointOnSphere(l,h,y);const m=dt([],Ps(o,0)),g=dt([],Ps(o,1)),b=dt([],Ps(o,2)),x=Ht(m,y),v=Ht(g,y),_=Ht(b,y),w=it(Math.asin(-v/h));let A=it(Math.atan2(x,_));A=r.center.lng+function(P,k){const M=(k-P+180)%360-180;return M<-180?M+360:M}(r.center.lng,A);const S=fr(A),z=ue(dr(w),0,1);return new Gi(S,z)}function kn(r){if(r.z<=1)return nd[r.z+2*r.y+r.x];const e=Tc(Mc(r));return mt.fromPoints(e)}function In(r,e,t){return Wt(r,r,1-t),no(r,r,e,t)}function Mc({x:r,y:e,z:t}){const n=1/(1<<t),i=new ae(ot(r*n),qe((e+1)*n)),s=new ae(ot((r+1)*n),qe(e*n));return new pr(i,s)}function Tc(r){const e=me(r.getNorth()),t=me(r.getSouth()),n=Math.cos(e),i=Math.cos(t),s=Math.sin(e),a=Math.sin(t),o=r.getWest(),l=r.getEast();return[Mn(i,a,o),Mn(i,a,l),Mn(n,s,l),Mn(n,s,o)]}function Mn(r,e,t,n=An){return t=me(t),[r*Math.sin(t)*n,-e*n,r*Math.cos(t)*n]}function so(r,e,t){return Mn(Math.cos(me(r)),Math.sin(me(r)),e,t)}function Tn(r,e,t,n){const i=1<<t.z,s=(r/K+t.x)/i;return so(qe((e/K+t.y)/i),ot(s),n)}function ao({min:r,max:e}){return 16383/Math.max(e[0]-r[0],e[1]-r[1],e[2]-r[2])}const zc=new Float64Array(16);function oo(r){const e=ao(r),t=((n=zc)[0]=(i=[e,e,e])[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=i[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=i[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n);var n,i;return bc(t,t,function(n,i){return n[0]=-i[0],n[1]=-i[1],n[2]=-i[2],n}([],r.min))}function lo(r){return(e=ue(((e=r)-5)/1,0,1))*e*(3-2*e);var e}const Zi=6371008.8,Bc=2*Math.PI*Zi;class ae{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error(`Invalid LngLat object: (${e}, ${t})`);if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ae(ol(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const t=Math.PI/180,n=this.lat*t,i=e.lat*t,s=Math.sin(n)*Math.sin(i)+Math.cos(n)*Math.cos(i)*Math.cos((e.lng-this.lng)*t);return Zi*Math.acos(Math.min(s,1))}toBounds(e=0){const t=360*e/40075017,n=t/Math.cos(Math.PI/180*this.lat);return new pr(new ae(this.lng-n,this.lat-t),new ae(this.lng+n,this.lat+t))}toEcef(e){const t=kc(e);return so(this.lat,this.lng,An+t)}static convert(e){if(e instanceof ae)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new ae(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new ae(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}function Cc(r){return Bc*Math.cos(r*Math.PI/180)}function fr(r){return(180+r)/360}function dr(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function Dt(r,e){return r/Cc(e)}function ot(r){return 360*r-180}function qe(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}const yr=85.051129;class Gi{constructor(e,t,n=0){this.x=+e,this.y=+t,this.z=+n}static fromLngLat(e,t=0){const n=ae.convert(e);return new Gi(fr(n.lng),dr(n.lat),Dt(t,n.lat))}toLngLat(){return new ae(ot(this.x),qe(this.y))}toAltitude(){return this.z*Cc(qe(this.y))}meterInMercatorCoordinateUnits(){return 1/Bc*(e=qe(this.y),1/Math.cos(e*Math.PI/180));var e}}function uo(r,e,t,n,i,s,a,o,l){const u=(e+n)/2,c=(t+i)/2,p=new R(u,c);o(p),function(h,f,d,y,m,g){const b=d-m,x=y-g;return Math.abs((y-f)*b-(d-h)*x)/Math.hypot(b,x)}(p.x,p.y,s.x,s.y,a.x,a.y)>=l?(uo(r,e,t,u,c,s,p,o,l),uo(r,u,c,n,i,p,a,o,l)):r.push(a)}function id(r,e,t){let n=r[0],i=n.x,s=n.y;e(n);const a=[n];for(let o=1;o<r.length;o++){const l=r[o],{x:u,y:c}=l;e(l),uo(a,i,s,u,c,n,l,e,t),i=u,s=c,n=l}return a}function co(r,e,t,n){if(n(e,t)){const i=e.add(t)._mult(.5);co(r,e,i,n),co(r,i,t,n)}else r.push(t)}function sd(r,e){let t=r[0];const n=[t];for(let i=1;i<r.length;i++){const s=r[i];co(n,t,s,e),t=s}return n}const ho=Math.pow(2,14)-1,Pc=-ho-1;function ad(r,e){const t=Math.round(r.x*e),n=Math.round(r.y*e);return r.x=ue(t,Pc,ho),r.y=ue(n,Pc,ho),(t<r.x||t>r.x+1||n<r.y||n>r.y+1)&&Ee("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function Vt(r,e,t){const n=r.loadGeometry(),i=r.extent,s=K/i;if(e&&t&&t.projection.isReprojectedInTileSpace){const a=1<<e.z,{scale:o,x:l,y:u,projection:c}=t,p=h=>{const f=ot((e.x+h.x/i)/a),d=qe((e.y+h.y/i)/a),y=c.project(f,d);h.x=(y.x*o-l)*i,h.y=(y.y*o-u)*i};for(let h=0;h<n.length;h++)if(1!==r.type)n[h]=id(n[h],p,1);else{const f=[];for(const d of n[h])d.x<0||d.x>=i||d.y<0||d.y>=i||(p(d),f.push(d));n[h]=f}}for(const a of n)for(const o of a)ad(o,s);return n}function mr(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?Vt(r):[]}}function Xi(r,e,t,n,i){r.emplaceBack(2*e+(n+1)/2,2*t+(i+1)/2)}function Yi(r,e,t){r.emplaceBack(e.x,e.y,e.z,16384*t[0],16384*t[1],16384*t[2])}class po{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Xt,this.indexArray=new At,this.segments=new Oe,this.programConfigurations=new hr(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(e,t,n,i){const s=this.layers[0],a=[];let o=null;"circle"===s.type&&(o=s.layout.get("circle-sort-key"));for(const{feature:u,id:c,index:p,sourceLayerIndex:h}of e){const f=this.layers[0]._featureFilter.needGeometry,d=mr(u,f);if(!this.layers[0]._featureFilter.filter(new Se(this.zoom),d,n))continue;const y=o?o.evaluate(d,{},n):void 0,m={id:c,properties:u.properties,type:u.type,sourceLayerIndex:h,index:p,geometry:f?d.geometry:Vt(u,n,i),patterns:{},sortKey:y};a.push(m)}o&&a.sort((u,c)=>u.sortKey-c.sortKey);let l=null;"globe"===i.projection.name&&(this.globeExtVertexArray=new Vi,l=i.projection);for(const u of a){const{geometry:c,index:p,sourceLayerIndex:h}=u,f=e[p].feature;this.addFeature(u,c,p,t.availableImages,n,l),t.featureIndex.insert(f,c,p,h,this.index)}}update(e,t,n,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Qf.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,ed.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,t,n,i,s,a){for(const o of t)for(const l of o){const u=l.x,c=l.y;if(u<0||u>=K||c<0||c>=K)continue;if(a){const f=a.projectTilePoint(u,c,s),d=a.upVector(s,u,c),y=this.globeExtVertexArray;Yi(y,f,d),Yi(y,f,d),Yi(y,f,d),Yi(y,f,d)}const p=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),h=p.vertexLength;Xi(this.layoutVertexArray,u,c,-1,-1),Xi(this.layoutVertexArray,u,c,1,-1),Xi(this.layoutVertexArray,u,c,1,1),Xi(this.layoutVertexArray,u,c,-1,1),this.indexArray.emplaceBack(h,h+1,h+2),this.indexArray.emplaceBack(h,h+2,h+3),p.vertexLength+=4,p.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},i,s)}}function od(r,e){for(let t=0;t<r.length;t++)if(Or(e,r[t]))return!0;for(let t=0;t<e.length;t++)if(Or(r,e[t]))return!0;return!!fo(r,e)}function ld(r,e,t){return!!Or(r,e)||!!yo(e,r,t)}function Ec(r,e){if(1===r.length)return Vc(e,r[0]);for(let t=0;t<e.length;t++){const n=e[t];for(let i=0;i<n.length;i++)if(Or(r,n[i]))return!0}for(let t=0;t<r.length;t++)if(Vc(e,r[t]))return!0;for(let t=0;t<e.length;t++)if(fo(r,e[t]))return!0;return!1}function ud(r,e,t){if(r.length>1){if(fo(r,e))return!0;for(let n=0;n<e.length;n++)if(yo(e[n],r,t))return!0}for(let n=0;n<r.length;n++)if(yo(r[n],e,t))return!0;return!1}function fo(r,e){if(0===r.length||0===e.length)return!1;for(let t=0;t<r.length-1;t++){const n=r[t],i=r[t+1];for(let s=0;s<e.length-1;s++)if(cd(n,i,e[s],e[s+1]))return!0}return!1}function cd(r,e,t,n){return qt(r,t,n)!==qt(e,t,n)&&qt(r,e,t)!==qt(r,e,n)}function yo(r,e,t){const n=t*t;if(1===e.length)return r.distSqr(e[0])<n;for(let i=1;i<e.length;i++)if(Dc(r,e[i-1],e[i])<n)return!0;return!1}function Dc(r,e,t){const n=e.distSqr(t);if(0===n)return r.distSqr(e);const i=((r.x-e.x)*(t.x-e.x)+(r.y-e.y)*(t.y-e.y))/n;return r.distSqr(i<0?e:i>1?t:t.sub(e)._mult(i)._add(e))}function Vc(r,e){let t,n,i,s=!1;for(let a=0;a<r.length;a++){t=r[a];for(let o=0,l=t.length-1;o<t.length;l=o++)n=t[o],i=t[l],n.y>e.y!=i.y>e.y&&e.x<(i.x-n.x)*(e.y-n.y)/(i.y-n.y)+n.x&&(s=!s)}return s}function Or(r,e){let t=!1;for(let n=0,i=r.length-1;n<r.length;i=n++){const s=r[n],a=r[i];s.y>e.y!=a.y>e.y&&e.x<(a.x-s.x)*(e.y-s.y)/(a.y-s.y)+s.x&&(t=!t)}return t}function hd(r,e,t){const n=t[0],i=t[2];if(r.x<n.x&&e.x<n.x||r.x>i.x&&e.x>i.x||r.y<n.y&&e.y<n.y||r.y>i.y&&e.y>i.y)return!1;const s=qt(r,e,t[0]);return s!==qt(r,e,t[1])||s!==qt(r,e,t[2])||s!==qt(r,e,t[3])}function Ur(r,e,t){const n=e.paint.get(r).value;return"constant"===n.kind?n.value:t.programConfigurations.get(e.id).getMaxValue(r)}function Ki(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Lc(r,e,t,n,i){if(!e[0]&&!e[1])return r;const s=R.convert(e)._mult(i);"viewport"===t&&s._rotate(-n);const a=[];for(let o=0;o<r.length;o++)a.push(r[o].sub(s));return a}function Fc(r,e,t,n){const i=R.convert(r)._mult(n);return"viewport"===e&&i._rotate(-t),i}U(po,"CircleBucket",{omit:["layers"]});const pd=new We({"circle-sort-key":new X(T.layout_circle["circle-sort-key"])});var fd={paint:new We({"circle-radius":new X(T.paint_circle["circle-radius"]),"circle-color":new X(T.paint_circle["circle-color"]),"circle-blur":new X(T.paint_circle["circle-blur"]),"circle-opacity":new X(T.paint_circle["circle-opacity"]),"circle-translate":new q(T.paint_circle["circle-translate"]),"circle-translate-anchor":new q(T.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new q(T.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new q(T.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new X(T.paint_circle["circle-stroke-width"]),"circle-stroke-color":new X(T.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new X(T.paint_circle["circle-stroke-opacity"])}),layout:pd};function Rc(r,e,t,n,i,s,a,o,l){if(s&&r.queryGeometry.isAboveHorizon)return!1;s&&(l*=r.pixelToTileUnitsFactor);const u=r.tileID.canonical,c=t.projection.upVectorScale(u,t.center.lat,t.worldSize).metersToTile;for(const p of e)for(const h of p){const f=h.add(o),d=i&&t.elevation?t.elevation.exaggeration()*i.getElevationAt(f.x,f.y,!0):0,y=t.projection.projectTilePoint(f.x,f.y,u);if(d>0){const x=t.projection.upVector(u,f.x,f.y);y.x+=x[0]*c*d,y.y+=x[1]*c*d,y.z+=x[2]*c*d}const m=s?f:dd(y.x,y.y,y.z,n),g=s?r.tilespaceRays.map(x=>md(x,d)):r.queryGeometry.screenGeometry,b=Sn([],[y.x,y.y,y.z,1],n);if(!a&&s?l*=b[3]/t.cameraToCenterDistance:a&&!s&&(l*=t.cameraToCenterDistance/b[3]),s){const x=qe((h.y/K+u.y)/(1<<u.z));l/=t.projection.pixelsPerMeter(x,1)/Dt(1,x)}if(ld(g,m,l))return!0}return!1}function dd(r,e,t,n){const i=Sn([],[r,e,t,1],n);return new R(i[0]/i[3],i[1]/i[3])}const jc=Ni(0,0,0),yd=Ni(0,0,1);function md(r,e){const t=to();return jc[2]=e,r.intersectsPlane(jc,yd,t),new R(t[0],t[1])}class $c extends po{}function Oc(r,{width:e,height:t},n,i){if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==e*t*n)throw new RangeError("mismatched image size")}else i=new Uint8Array(e*t*n);return r.width=e,r.height=t,r.data=i,r}function Uc(r,e,t){const{width:n,height:i}=e;n===r.width&&i===r.height||(mo(r,e,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,n),height:Math.min(r.height,i)},t),r.width=n,r.height=i,r.data=e.data)}function mo(r,e,t,n,i,s){if(0===i.width||0===i.height)return e;if(i.width>r.width||i.height>r.height||t.x>r.width-i.width||t.y>r.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>e.width||i.height>e.height||n.x>e.width-i.width||n.y>e.height-i.height)throw new RangeError("out of range destination coordinates for image copy");const a=r.data,o=e.data;for(let l=0;l<i.height;l++){const u=((t.y+l)*r.width+t.x)*s,c=((n.y+l)*e.width+n.x)*s;for(let p=0;p<i.width*s;p++)o[c+p]=a[u+p]}return e}U($c,"HeatmapBucket",{omit:["layers"]});class gr{constructor(e,t){Oc(this,e,1,t)}resize(e){Uc(this,new gr(e),1)}clone(){return new gr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,i,s){mo(e,t,n,i,s,1)}}class rt{constructor(e,t){Oc(this,e,4,t)}resize(e){Uc(this,new rt(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new rt({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,n,i,s){mo(e,t,n,i,s,4)}}U(gr,"AlphaImage"),U(rt,"RGBAImage");var gd={paint:new We({"heatmap-radius":new X(T.paint_heatmap["heatmap-radius"]),"heatmap-weight":new X(T.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new q(T.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ci(T.paint_heatmap["heatmap-color"]),"heatmap-opacity":new q(T.paint_heatmap["heatmap-opacity"])})};function qc(r){const e={},t=r.resolution||256,n=r.clips?r.clips.length:1,i=r.image||new rt({width:t,height:n}),s=(a,o,l)=>{e[r.evaluationKey]=l;const u=r.expression.evaluate(e);i.data[a+o+0]=Math.floor(255*u.r/u.a),i.data[a+o+1]=Math.floor(255*u.g/u.a),i.data[a+o+2]=Math.floor(255*u.b/u.a),i.data[a+o+3]=Math.floor(255*u.a)};if(r.clips)for(let a=0,o=0;a<n;++a,o+=4*t)for(let l=0,u=0;l<t;l++,u+=4){const c=l/(t-1),{start:p,end:h}=r.clips[a];s(o,u,p*(1-c)+h*c)}else for(let a=0,o=0;a<t;a++,o+=4)s(0,o,a/(t-1));return i}var xd={paint:new We({"hillshade-illumination-direction":new q(T.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new q(T.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new q(T.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new q(T.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new q(T.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new q(T.paint_hillshade["hillshade-accent-color"])})};const vd=be([{name:"a_pos",components:2,type:"Int16"}],4),{members:bd}=vd;var qr={};function Ji(r,e,t){t=t||2;var n,i,s,a,o,l,u,c=e&&e.length,p=c?e[0]*t:r.length,h=Nc(r,0,p,t,!0),f=[];if(!h||h.next===h.prev)return f;if(c&&(h=function(y,m,g,b){var x,v,_,w=[];for(x=0,v=m.length;x<v;x++)(_=Nc(y,m[x]*b,x<v-1?m[x+1]*b:y.length,b,!1))===_.next&&(_.steiner=!0),w.push(Td(_));for(w.sort(kd),x=0;x<w.length;x++)g=Id(w[x],g);return g}(r,e,h,t)),r.length>80*t){n=s=r[0],i=a=r[1];for(var d=t;d<p;d+=t)(o=r[d])<n&&(n=o),(l=r[d+1])<i&&(i=l),o>s&&(s=o),l>a&&(a=l);u=0!==(u=Math.max(s-n,a-i))?32767/u:0}return zn(h,f,t,n,i,u,0),f}function Nc(r,e,t,n,i){var s,a;if(i===vo(r,e,t,n)>0)for(s=e;s<t;s+=n)a=Xc(s,r[s],r[s+1],a);else for(s=t-n;s>=e;s-=n)a=Xc(s,r[s],r[s+1],a);return a&&Wi(a,a.next)&&(Cn(a),a=a.next),a}function xr(r,e){if(!r)return r;e||(e=r);var t,n=r;do{if(t=!1,n.steiner||!Wi(n,n.next)&&0!==Te(n.prev,n,n.next))n=n.next;else{if(Cn(n),(n=e=n.prev)===n.next)break;t=!0}}while(t||n!==e);return e}function zn(r,e,t,n,i,s,a){if(r){!a&&s&&function(c,p,h,f){var d=c;do{0===d.z&&(d.z=go(d.x,d.y,p,h,f)),d.prevZ=d.prev,d.nextZ=d.next,d=d.next}while(d!==c);d.prevZ.nextZ=null,d.prevZ=null,function(y){var m,g,b,x,v,_,w,A,S=1;do{for(g=y,y=null,v=null,_=0;g;){for(_++,b=g,w=0,m=0;m<S&&(w++,b=b.nextZ);m++);for(A=S;w>0||A>0&&b;)0!==w&&(0===A||!b||g.z<=b.z)?(x=g,g=g.nextZ,w--):(x=b,b=b.nextZ,A--),v?v.nextZ=x:y=x,x.prevZ=v,v=x;g=b}v.nextZ=null,S*=2}while(_>1)}(d)}(r,n,i,s);for(var o,l,u=r;r.prev!==r.next;)if(o=r.prev,l=r.next,s?_d(r,n,i,s):wd(r))e.push(o.i/t|0),e.push(r.i/t|0),e.push(l.i/t|0),Cn(r),r=l.next,u=l.next;else if((r=l)===u){a?1===a?zn(r=Sd(xr(r),e,t),e,t,n,i,s,2):2===a&&Ad(r,e,t,n,i,s):zn(xr(r),e,t,n,i,s,1);break}}}function wd(r){var e=r.prev,t=r,n=r.next;if(Te(e,t,n)>=0)return!1;for(var i=e.x,s=t.x,a=n.x,o=e.y,l=t.y,u=n.y,c=i<s?i<a?i:a:s<a?s:a,p=o<l?o<u?o:u:l<u?l:u,h=i>s?i>a?i:a:s>a?s:a,f=o>l?o>u?o:u:l>u?l:u,d=n.next;d!==e;){if(d.x>=c&&d.x<=h&&d.y>=p&&d.y<=f&&Nr(i,o,s,l,a,u,d.x,d.y)&&Te(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function _d(r,e,t,n){var i=r.prev,s=r,a=r.next;if(Te(i,s,a)>=0)return!1;for(var o=i.x,l=s.x,u=a.x,c=i.y,p=s.y,h=a.y,f=o<l?o<u?o:u:l<u?l:u,d=c<p?c<h?c:h:p<h?p:h,y=o>l?o>u?o:u:l>u?l:u,m=c>p?c>h?c:h:p>h?p:h,g=go(f,d,e,t,n),b=go(y,m,e,t,n),x=r.prevZ,v=r.nextZ;x&&x.z>=g&&v&&v.z<=b;){if(x.x>=f&&x.x<=y&&x.y>=d&&x.y<=m&&x!==i&&x!==a&&Nr(o,c,l,p,u,h,x.x,x.y)&&Te(x.prev,x,x.next)>=0||(x=x.prevZ,v.x>=f&&v.x<=y&&v.y>=d&&v.y<=m&&v!==i&&v!==a&&Nr(o,c,l,p,u,h,v.x,v.y)&&Te(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;x&&x.z>=g;){if(x.x>=f&&x.x<=y&&x.y>=d&&x.y<=m&&x!==i&&x!==a&&Nr(o,c,l,p,u,h,x.x,x.y)&&Te(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;v&&v.z<=b;){if(v.x>=f&&v.x<=y&&v.y>=d&&v.y<=m&&v!==i&&v!==a&&Nr(o,c,l,p,u,h,v.x,v.y)&&Te(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function Sd(r,e,t){var n=r;do{var i=n.prev,s=n.next.next;!Wi(i,s)&&Zc(i,n,n.next,s)&&Bn(i,s)&&Bn(s,i)&&(e.push(i.i/t|0),e.push(n.i/t|0),e.push(s.i/t|0),Cn(n),Cn(n.next),n=r=s),n=n.next}while(n!==r);return xr(n)}function Ad(r,e,t,n,i,s){var a=r;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&zd(a,o)){var l=Gc(a,o);return a=xr(a,a.next),l=xr(l,l.next),zn(a,e,t,n,i,s,0),void zn(l,e,t,n,i,s,0)}o=o.next}a=a.next}while(a!==r)}function kd(r,e){return r.x-e.x}function Id(r,e){var t=function(i,s){var a,o=s,l=i.x,u=i.y,c=-1/0;do{if(u<=o.y&&u>=o.next.y&&o.next.y!==o.y){var p=o.x+(u-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(p<=l&&p>c&&(c=p,a=o.x<o.next.x?o:o.next,p===l))return a}o=o.next}while(o!==s);if(!a)return null;var h,f=a,d=a.x,y=a.y,m=1/0;o=a;do{l>=o.x&&o.x>=d&&l!==o.x&&Nr(u<y?l:c,u,d,y,u<y?c:l,u,o.x,o.y)&&(h=Math.abs(u-o.y)/(l-o.x),Bn(o,i)&&(h<m||h===m&&(o.x>a.x||o.x===a.x&&Md(a,o)))&&(a=o,m=h)),o=o.next}while(o!==f);return a}(r,e);if(!t)return e;var n=Gc(t,r);return xr(n,n.next),xr(t,t.next)}function Md(r,e){return Te(r.prev,r,e.prev)<0&&Te(e.next,r,r.next)<0}function go(r,e,t,n,i){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-t)*i|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Td(r){var e=r,t=r;do{(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next}while(e!==r);return t}function Nr(r,e,t,n,i,s,a,o){return(i-a)*(e-o)>=(r-a)*(s-o)&&(r-a)*(n-o)>=(t-a)*(e-o)&&(t-a)*(s-o)>=(i-a)*(n-o)}function zd(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(t,n){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==n.i&&i.next.i!==n.i&&Zc(i,i.next,t,n))return!0;i=i.next}while(i!==t);return!1}(r,e)&&(Bn(r,e)&&Bn(e,r)&&function(t,n){var i=t,s=!1,a=(t.x+n.x)/2,o=(t.y+n.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&a<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next}while(i!==t);return s}(r,e)&&(Te(r.prev,r,e.prev)||Te(r,e.prev,e))||Wi(r,e)&&Te(r.prev,r,r.next)>0&&Te(e.prev,e,e.next)>0)}function Te(r,e,t){return(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y)}function Wi(r,e){return r.x===e.x&&r.y===e.y}function Zc(r,e,t,n){var i=Qi(Te(r,e,t)),s=Qi(Te(r,e,n)),a=Qi(Te(t,n,r)),o=Qi(Te(t,n,e));return i!==s&&a!==o||!(0!==i||!Hi(r,t,e))||!(0!==s||!Hi(r,n,e))||!(0!==a||!Hi(t,r,n))||!(0!==o||!Hi(t,e,n))}function Hi(r,e,t){return e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y)}function Qi(r){return r>0?1:r<0?-1:0}function Bn(r,e){return Te(r.prev,r,r.next)<0?Te(r,e,r.next)>=0&&Te(r,r.prev,e)>=0:Te(r,e,r.prev)<0||Te(r,r.next,e)<0}function Gc(r,e){var t=new xo(r.i,r.x,r.y),n=new xo(e.i,e.x,e.y),i=r.next,s=e.prev;return r.next=e,e.prev=r,t.next=i,i.prev=t,n.next=t,t.prev=n,s.next=n,n.prev=s,n}function Xc(r,e,t,n){var i=new xo(r,e,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Cn(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function xo(r,e,t){this.i=r,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function vo(r,e,t,n){for(var i=0,s=e,a=t-n;s<t;s+=n)i+=(r[a]-r[s])*(r[s+1]+r[a+1]),a=s;return i}function Bd(r,e,t,n,i){Yc(r,e,t||0,n||r.length-1,i||Cd)}function Yc(r,e,t,n,i){for(;n>t;){if(n-t>600){var s=n-t+1,a=e-t+1,o=Math.log(s),l=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*l*(s-l)/s)*(a-s/2<0?-1:1);Yc(r,e,Math.max(t,Math.floor(e-a*l/s+u)),Math.min(n,Math.floor(e+(s-a)*l/s+u)),i)}var c=r[e],p=t,h=n;for(Pn(r,t,e),i(r[n],c)>0&&Pn(r,t,n);p<h;){for(Pn(r,p,h),p++,h--;i(r[p],c)<0;)p++;for(;i(r[h],c)>0;)h--}0===i(r[t],c)?Pn(r,t,h):Pn(r,++h,n),h<=e&&(t=h+1),e<=h&&(n=h-1)}}function Pn(r,e,t){var n=r[e];r[e]=r[t],r[t]=n}function Cd(r,e){return r<e?-1:r>e?1:0}function bo(r,e){const t=r.length;if(t<=1)return[r];const n=[];let i,s;for(let a=0;a<t;a++){const o=Op(r[a]);0!==o&&(r[a].area=Math.abs(o),void 0===s&&(s=o<0),s===o<0?(i&&n.push(i),i=[r[a]]):i.push(r[a]))}if(i&&n.push(i),e>1)for(let a=0;a<n.length;a++)n[a].length<=e||(Bd(n[a],e,1,n[a].length-1,Pd),n[a]=n[a].slice(0,e));return n}function Pd(r,e){return e.area-r.area}function wo(r,e,t){const n=t.patternDependencies;let i=!1;for(const s of e){const a=s.paint.get(`${r}-pattern`);a.isConstant()||(i=!0);const o=a.constantOr(null);o&&(i=!0,n[o]=!0)}return i}function _o(r,e,t,n,i){const s=i.patternDependencies;for(const a of e){const o=a.paint.get(`${r}-pattern`).value;if("constant"!==o.kind){let l=o.evaluate({zoom:n},t,{},i.availableImages);l=l&&l.name?l.name:l,s[l]=!0,t.patterns[a.id]=l}}return t}({get exports(){return qr},set exports(r){qr=r}}).exports=Ji,qr.default=Ji,Ji.deviation=function(r,e,t,n){var i=e&&e.length,s=Math.abs(vo(r,0,i?e[0]*t:r.length,t));if(i)for(var a=0,o=e.length;a<o;a++)s-=Math.abs(vo(r,e[a]*t,a<o-1?e[a+1]*t:r.length,t));var l=0;for(a=0;a<n.length;a+=3){var u=n[a]*t,c=n[a+1]*t,p=n[a+2]*t;l+=Math.abs((r[u]-r[p])*(r[c+1]-r[u+1])-(r[u]-r[c])*(r[p+1]-r[u+1]))}return 0===s&&0===l?0:Math.abs((l-s)/s)},Ji.flatten=function(r){for(var e=r[0][0].length,t={vertices:[],holes:[],dimensions:e},n=0,i=0;i<r.length;i++){for(var s=0;s<r[i].length;s++)for(var a=0;a<e;a++)t.vertices.push(r[i][s][a]);i>0&&t.holes.push(n+=r[i-1].length)}return t};class es{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Xt,this.indexArray=new At,this.indexArray2=new Fr,this.programConfigurations=new hr(e.layers,e.zoom),this.segments=new Oe,this.segments2=new Oe,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.projection=e.projection}populate(e,t,n,i){this.hasPattern=wo("fill",this.layers,t);const s=this.layers[0].layout.get("fill-sort-key"),a=[];for(const{feature:o,id:l,index:u,sourceLayerIndex:c}of e){const p=this.layers[0]._featureFilter.needGeometry,h=mr(o,p);if(!this.layers[0]._featureFilter.filter(new Se(this.zoom),h,n))continue;const f=s?s.evaluate(h,{},n,t.availableImages):void 0,d={id:l,properties:o.properties,type:o.type,sourceLayerIndex:c,index:u,geometry:p?h.geometry:Vt(o,n,i),patterns:{},sortKey:f};a.push(d)}s&&a.sort((o,l)=>o.sortKey-l.sortKey);for(const o of a){const{geometry:l,index:u,sourceLayerIndex:c}=o;if(this.hasPattern){const p=_o("fill",this.layers,o,this.zoom,t);this.patternFeatures.push(p)}else this.addFeature(o,l,u,n,{},t.availableImages);t.featureIndex.insert(e[u].feature,l,u,c,this.index)}}update(e,t,n,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n,i)}addFeatures(e,t,n,i,s){for(const a of this.patternFeatures)this.addFeature(a,a.geometry,a.index,t,n,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bd),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,t,n,i,s,a=[]){for(const o of bo(t,500)){let l=0;for(const d of o)l+=d.length;const u=this.segments.prepareSegment(l,this.layoutVertexArray,this.indexArray),c=u.vertexLength,p=[],h=[];for(const d of o){if(0===d.length)continue;d!==o[0]&&h.push(p.length/2);const y=this.segments2.prepareSegment(d.length,this.layoutVertexArray,this.indexArray2),m=y.vertexLength;this.layoutVertexArray.emplaceBack(d[0].x,d[0].y),this.indexArray2.emplaceBack(m+d.length-1,m),p.push(d[0].x),p.push(d[0].y);for(let g=1;g<d.length;g++)this.layoutVertexArray.emplaceBack(d[g].x,d[g].y),this.indexArray2.emplaceBack(m+g-1,m+g),p.push(d[g].x),p.push(d[g].y);y.vertexLength+=d.length,y.primitiveLength+=d.length}const f=qr(p,h);for(let d=0;d<f.length;d+=3)this.indexArray.emplaceBack(c+f[d],c+f[d+1],c+f[d+2]);u.vertexLength+=l,u.primitiveLength+=f.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,s,a,i)}}U(es,"FillBucket",{omit:["layers","patternFeatures"]});const Ed=new We({"fill-sort-key":new X(T.layout_fill["fill-sort-key"])});var Dd={paint:new We({"fill-antialias":new q(T.paint_fill["fill-antialias"]),"fill-opacity":new X(T.paint_fill["fill-opacity"]),"fill-color":new X(T.paint_fill["fill-color"]),"fill-outline-color":new X(T.paint_fill["fill-outline-color"]),"fill-translate":new q(T.paint_fill["fill-translate"]),"fill-translate-anchor":new q(T.paint_fill["fill-translate-anchor"]),"fill-pattern":new X(T.paint_fill["fill-pattern"])}),layout:Ed};const Vd=be([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Ld=be([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Fd=be([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Rd}=Vd;var ts={},jd=R,Kc=Zr;function Zr(r,e,t,n,i){this.properties={},this.extent=t,this.type=0,this._pbf=r,this._geometry=-1,this._keys=n,this._values=i,r.readFields($d,this,e)}function $d(r,e,t){1==r?e.id=t.readVarint():2==r?function(n,i){for(var s=n.readVarint()+n.pos;n.pos<s;){var a=i._keys[n.readVarint()],o=i._values[n.readVarint()];i.properties[a]=o}}(t,e):3==r?e.type=t.readVarint():4==r&&(e._geometry=t.pos)}function Od(r){for(var e,t,n=0,i=0,s=r.length,a=s-1;i<s;a=i++)n+=((t=r[a]).x-(e=r[i]).x)*(e.y+t.y);return n}Zr.types=["Unknown","Point","LineString","Polygon"],Zr.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var e,t=r.readVarint()+r.pos,n=1,i=0,s=0,a=0,o=[];r.pos<t;){if(i<=0){var l=r.readVarint();n=7&l,i=l>>3}if(i--,1===n||2===n)s+=r.readSVarint(),a+=r.readSVarint(),1===n&&(e&&o.push(e),e=[]),e.push(new jd(s,a));else{if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&o.push(e),o},Zr.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var e=r.readVarint()+r.pos,t=1,n=0,i=0,s=0,a=1/0,o=-1/0,l=1/0,u=-1/0;r.pos<e;){if(n<=0){var c=r.readVarint();t=7&c,n=c>>3}if(n--,1===t||2===t)(i+=r.readSVarint())<a&&(a=i),i>o&&(o=i),(s+=r.readSVarint())<l&&(l=s),s>u&&(u=s);else if(7!==t)throw new Error("unknown command "+t)}return[a,l,o,u]},Zr.prototype.toGeoJSON=function(r,e,t){var n,i,s=this.extent*Math.pow(2,t),a=this.extent*r,o=this.extent*e,l=this.loadGeometry(),u=Zr.types[this.type];function c(f){for(var d=0;d<f.length;d++){var y=f[d];f[d]=[360*(y.x+a)/s-180,360/Math.PI*Math.atan(Math.exp((180-360*(y.y+o)/s)*Math.PI/180))-90]}}switch(this.type){case 1:var p=[];for(n=0;n<l.length;n++)p[n]=l[n][0];c(l=p);break;case 2:for(n=0;n<l.length;n++)c(l[n]);break;case 3:for(l=function(f){var d=f.length;if(d<=1)return[f];for(var y,m,g=[],b=0;b<d;b++){var x=Od(f[b]);0!==x&&(void 0===m&&(m=x<0),m===x<0?(y&&g.push(y),y=[f[b]]):y.push(f[b]))}return y&&g.push(y),g}(l),n=0;n<l.length;n++)for(i=0;i<l[n].length;i++)c(l[n][i])}1===l.length?l=l[0]:u="Multi"+u;var h={type:"Feature",geometry:{type:u,coordinates:l},properties:this.properties};return"id"in this&&(h.id=this.id),h};var Ud=Kc,Jc=Wc;function Wc(r,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(qd,this,e),this.length=this._features.length}function qd(r,e,t){15===r?e.version=t.readVarint():1===r?e.name=t.readString():5===r?e.extent=t.readVarint():2===r?e._features.push(t.pos):3===r?e._keys.push(t.readString()):4===r&&e._values.push(function(n){for(var i=null,s=n.readVarint()+n.pos;n.pos<s;){var a=n.readVarint()>>3;i=1===a?n.readString():2===a?n.readFloat():3===a?n.readDouble():4===a?n.readVarint64():5===a?n.readVarint():6===a?n.readSVarint():7===a?n.readBoolean():null}return i}(t))}Wc.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var e=this._pbf.readVarint()+this._pbf.pos;return new Ud(this._pbf,e,this.extent,this._keys,this._values)};var Nd=Jc;function Zd(r,e,t){if(3===r){var n=new Nd(t,t.readVarint()+t.pos);n.length&&(e[n.name]=n)}}var So=ts.VectorTile=function(r,e){this.layers=r.readFields(Zd,{},e)},rs=ts.VectorTileFeature=Kc;function ns(r,e,t,n){const i=[],s=0===n?(a,o,l,u,c,p)=>{a.push(new R(p,l+(p-o)/(u-o)*(c-l)))}:(a,o,l,u,c,p)=>{a.push(new R(o+(p-l)/(c-l)*(u-o),p))};for(const a of r){const o=[];for(const l of a){if(l.length<=2)continue;const u=[];for(let h=0;h<l.length-1;h++){const f=l[h].x,d=l[h].y,y=l[h+1].x,m=l[h+1].y,g=0===n?f:d,b=0===n?y:m;g<e?b>e&&s(u,f,d,y,m,e):g>t?b<t&&s(u,f,d,y,m,t):u.push(l[h]),b<e&&g>=e&&s(u,f,d,y,m,e),b>t&&g<=t&&s(u,f,d,y,m,t)}let c=l[l.length-1];const p=0===n?c.x:c.y;p>=e&&p<=t&&u.push(c),u.length&&(c=u[u.length-1],u[0].x===c.x&&u[0].y===c.y||u.push(u[0]),o.push(u))}o.length&&i.push(o)}return i}ts.VectorTileLayer=Jc;const Gd=rs.types,Xd=Math.pow(2,13);function En(r,e,t,n,i,s,a,o){r.emplaceBack((e<<1)+a,(t<<1)+s,(Math.floor(n*Xd)<<1)+i,Math.round(o))}function Dn(r,e,t){r.emplaceBack(e.x,e.y,e.z,16384*t[0],16384*t[1],16384*t[2])}class Hc{constructor(){this.acc=new R(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new R(e.x,e.y),this.max=new R(e.x,e.y))}append(e,t){this.currentPolyCount.edges++,this.acc._add(e);const n=this.min,i=this.max;e.x<n.x?n.x=e.x:e.x>i.x&&(i.x=e.x),e.y<n.y?n.y=e.y:e.y>i.y&&(i.y=e.y),((0===e.x||e.x===K)&&e.x===t.x)!=((0===e.y||e.y===K)&&e.y===t.y)&&this.processBorderOverlap(e,t),t.x<0!=e.x<0&&this.addBorderIntersection(0,fe(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>K!=e.x>K&&this.addBorderIntersection(1,fe(t.y,e.y,(K-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,fe(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>K!=e.y>K&&this.addBorderIntersection(3,fe(t.x,e.x,(K-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[e];t<n[0]&&(n[0]=t),t>n[1]&&(n[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const n=0===e.x?0:1;this.addBorderIntersection(n,t.y),this.addBorderIntersection(n,e.y)}else{const n=0===e.y?2:3;this.addBorderIntersection(n,t.x),this.addBorderIntersection(n,e.x)}}centroid(){const e=this.polyCount.reduce((t,n)=>t+n.edges,0);return 0!==e?this.acc.div(e)._round():new R(0,0)}span(){return new R(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,t)=>e+ +(t[0]!==Number.MAX_VALUE),0)}}class is{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new vn,this.centroidVertexArray=new dc,this.indexArray=new At,this.programConfigurations=new hr(e.layers,e.zoom),this.segments=new Oe,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.enableTerrain=e.enableTerrain}populate(e,t,n,i){this.features=[],this.hasPattern=wo("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(s){const a=Math.exp(Math.PI*(1-s.y/(1<<s.z)*2));return 80150034*a/(a*a+1)/K/(1<<s.z)}(n),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:s,id:a,index:o,sourceLayerIndex:l}of e){const u=this.layers[0]._featureFilter.needGeometry,c=mr(s,u);if(!this.layers[0]._featureFilter.filter(new Se(this.zoom),c,n))continue;const p={id:a,sourceLayerIndex:l,index:o,geometry:u?c.geometry:Vt(s,n,i),properties:s.properties,type:s.type,patterns:{}},h=this.layoutVertexArray.length;this.hasPattern?this.features.push(_o("fill-extrusion",this.layers,p,this.zoom,t)):this.addFeature(p,p.geometry,o,n,{},t.availableImages,i),t.featureIndex.insert(s,p.geometry,o,l,this.index,h)}this.sortBorders()}addFeatures(e,t,n,i,s){for(const a of this.features){const{geometry:o}=a;this.addFeature(a,o,a.index,t,n,i,s)}this.sortBorders()}update(e,t,n,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Rd),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Fd.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Ld.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,n,i,s,a,o){const l=[new R(0,0),new R(K,K)],u=o.projection,c="globe"===u.name,p=this.enableTerrain&&!c?new Hc:null,h="Polygon"===Gd[e.type];c&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Vi);const f=bo(t,500);for(let g=f.length-1;g>=0;g--){const b=f[g];(0===b.length||(d=b[0]).every(x=>x.x<=0)||d.every(x=>x.x>=K)||d.every(x=>x.y<=0)||d.every(x=>x.y>=K))&&f.splice(g,1)}var d;let y;if(c)y=ih(f,l,i);else{y=[];for(const g of f)y.push({polygon:g,bounds:l})}const m=h?this.edgeRadius:0;for(const{polygon:g,bounds:b}of y){let x=0,v=0;for(const w of g)h&&!w[0].equals(w[w.length-1])&&w.push(w[0]),v+=h?w.length-1:w.length;const _=this.segments.prepareSegment((h?5:4)*v,this.layoutVertexArray,this.indexArray);if(h){const w=[],A=[];x=_.vertexLength;for(const z of g){let P,k;z.length&&z!==g[0]&&A.push(w.length/2),P=z[1].sub(z[0])._perp()._unit();for(let M=1;M<z.length;M++){const B=z[M],C=z[M===z.length-1?1:M+1];let{x:D,y:I}=B;if(m){k=C.sub(B)._perp()._unit();const F=P.add(k)._unit(),Y=m*Math.min(4,1/(P.x*F.x+P.y*F.y));D+=Y*F.x,I+=Y*F.y,P=k}En(this.layoutVertexArray,D,I,0,0,1,1,0),_.vertexLength++,w.push(B.x,B.y),c&&Dn(this.layoutVertexExtArray,u.projectTilePoint(D,I,i),u.upVector(i,D,I))}}const S=qr(w,A);for(let z=0;z<S.length;z+=3)this.indexArray.emplaceBack(x+S[z],x+S[z+2],x+S[z+1]),_.primitiveLength++}for(const w of g){p&&w.length&&p.startRing(w[0]);let A,S,z,P=w.length>4&&rh(w[w.length-2],w[0],w[1]),k=m?Yd(w[w.length-2],w[0],w[1],m):0;S=w[1].sub(w[0])._perp()._unit();let M=!0;for(let B=1,C=0;B<w.length;B++){let D=w[B-1],I=w[B];const F=w[B===w.length-1?1:B+1];if(p&&h&&p.currentPolyCount.top++,th(I,D,b)){m&&(S=F.sub(I)._perp()._unit(),M=!M);continue}p&&p.append(I,D);const Y=I.sub(D)._perp(),N=Y.x/(Math.abs(Y.x)+Math.abs(Y.y)),L=Y.y>0?1:0,V=D.dist(I);if(C+V>32768&&(C=0),m){z=F.sub(I)._perp()._unit();let J=eh(D,I,F,Qc(S,z),m);isNaN(J)&&(J=0);const ie=I.sub(D)._unit();D=D.add(ie.mult(k))._round(),I=I.add(ie.mult(-J))._round(),k=J,S=z}const G=_.vertexLength,H=w.length>4&&rh(D,I,F);let W=nh(C,P,M);if(En(this.layoutVertexArray,D.x,D.y,N,L,0,0,W),En(this.layoutVertexArray,D.x,D.y,N,L,0,1,W),C+=V,W=nh(C,H,!M),P=H,En(this.layoutVertexArray,I.x,I.y,N,L,0,0,W),En(this.layoutVertexArray,I.x,I.y,N,L,0,1,W),_.vertexLength+=4,this.indexArray.emplaceBack(G+0,G+1,G+2),this.indexArray.emplaceBack(G+1,G+3,G+2),_.primitiveLength+=2,m){const J=x+(1===B?w.length-2:B-2),ie=1===B?x:J+1;if(this.indexArray.emplaceBack(G+1,J,G+3),this.indexArray.emplaceBack(J,ie,G+3),_.primitiveLength+=2,void 0===A&&(A=G),!th(F,w[B],b)){const E=B===w.length-1?A:_.vertexLength;this.indexArray.emplaceBack(G+2,G+3,E),this.indexArray.emplaceBack(G+3,E+1,E),this.indexArray.emplaceBack(G+3,ie,E+1),_.primitiveLength+=3}M=!M}if(c){const J=this.layoutVertexExtArray,ie=u.projectTilePoint(D.x,D.y,i),E=u.projectTilePoint(I.x,I.y,i),O=u.upVector(i,D.x,D.y),Q=u.upVector(i,I.x,I.y);Dn(J,ie,O),Dn(J,ie,O),Dn(J,E,Q),Dn(J,E,Q)}}h&&(x+=w.length-1)}}if(p&&p.polyCount.length>0){if(p.borders){p.vertexArrayOffset=this.centroidVertexArray.length;const g=p.borders,b=this.featuresOnBorder.push(p)-1;for(let x=0;x<4;x++)g[x][0]!==Number.MAX_VALUE&&this.borders[x].push(b)}this.encodeCentroid(p.borders?void 0:p.centroid(),p)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,s,a,i)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((t,n)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[n].borders[e][0])}encodeCentroid(e,t,n=!0){let i,s;if(e)if(0!==e.y){const o=t.span()._mult(this.tileToMeter);i=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(o.x/10)),s=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(o.y/10))}else i=Math.ceil(7*(e.x+450)),s=0;else i=0,s=+n;let a=n?this.centroidVertexArray.length:t.vertexArrayOffset;for(const o of t.polyCount){n&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*o.edges+o.top);for(let l=0;l<o.top;l++)this.centroidVertexArray.emplace(a++,i,s);for(let l=0;l<2*o.edges;l++)this.centroidVertexArray.emplace(a++,0,s),this.centroidVertexArray.emplace(a++,i,s)}}}function Qc(r,e){const t=r.add(e)._unit();return r.x*t.x+r.y*t.y}function Yd(r,e,t,n){const i=e.sub(r)._perp()._unit(),s=t.sub(e)._perp()._unit();return eh(r,e,t,Qc(i,s),n)}function eh(r,e,t,n,i){const s=Math.sqrt(1-n*n);return Math.min(r.dist(e)/3,e.dist(t)/3,i*s/n)}function th(r,e,t){return r.x<t[0].x&&e.x<t[0].x||r.x>t[1].x&&e.x>t[1].x||r.y<t[0].y&&e.y<t[0].y||r.y>t[1].y&&e.y>t[1].y}function rh(r,e,t){if(r.x<0||r.x>=K||e.x<0||e.x>=K||t.x<0||t.x>=K)return!1;const n=t.sub(e),i=n.perp(),s=r.sub(e);return(n.x*s.x+n.y*s.y)/Math.sqrt((n.x*n.x+n.y*n.y)*(s.x*s.x+s.y*s.y))>-.866&&i.x*s.x+i.y*s.y<0}function nh(r,e,t){const n=e?2|r:-3&r;return t?1|n:-2&n}function ih(r,e,t){const n=1<<t.z,i=ot(t.x/n),s=ot((t.x+1)/n),a=qe(t.y/n),o=qe((t.y+1)/n);return function(l,u,c,p,h=0,f){const d=[];if(!l.length||!c||!p)return d;const y=(w,A)=>{for(const S of w)d.push({polygon:S,bounds:A})},m=Math.ceil(Math.log2(c)),g=Math.ceil(Math.log2(p)),b=m-g,x=[];for(let w=0;w<Math.abs(b);w++)x.push(b>0?0:1);for(let w=0;w<Math.min(m,g);w++)x.push(0),x.push(1);let v=l;if(v=ns(v,u[0].y-h,u[1].y+h,1),v=ns(v,u[0].x-h,u[1].x+h,0),!v.length)return d;const _=[];for(x.length?_.push({polygons:v,bounds:u,depth:0}):y(v,u);_.length;){const w=_.pop(),A=w.depth,S=x[A],z=w.bounds[0],P=w.bounds[1],k=0===S?z.x:z.y,M=0===S?P.x:P.y,B=f?f(S,k,M):.5*(k+M),C=ns(w.polygons,k-h,B+h,S),D=ns(w.polygons,B-h,M+h,S);if(C.length){const I=[z,new R(0===S?B:P.x,1===S?B:P.y)];x.length>A+1?_.push({polygons:C,bounds:I,depth:A+1}):y(C,I)}if(D.length){const I=[new R(0===S?B:z.x,1===S?B:z.y),P];x.length>A+1?_.push({polygons:D,bounds:I,depth:A+1}):y(D,I)}}return d}(r,e,Math.ceil((s-i)/11.25),Math.ceil((a-o)/11.25),1,(l,u,c)=>{if(0===l)return.5*(u+c);{const p=qe((t.y+u/K)/n);return(dr(.5*(qe((t.y+c/K)/n)+p))*n-t.y)*K}})}U(is,"FillExtrusionBucket",{omit:["layers","features"]}),U(Hc,"PartMetadata");const Kd=new We({"fill-extrusion-edge-radius":new q(T["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Jd={paint:new We({"fill-extrusion-opacity":new q(T["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new X(T["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new q(T["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new q(T["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new X(T["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new X(T["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new X(T["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new q(T["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new q(T["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new q(T["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:Kd};function sh(r,e,t){var n=2*Math.PI*6378137/256/Math.pow(2,t);return[r*n-2*Math.PI*6378137/2,e*n-2*Math.PI*6378137/2]}class ah{constructor(e,t,n){this.z=e,this.x=t,this.y=n,this.key=Vn(0,e,e,t,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,t){const n=(a=this.y,o=this.z,l=sh(256*(s=this.x),256*(a=Math.pow(2,o)-a-1),o),u=sh(256*(s+1),256*(a+1),o),l[0]+","+l[1]+","+u[0]+","+u[1]),i=function(s,a,o){let l,u="";for(let c=s;c>0;c--)l=1<<c-1,u+=(a&l?1:0)+(o&l?2:0);return u}(this.z,this.x,this.y);var s,a,o,l,u;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",i).replace("{bbox-epsg-3857}",n)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Wd{constructor(e,t){this.wrap=e,this.canonical=t,this.key=Vn(e,t.z,t.z,t.x,t.y)}}class nt{constructor(e,t,n,i,s){this.overscaledZ=e,this.wrap=t,this.canonical=new ah(n,+i,+s),this.key=0===t&&e===n?this.canonical.key:Vn(t,e,n,i,s)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new nt(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new nt(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e,t=!0){if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return Vn(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-e;return Vn(this.wrap*+t,e,e,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new nt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,n=2*this.canonical.x,i=2*this.canonical.y;return[new nt(t,this.wrap,t,n,i),new nt(t,this.wrap,t,n+1,i),new nt(t,this.wrap,t,n,i+1),new nt(t,this.wrap,t,n+1,i+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new nt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new nt(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Wd(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Vn(r,e,t,n,i){const s=1<<Math.min(t,22);let a=s*(i%s)+n%s;return r&&t<22&&(a+=s*s*((r<0?-2*r-1:2*r)%(1<<2*(22-t)))),16*(32*a+t)+(e-t)}U(ah,"CanonicalTileID"),U(nt,"OverscaledTileID",{omit:["projMatrix"]});class Gr extends R{constructor(e,t,n){super(e,t),this.z=n}}function Ln(r,e){return r.x*e.x+r.y*e.y}function oh(r,e){if(1===r.length){let t=0;const n=e[t++];let i;for(;!i||n.equals(i);)if(i=e[t++],!i)return 1/0;for(;t<e.length;t++){const s=e[t],a=r[0],o=i.sub(n),l=s.sub(n),u=a.sub(n),c=Ln(o,o),p=Ln(o,l),h=Ln(l,l),f=Ln(u,o),d=Ln(u,l),y=c*h-p*p,m=(h*f-p*d)/y,g=(c*d-p*f)/y,b=n.z*(1-m-g)+i.z*m+s.z*g;if(isFinite(b))return b}return 1/0}{let t=1/0;for(const n of e)t=Math.min(t,n.z);return t}}function lh(r,e,t,n,i,s,a,o){const l=a*i.getElevationAt(r,e,!0,!0),u=0!==s[0],c=u?0===s[1]?a*(s[0]/7-450):a*function(p,h,f){const d=Math.floor(h[0]/8),y=Math.floor(h[1]/8),m=10*(h[0]-8*d),g=10*(h[1]-8*y),b=p.getElevationAt(d,y,!0,!0),x=p.getMeterToDEM(f),v=Math.floor(.5*(m*x-1)),_=Math.floor(.5*(g*x-1)),w=p.tileCoordToPixel(d,y),A=2*v+1,S=2*_+1,z=(Y=A,N=S,[(D=p).getElevationAtPixel(I=w.x-v,F=w.y-_,!0),D.getElevationAtPixel(I+N,F,!0),D.getElevationAtPixel(I,F+N,!0),D.getElevationAtPixel(I+Y,F+N,!0)]),P=Math.abs(z[0]-z[1]),k=Math.abs(z[2]-z[3]),M=Math.abs(z[0]-z[2])+Math.abs(z[1]-z[3]),B=Math.min(.25,.5*x*(P+k)/A),C=Math.min(.25,.5*x*M/S);var D,I,F,Y,N;return b+Math.max(B*m,C*g)}(i,s,o):l;return{base:l+(0===t)?-1:t,top:u?Math.max(c+n,l+t+2):l+n}}const Hd=be([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Qd}=Hd,ey=be([{name:"a_packed",components:4,type:"Float32"}]),{members:ty}=ey,ry=rs.types,ny=Math.cos(Math.PI/180*37.5);class ss{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(t=>t.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(t=>{this.gradients[t.id]={}}),this.layoutVertexArray=new Fa,this.layoutVertexArray2=new bn,this.indexArray=new At,this.programConfigurations=new hr(e.layers,e.zoom),this.segments=new Oe,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(e,t,n,i){this.hasPattern=wo("line",this.layers,t);const s=this.layers[0].layout.get("line-sort-key"),a=[];for(const{feature:c,id:p,index:h,sourceLayerIndex:f}of e){const d=this.layers[0]._featureFilter.needGeometry,y=mr(c,d);if(!this.layers[0]._featureFilter.filter(new Se(this.zoom),y,n))continue;const m=s?s.evaluate(y,{},n):void 0,g={id:p,properties:c.properties,type:c.type,sourceLayerIndex:f,index:h,geometry:d?y.geometry:Vt(c,n,i),patterns:{},sortKey:m};a.push(g)}s&&a.sort((c,p)=>c.sortKey-p.sortKey);const{lineAtlas:o,featureIndex:l}=t,u=this.addConstantDashes(o);for(const c of a){const{geometry:p,index:h,sourceLayerIndex:f}=c;if(u&&this.addFeatureDashes(c,o),this.hasPattern){const d=_o("line",this.layers,c,this.zoom,t);this.patternFeatures.push(d)}else this.addFeature(c,p,h,n,o.positions,t.availableImages);l.insert(e[h].feature,p,h,f,this.index)}}addConstantDashes(e){let t=!1;for(const n of this.layers){const i=n.paint.get("line-dasharray").value,s=n.layout.get("line-cap").value;if("constant"!==i.kind||"constant"!==s.kind)t=!0;else{const a=s.value,o=i.value;if(!o)continue;e.addDash(o,a)}}return t}addFeatureDashes(e,t){const n=this.zoom;for(const i of this.layers){const s=i.paint.get("line-dasharray").value,a=i.layout.get("line-cap").value;if("constant"===s.kind&&"constant"===a.kind)continue;let o,l;if("constant"===s.kind){if(o=s.value,!o)continue}else o=s.evaluate({zoom:n},e);l="constant"===a.kind?a.value:a.evaluate({zoom:n},e),t.addDash(o,l),e.patterns[i.id]=t.getKey(o,l)}}update(e,t,n,i){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n,i)}addFeatures(e,t,n,i,s){for(const a of this.patternFeatures)this.addFeature(a,a.geometry,a.index,t,n,i)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,ty)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Qd),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,t,n,i,s,a){const o=this.layers[0].layout,l=o.get("line-join").evaluate(e,{}),u=o.get("line-cap").evaluate(e,{}),c=o.get("line-miter-limit"),p=o.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const h of t)this.addLine(h,e,l,u,c,p);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,s,a,i)}addLine(e,t,n,i,s,a){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let g=0;g<e.length-1;g++)this.totalDistance+=e[g].dist(e[g+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const o="Polygon"===ry[t.type];let l=e.length;for(;l>=2&&e[l-1].equals(e[l-2]);)l--;let u=0;for(;u<l-1&&e[u].equals(e[u+1]);)u++;if(l<(o?3:2))return;"bevel"===n&&(s=1.05);const c=this.overscaling<=16?122880/(512*this.overscaling):0,p=this.segments.prepareSegment(10*l,this.layoutVertexArray,this.indexArray);let h,f,d,y,m;this.e1=this.e2=-1,o&&(h=e[l-2],m=e[u].sub(h)._unit()._perp());for(let g=u;g<l;g++){if(d=g===l-1?o?e[u+1]:void 0:e[g+1],d&&e[g].equals(d))continue;m&&(y=m),h&&(f=h),h=e[g],m=d?d.sub(h)._unit()._perp():y,y=y||m;let b=y.add(m);0===b.x&&0===b.y||b._unit();const x=y.x*m.x+y.y*m.y,v=b.x*m.x+b.y*m.y,_=0!==v?1/v:1/0,w=2*Math.sqrt(2-2*v),A=v<ny&&f&&d,S=y.x*m.y-y.y*m.x>0;if(A&&g>u){const k=h.dist(f);if(k>2*c){const M=h.sub(h.sub(f)._mult(c/k)._round());this.updateDistance(f,M),this.addCurrentVertex(M,y,0,0,p),f=M}}const z=f&&d;let P=z?n:o?"butt":i;if(z&&"round"===P&&(_<a?P="miter":_<=2&&(P="fakeround")),"miter"===P&&_>s&&(P="bevel"),"bevel"===P&&(_>2&&(P="flipbevel"),_<s&&(P="miter")),f&&this.updateDistance(f,h),"miter"===P)b._mult(_),this.addCurrentVertex(h,b,0,0,p);else if("flipbevel"===P){if(_>100)b=m.mult(-1);else{const k=_*y.add(m).mag()/y.sub(m).mag();b._perp()._mult(k*(S?-1:1))}this.addCurrentVertex(h,b,0,0,p),this.addCurrentVertex(h,b.mult(-1),0,0,p)}else if("bevel"===P||"fakeround"===P){const k=-Math.sqrt(_*_-1),M=S?k:0,B=S?0:k;if(f&&this.addCurrentVertex(h,y,M,B,p),"fakeround"===P){const C=Math.round(180*w/Math.PI/20);for(let D=1;D<C;D++){let I=D/C;if(.5!==I){const Y=I-.5;I+=I*Y*(I-1)*((1.0904+x*(x*(3.55645-1.43519*x)-3.2452))*Y*Y+(.848013+x*(.215638*x-1.06021)))}const F=m.sub(y)._mult(I)._add(y)._unit()._mult(S?-1:1);this.addHalfVertex(h,F.x,F.y,!1,S,0,p)}}d&&this.addCurrentVertex(h,m,-M,-B,p)}else if("butt"===P)this.addCurrentVertex(h,b,0,0,p);else if("square"===P){const k=f?1:-1;f||this.addCurrentVertex(h,b,k,k,p),this.addCurrentVertex(h,b,0,0,p),f&&this.addCurrentVertex(h,b,k,k,p)}else"round"===P&&(f&&(this.addCurrentVertex(h,y,0,0,p),this.addCurrentVertex(h,y,1,1,p,!0)),d&&(this.addCurrentVertex(h,m,-1,-1,p,!0),this.addCurrentVertex(h,m,0,0,p)));if(A&&g<l-1){const k=h.dist(d);if(k>2*c){const M=h.add(d.sub(h)._mult(c/k)._round());this.updateDistance(h,M),this.addCurrentVertex(M,m,0,0,p),h=M}}}}addCurrentVertex(e,t,n,i,s,a=!1){const o=t.y*i-t.x,l=-t.y-t.x*i;this.addHalfVertex(e,t.x+t.y*n,t.y-t.x*n,a,!1,n,s),this.addHalfVertex(e,o,l,a,!0,-i,s)}addHalfVertex({x:e,y:t},n,i,s,a,o,l){this.layoutVertexArray.emplaceBack((e<<1)+(s?1:0),(t<<1)+(a?1:0),Math.round(63*n)+128,Math.round(63*i)+128,1+(0===o?0:o<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const u=l.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,u),l.primitiveLength++),a?this.e2=u:this.e1=u}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}U(ss,"LineBucket",{omit:["layers","patternFeatures"]});const iy=new We({"line-cap":new X(T.layout_line["line-cap"]),"line-join":new X(T.layout_line["line-join"]),"line-miter-limit":new q(T.layout_line["line-miter-limit"]),"line-round-limit":new q(T.layout_line["line-round-limit"]),"line-sort-key":new X(T.layout_line["line-sort-key"])});var uh={paint:new We({"line-opacity":new X(T.paint_line["line-opacity"]),"line-color":new X(T.paint_line["line-color"]),"line-translate":new q(T.paint_line["line-translate"]),"line-translate-anchor":new q(T.paint_line["line-translate-anchor"]),"line-width":new X(T.paint_line["line-width"]),"line-gap-width":new X(T.paint_line["line-gap-width"]),"line-offset":new X(T.paint_line["line-offset"]),"line-blur":new X(T.paint_line["line-blur"]),"line-dasharray":new X(T.paint_line["line-dasharray"]),"line-pattern":new X(T.paint_line["line-pattern"]),"line-gradient":new Ci(T.paint_line["line-gradient"]),"line-trim-offset":new q(T.paint_line["line-trim-offset"])}),layout:iy};const ch=new class extends X{constructor(...e){super(...e),ge(this,"useIntegerZoom",!0)}possiblyEvaluate(e,t){return t=new Se(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,n,i){return t=Re({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,n,i)}}(uh.paint.properties["line-width"].specification);function hh(r,e){return e>0?e+2*r:r}ch.useIntegerZoom=!0;const sy=be([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ay=be([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),oy=be([{name:"a_projected_pos",components:4,type:"Float32"}],4);be([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ly=be([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),uy=be([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);be([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ph=be([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4);be([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4),be([{name:"triangle",components:3,type:"Uint16"}]),be([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),be([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),be([{type:"Float32",name:"offsetX"}]),be([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);const Lt=128;function fh(r,e){const{expression:t}=e;if("constant"===t.kind)return{kind:"constant",layoutSize:t.evaluate(new Se(r+1))};if("source"===t.kind)return{kind:"source"};{const{zoomStops:n,interpolationType:i}=t;let s=0;for(;s<n.length&&n[s]<=r;)s++;s=Math.max(0,s-1);let a=s;for(;a<n.length&&n[a]<r+1;)a++;a=Math.min(n.length-1,a);const o=n[s],l=n[a];return"composite"===t.kind?{kind:"composite",minZoom:o,maxZoom:l,interpolationType:i}:{kind:"camera",minZoom:o,maxZoom:l,minSize:t.evaluate(new Se(o)),maxSize:t.evaluate(new Se(l)),interpolationType:i}}}function dh(r,{uSize:e,uSizeT:t},{lowerSize:n,upperSize:i}){return"source"===r.kind?n/Lt:"composite"===r.kind?fe(n/Lt,i/Lt,t):e}function as(r,e){let t=0,n=0;if("constant"===r.kind)n=r.layoutSize;else if("source"!==r.kind){const{interpolationType:i,minZoom:s,maxZoom:a}=r,o=i?ue(St.interpolationFactor(i,e,s,a),0,1):0;"camera"===r.kind?n=fe(r.minSize,r.maxSize,o):t=o}return{uSizeT:t,uSize:n}}function cy(r,e,t){return r.sections.forEach(n=>{n.text=function(i,s,a){const o=s.layout.get("text-transform").evaluate(a,{});return"uppercase"===o?i=i.toLocaleUpperCase():"lowercase"===o&&(i=i.toLocaleLowerCase()),Le.applyArabicShaping&&(i=Le.applyArabicShaping(i)),i}(n.text,e,t)}),r}const Fn={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function hy(r){return"\ufe36"===r||"\ufe48"===r||"\ufe38"===r||"\ufe44"===r||"\ufe42"===r||"\ufe3e"===r||"\ufe3c"===r||"\ufe3a"===r||"\ufe18"===r||"\ufe40"===r||"\ufe10"===r||"\ufe13"===r||"\ufe14"===r||"\uff40"===r||"\uffe3"===r||"\ufe11"===r||"\ufe12"===r}function py(r){return"\ufe35"===r||"\ufe47"===r||"\ufe37"===r||"\ufe43"===r||"\ufe41"===r||"\ufe3d"===r||"\ufe3b"===r||"\ufe39"===r||"\ufe17"===r||"\ufe3f"===r}var os=de,yh=function(r,e,t,n,i){var s,a,o=8*i-n-1,l=(1<<o)-1,u=l>>1,c=-7,p=t?i-1:0,h=t?-1:1,f=r[e+p];for(p+=h,s=f&(1<<-c)-1,f>>=-c,c+=o;c>0;s=256*s+r[e+p],p+=h,c-=8);for(a=s&(1<<-c)-1,s>>=-c,c+=n;c>0;a=256*a+r[e+p],p+=h,c-=8);if(0===s)s=1-u;else{if(s===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,n),s-=u}return(f?-1:1)*a*Math.pow(2,s-n)},mh=function(r,e,t,n,i,s){var a,o,l,u=8*s-i-1,c=(1<<u)-1,p=c>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:s-1,d=n?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-a))<1&&(a--,l*=2),(e+=a+p>=1?h/l:h*Math.pow(2,1-p))*l>=2&&(a++,l/=2),a+p>=c?(o=0,a=c):a+p>=1?(o=(e*l-1)*Math.pow(2,i),a+=p):(o=e*Math.pow(2,p-1)*Math.pow(2,i),a=0));i>=8;r[t+f]=255&o,f+=d,o/=256,i-=8);for(a=a<<i|o,u+=i;u>0;r[t+f]=255&a,f+=d,a/=256,u-=8);r[t+f-d]|=128*y};function de(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}de.Varint=0,de.Fixed64=1,de.Bytes=2,de.Fixed32=5;var Ao=4294967296,gh=1/Ao,xh=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ft(r){return r.type===de.Bytes?r.readVarint()+r.pos:r.pos+1}function vh(r,e,t){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));t.realloc(n);for(var i=t.pos-1;i>=r;i--)t.buf[i+n]=t.buf[i]}function fy(r,e){for(var t=0;t<r.length;t++)e.writeVarint(r[t])}function dy(r,e){for(var t=0;t<r.length;t++)e.writeSVarint(r[t])}function yy(r,e){for(var t=0;t<r.length;t++)e.writeFloat(r[t])}function my(r,e){for(var t=0;t<r.length;t++)e.writeDouble(r[t])}function gy(r,e){for(var t=0;t<r.length;t++)e.writeBoolean(r[t])}function xy(r,e){for(var t=0;t<r.length;t++)e.writeFixed32(r[t])}function vy(r,e){for(var t=0;t<r.length;t++)e.writeSFixed32(r[t])}function by(r,e){for(var t=0;t<r.length;t++)e.writeFixed64(r[t])}function wy(r,e){for(var t=0;t<r.length;t++)e.writeSFixed64(r[t])}function ls(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+16777216*r[e+3]}function Yr(r,e,t){r[t]=e,r[t+1]=e>>>8,r[t+2]=e>>>16,r[t+3]=e>>>24}function bh(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}function wh(r){let e=0,t=0;for(const a of r)e+=a.w*a.h,t=Math.max(t,a.w);r.sort((a,o)=>o.h-a.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),t),h:1/0}];let i=0,s=0;for(const a of r)for(let o=n.length-1;o>=0;o--){const l=n[o];if(!(a.w>l.w||a.h>l.h)){if(a.x=l.x,a.y=l.y,s=Math.max(s,a.y+a.h),i=Math.max(i,a.x+a.w),a.w===l.w&&a.h===l.h){const u=n.pop();o<n.length&&(n[o]=u)}else a.h===l.h?(l.x+=a.w,l.w-=a.w):a.w===l.w?(l.y+=a.h,l.h-=a.h):(n.push({x:l.x+a.w,y:l.y,w:l.w-a.w,h:a.h}),l.y+=a.h,l.h-=a.h);break}}return{w:i,h:s,fill:e/(i*s)||0}}de.prototype={destroy:function(){this.buf=null},readFields:function(r,e,t){for(t=t||this.length;this.pos<t;){var n=this.readVarint(),i=n>>3,s=this.pos;this.type=7&n,r(i,e,this),this.pos===s&&this.skip(n)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=ls(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=bh(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=ls(this.buf,this.pos)+ls(this.buf,this.pos+4)*Ao;return this.pos+=8,r},readSFixed64:function(){var r=ls(this.buf,this.pos)+bh(this.buf,this.pos+4)*Ao;return this.pos+=8,r},readFloat:function(){var r=yh(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=yh(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e,t,n=this.buf;return e=127&(t=n[this.pos++]),t<128?e:(e|=(127&(t=n[this.pos++]))<<7,t<128?e:(e|=(127&(t=n[this.pos++]))<<14,t<128?e:(e|=(127&(t=n[this.pos++]))<<21,t<128?e:function(i,s,a){var o,l,u=a.buf;if(o=(112&(l=u[a.pos++]))>>4,l<128||(o|=(127&(l=u[a.pos++]))<<3,l<128)||(o|=(127&(l=u[a.pos++]))<<10,l<128)||(o|=(127&(l=u[a.pos++]))<<17,l<128)||(o|=(127&(l=u[a.pos++]))<<24,l<128)||(o|=(1&(l=u[a.pos++]))<<31,l<128))return function Xr(r,e,t){return t?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}(i,o,s);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(t=n[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&xh?xh.decode(this.buf.subarray(e,r)):function(t,n,i){for(var s="",a=n;a<i;){var o,l,u,c=t[a],p=null,h=c>239?4:c>223?3:c>191?2:1;if(a+h>i)break;1===h?c<128&&(p=c):2===h?128==(192&(o=t[a+1]))&&(p=(31&c)<<6|63&o)<=127&&(p=null):3===h?(l=t[a+2],128==(192&(o=t[a+1]))&&128==(192&l)&&((p=(15&c)<<12|(63&o)<<6|63&l)<=2047||p>=55296&&p<=57343)&&(p=null)):4===h&&(l=t[a+2],u=t[a+3],128==(192&(o=t[a+1]))&&128==(192&l)&&128==(192&u)&&((p=(15&c)<<18|(63&o)<<12|(63&l)<<6|63&u)<=65535||p>=1114112)&&(p=null)),null===p?(p=65533,h=1):p>65535&&(p-=65536,s+=String.fromCharCode(p>>>10&1023|55296),p=56320|1023&p),s+=String.fromCharCode(p),a+=h}return s}(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==de.Bytes)return r.push(this.readVarint(e));var t=Ft(this);for(r=r||[];this.pos<t;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==de.Bytes)return r.push(this.readSVarint());var e=Ft(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==de.Bytes)return r.push(this.readBoolean());var e=Ft(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==de.Bytes)return r.push(this.readFloat());var e=Ft(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==de.Bytes)return r.push(this.readDouble());var e=Ft(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==de.Bytes)return r.push(this.readFixed32());var e=Ft(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==de.Bytes)return r.push(this.readSFixed32());var e=Ft(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==de.Bytes)return r.push(this.readFixed64());var e=Ft(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==de.Bytes)return r.push(this.readSFixed64());var e=Ft(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=7&r;if(e===de.Varint)for(;this.buf[this.pos++]>127;);else if(e===de.Bytes)this.pos=this.readVarint()+this.pos;else if(e===de.Fixed32)this.pos+=4;else{if(e!==de.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var t=new Uint8Array(e);t.set(this.buf),this.buf=t,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),Yr(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),Yr(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),Yr(this.buf,-1&r,this.pos),Yr(this.buf,Math.floor(r*gh),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),Yr(this.buf,-1&r,this.pos),Yr(this.buf,Math.floor(r*gh),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(e,t){var n,i,s,o;if(e>=0?(n=e%4294967296|0,i=e/4294967296|0):(i=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,i=i+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),s=n,(o=t).buf[o.pos++]=127&s|128,s>>>=7,o.buf[o.pos++]=127&s|128,s>>>=7,o.buf[o.pos++]=127&s|128,s>>>=7,o.buf[o.pos++]=127&s|128,o.buf[o.pos]=127&(s>>>=7),function(s,a){var o=(7&s)<<4;a.buf[a.pos++]|=o|((s>>>=3)?128:0),s&&(a.buf[a.pos++]=127&s|((s>>>=7)?128:0),s&&(a.buf[a.pos++]=127&s|((s>>>=7)?128:0),s&&(a.buf[a.pos++]=127&s|((s>>>=7)?128:0),s&&(a.buf[a.pos++]=127&s|((s>>>=7)?128:0),s&&(a.buf[a.pos++]=127&s)))))}(i,t)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(Boolean(r))},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var e=this.pos;this.pos=function(n,i,s){for(var a,o,l=0;l<i.length;l++){if((a=i.charCodeAt(l))>55295&&a<57344){if(!o){a>56319||l+1===i.length?(n[s++]=239,n[s++]=191,n[s++]=189):o=a;continue}if(a<56320){n[s++]=239,n[s++]=191,n[s++]=189,o=a;continue}a=o-55296<<10|a-56320|65536,o=null}else o&&(n[s++]=239,n[s++]=191,n[s++]=189,o=null);a<128?n[s++]=a:(a<2048?n[s++]=a>>6|192:(a<65536?n[s++]=a>>12|224:(n[s++]=a>>18|240,n[s++]=a>>12&63|128),n[s++]=a>>6&63|128),n[s++]=63&a|128)}return s}(this.buf,r,this.pos);var t=this.pos-e;t>=128&&vh(e,t,this),this.pos=e-1,this.writeVarint(t),this.pos+=t},writeFloat:function(r){this.realloc(4),mh(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),mh(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var t=0;t<e;t++)this.buf[this.pos++]=r[t]},writeRawMessage:function(r,e){this.pos++;var t=this.pos;r(e,this);var n=this.pos-t;n>=128&&vh(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeMessage:function(r,e,t){this.writeTag(r,de.Bytes),this.writeRawMessage(e,t)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,fy,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,dy,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,gy,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,yy,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,my,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,xy,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,vy,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,by,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,wy,e)},writeBytesField:function(r,e){this.writeTag(r,de.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,de.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,de.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,de.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,de.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,de.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,de.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,de.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,de.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,de.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,Boolean(e))}};class _h{constructor(e,{pixelRatio:t,version:n,stretchX:i,stretchY:s,content:a}){this.paddedRect=e,this.pixelRatio=t,this.stretchX=i,this.stretchY=s,this.content=a,this.version=n}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Sh{constructor(e,t){const n={},i={};this.haveRenderCallbacks=[];const s=[];this.addImages(e,n,s),this.addImages(t,i,s);const{w:a,h:o}=wh(s),l=new rt({width:a||1,height:o||1});for(const u in e){const c=e[u],p=n[u].paddedRect;rt.copy(c.data,l,{x:0,y:0},{x:p.x+1,y:p.y+1},c.data)}for(const u in t){const c=t[u],p=i[u].paddedRect,h=p.x+1,f=p.y+1,d=c.data.width,y=c.data.height;rt.copy(c.data,l,{x:0,y:0},{x:h,y:f},c.data),rt.copy(c.data,l,{x:0,y:y-1},{x:h,y:f-1},{width:d,height:1}),rt.copy(c.data,l,{x:0,y:0},{x:h,y:f+y},{width:d,height:1}),rt.copy(c.data,l,{x:d-1,y:0},{x:h-1,y:f},{width:1,height:y}),rt.copy(c.data,l,{x:0,y:0},{x:h+d,y:f},{width:1,height:y})}this.image=l,this.iconPositions=n,this.patternPositions=i}addImages(e,t,n){for(const i in e){const s=e[i],a={x:0,y:0,w:s.data.width+2,h:s.data.height+2};n.push(a),t[i]=new _h(a,s),s.hasRenderCallback&&this.haveRenderCallbacks.push(i)}}patchUpdatedImages(e,t){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(n=>e.hasImage(n)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),t),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),t)}patchUpdatedImage(e,t,n){if(!e||!t||e.version===t.version)return;e.version=t.version;const[i,s]=e.tl;n.update(t.data,void 0,{x:i,y:s})}}U(_h,"ImagePosition"),U(Sh,"ImageAtlas");const lt={horizontal:1,vertical:2,horizontalOnly:3};class Rn{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,t){const n=new Rn;return n.scale=e||1,n.fontStack=t,n}static forImage(e){const t=new Rn;return t.imageName=e,t}}class Kr{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t){const n=new Kr;for(let i=0;i<e.sections.length;i++){const s=e.sections[i];s.image?n.addImageSection(s):n.addTextSection(s,t)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(t,n){let i="";for(let s=0;s<t.length;s++){const a=t.charCodeAt(s+1)||null,o=t.charCodeAt(s-1)||null;i+=!n&&(a&&Xu(a)&&!Fn[t[s+1]]||o&&Xu(o)&&!Fn[t[s-1]])||!Fn[t[s]]?t[s]:Fn[t[s]]}return i}(this.text,e)}trim(){let e=0;for(let n=0;n<this.text.length&&us[this.text.charCodeAt(n)];n++)e++;let t=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&us[this.text.charCodeAt(n)];n--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const n=new Kr;return n.text=this.text.substring(e,t),n.sectionIndex=this.sectionIndex.slice(e,t),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,t)=>Math.max(e,this.sections[t].scale),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(Rn.forText(e.scale,e.fontStack||t));const n=this.sections.length-1;for(let i=0;i<e.text.length;++i)this.sectionIndex.push(n)}addImageSection(e){const t=e.image?e.image.name:"";if(0===t.length)return void Ee("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(Rn.forImage(t)),this.sectionIndex.push(this.sections.length-1)):Ee("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ko(r,e,t,n,i,s,a,o,l,u,c,p,h,f,d){const y=Kr.fromFeature(r,i);p===lt.vertical&&y.verticalizePunctuation(h);let m=[];const g=function(w,A,S,z,P,k){if(!w)return[];const M=[],B=function(F,Y,N,L,V,G){let H=0;for(let W=0;W<F.length();W++){const J=F.getSection(W);H+=Ah(F.getCharCode(W),J,L,V,Y,G)}return H/Math.max(1,Math.ceil(H/N))}(w,A,S,z,P,k),C=w.text.indexOf("\u200b")>=0;let D=0;for(let F=0;F<w.length();F++){const Y=w.getSection(F),N=w.getCharCode(F);if(us[N]||(D+=Ah(N,Y,z,P,A,k)),F<w.length()-1){const L=!((I=N)<11904||!(Vu(I)||Du(I)||Ba(I)||Nu(I)||ju(I)||Bu(I)||Lu(I)||Ma(I)||$u(I)||Ou(I)||Ru(I)||Pa(I)||Eu(I)||Pu(I)||Cu(I)||Fu(I)||Ta(I)||Zu(I)||qu(I)||Uu(I)));(_y[N]||L||Y.imageName)&&M.push(Ih(F+1,D,B,M,Sy(N,w.getCharCode(F+1),L&&C),!1))}}var I;return Mh(Ih(w.length(),D,B,M,0,!0))}(y,u,s,e,n,f),{processBidirectionalText:b,processStyledBidirectionalText:x}=Le;if(b&&1===y.sections.length){const w=b(y.toString(),g);for(const A of w){const S=new Kr;S.text=A,S.sections=y.sections;for(let z=0;z<A.length;z++)S.sectionIndex.push(0);m.push(S)}}else if(x){const w=x(y.text,y.sectionIndex,g);for(const A of w){const S=new Kr;S.text=A[0],S.sectionIndex=A[1],S.sections=y.sections,m.push(S)}}else m=function(w,A){const S=[],z=w.text;let P=0;for(const k of A)S.push(w.substring(P,k)),P=k;return P<z.length&&S.push(w.substring(P,z.length)),S}(y,g);const v=[],_={positionedLines:v,text:y.toString(),top:c[1],bottom:c[1],left:c[0],right:c[0],writingMode:p,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(w,A,S,z,P,k,M,B,C,D,I,F){let Y=0,N=0,L=0;const V="right"===B?1:"left"===B?0:.5;let G=!1;for(const O of P){const Q=O.getSections();for(const le of Q){if(le.imageName)continue;const ye=A[le.fontStack];if(ye&&(G=void 0!==ye.ascender&&void 0!==ye.descender,!G))break}if(!G)break}let H=0;for(const O of P){O.trim();const Q=O.getMaxScale(),le=24*(Q-1),ye={positionedGlyphs:[],lineOffset:0};w.positionedLines[H]=ye;const he=ye.positionedGlyphs;let _e=0;if(!O.length()){N+=k,++H;continue}let pe=0,we=0;for(let se=0;se<O.length();se++){const ze=O.getSection(se),Ke=O.getSectionIndex(se),re=O.getCharCode(se);let xe=ze.scale,Ce=null,ce=null,ve=null,Ze=24,je=0;const Ge=!(C===lt.horizontal||!I&&!Da(re)||I&&(us[re]||(W=re,Mu(W)||Tu(W)||zu(W)||za(W)||Ca(W))));if(ze.imageName){const Fe=z[ze.imageName];if(!Fe)continue;ve=ze.imageName,w.iconsInText=w.iconsInText||!0,ce=Fe.paddedRect;const $e=Fe.displaySize;xe=24*xe/F,Ce={width:$e[0],height:$e[1],left:1,top:-3,advance:Ge?$e[1]:$e[0],localGlyph:!1},je=G?-Ce.height*xe:24*Q-17-$e[1]*xe,Ze=Ce.advance;const Ot=(Ge?$e[0]:$e[1])*xe-24*Q;Ot>0&&Ot>_e&&(_e=Ot)}else{const Fe=S[ze.fontStack];if(!Fe)continue;Fe[re]&&(ce=Fe[re]);const $e=A[ze.fontStack];if(!$e)continue;const Ot=$e.glyphs[re];if(!Ot)continue;if(Ce=Ot.metrics,Ze=8203!==re?24:0,G){const en=void 0!==$e.ascender?Math.abs($e.ascender):0,Yn=void 0!==$e.descender?Math.abs($e.descender):0,Kn=(en+Yn)*xe;pe<Kn&&(pe=Kn,we=(en-Yn)/2*xe),je=-en*xe}else je=24*(Q-xe)-17}Ge?(w.verticalizable=!0,he.push({glyph:re,imageName:ve,x:Y,y:N+je,vertical:Ge,scale:xe,localGlyph:Ce.localGlyph,fontStack:ze.fontStack,sectionIndex:Ke,metrics:Ce,rect:ce}),Y+=Ze*xe+D):(he.push({glyph:re,imageName:ve,x:Y,y:N+je,vertical:Ge,scale:xe,localGlyph:Ce.localGlyph,fontStack:ze.fontStack,sectionIndex:Ke,metrics:Ce,rect:ce}),Y+=Ce.advance*xe+D)}0!==he.length&&(L=Math.max(Y-D,L),G?zh(he,V,_e,we,k*Q/2):zh(he,V,_e,0,k/2)),Y=0;const Ie=k*Q+_e;ye.lineOffset=Math.max(_e,le),N+=Ie,++H}var W;const J=N,{horizontalAlign:ie,verticalAlign:E}=Th(M);(function(O,Q,le,ye,he,_e){const pe=(Q-le)*he,we=-_e*ye;for(const Ie of O)for(const se of Ie.positionedGlyphs)se.x+=pe,se.y+=we})(w.positionedLines,V,ie,E,L,J),w.top+=-E*J,w.bottom=w.top+J,w.left+=-ie*L,w.right=w.left+L,w.hasBaseline=G}(_,e,t,n,m,a,o,l,p,u,h,d),!function(w){for(const A of w)if(0!==A.positionedGlyphs.length)return!1;return!0}(v)&&_}const us={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},_y={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ah(r,e,t,n,i,s){if(e.imageName){const a=n[e.imageName];return a?a.displaySize[0]*e.scale*24/s+i:0}{const a=t[e.fontStack],o=a&&a.glyphs[r];return o?o.metrics.advance*e.scale+i:0}}function kh(r,e,t,n){const i=Math.pow(r-e,2);return n?r<e?i/2:2*i:i+Math.abs(t)*t}function Sy(r,e,t){let n=0;return 10===r&&(n-=1e4),t&&(n+=150),40!==r&&65288!==r||(n+=50),41!==e&&65289!==e||(n+=50),n}function Ih(r,e,t,n,i,s){let a=null,o=kh(e,t,i,s);for(const l of n){const u=kh(e-l.x,t,i,s)+l.badness;u<=o&&(a=l,o=u)}return{index:r,x:e,priorBreak:a,badness:o}}function Mh(r){return r?Mh(r.priorBreak).concat(r.index):[]}function Th(r){let e=.5,t=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0}return{horizontalAlign:e,verticalAlign:t}}function zh(r,e,t,n,i){if(!(e||t||n||i))return;const s=r.length-1,a=r[s],o=(a.x+a.metrics.advance*a.scale)*e;for(let l=0;l<=s;l++)r[l].x-=o,r[l].y+=t+n+i}function Ay(r,e,t){const{horizontalAlign:n,verticalAlign:i}=Th(t),s=e[0]-r.displaySize[0]*n,a=e[1]-r.displaySize[1]*i;return{image:r,top:a,bottom:a+r.displaySize[1],left:s,right:s+r.displaySize[0]}}function Bh(r,e,t,n,i,s){const a=r.image;let o;if(a.content){const m=a.content,g=a.pixelRatio||1;o=[m[0]/g,m[1]/g,a.displaySize[0]-m[2]/g,a.displaySize[1]-m[3]/g]}const l=e.left*s,u=e.right*s;let c,p,h,f;"width"===t||"both"===t?(f=i[0]+l-n[3],p=i[0]+u+n[1]):(f=i[0]+(l+u-a.displaySize[0])/2,p=f+a.displaySize[0]);const d=e.top*s,y=e.bottom*s;return"height"===t||"both"===t?(c=i[1]+d-n[0],h=i[1]+y+n[2]):(c=i[1]+(d+y-a.displaySize[1])/2,h=c+a.displaySize[1]),{image:a,top:c,right:p,bottom:h,left:f,collisionPadding:o}}class Rt extends R{constructor(e,t,n,i,s){super(e,t),this.angle=i,this.z=n,void 0!==s&&(this.segment=s)}clone(){return new Rt(this.x,this.y,this.z,this.angle,this.segment)}}function Ch(r,e,t,n,i){if(void 0===e.segment)return!0;let s=e,a=e.segment+1,o=0;for(;o>-t/2;){if(a--,a<0)return!1;o-=r[a].dist(s),s=r[a]}o+=r[a].dist(r[a+1]),a++;const l=[];let u=0;for(;o<t/2;){const c=r[a],p=r[a+1];if(!p)return!1;let h=r[a-1].angleTo(c)-c.angleTo(p);for(h=Math.abs((h+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:o,angleDelta:h}),u+=h;o-l[0].distance>n;)u-=l.shift().angleDelta;if(u>i)return!1;a++,o+=c.dist(p)}return!0}function Ph(r){let e=0;for(let t=0;t<r.length-1;t++)e+=r[t].dist(r[t+1]);return e}function Eh(r,e,t){return r?.6*e*t:0}function Dh(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function ky(r,e,t,n,i,s){const a=Eh(t,i,s),o=Dh(t,n)*s;let l=0;const u=Ph(r)/2;for(let c=0;c<r.length-1;c++){const p=r[c],h=r[c+1],f=p.dist(h);if(l+f>u){const d=(u-l)/f,y=fe(p.x,h.x,d),m=fe(p.y,h.y,d),g=new Rt(y,m,0,h.angleTo(p),c);return!a||Ch(r,g,o,a,e)?g:void 0}l+=f}}function Iy(r,e,t,n,i,s,a,o,l){const u=Eh(n,s,a),c=Dh(n,i),p=c*a,h=0===r[0].x||r[0].x===l||0===r[0].y||r[0].y===l;return e-p<e/4&&(e=p+e/4),Vh(r,h?e/2*o%e:(c/2+2*s)*a*o%e,e,u,t,p,h,!1,l)}function Vh(r,e,t,n,i,s,a,o,l){const u=s/2,c=Ph(r);let p=0,h=e-t,f=[];for(let d=0;d<r.length-1;d++){const y=r[d],m=r[d+1],g=y.dist(m),b=m.angleTo(y);for(;h+t<p+g;){h+=t;const x=(h-p)/g,v=fe(y.x,m.x,x),_=fe(y.y,m.y,x);if(v>=0&&v<l&&_>=0&&_<l&&h-u>=0&&h+u<=c){const w=new Rt(v,_,0,b,d);w._round(),n&&!Ch(r,w,s,n,i)||f.push(w)}}p+=g}return o||f.length||a||(f=Vh(r,p/2,t,n,i,s,a,!0,l)),f}function Lh(r,e,t,n){const i=[],s=r.image,a=s.pixelRatio,o=s.paddedRect.w-2,l=s.paddedRect.h-2,u=r.right-r.left,c=r.bottom-r.top,p=s.stretchX||[[0,o]],h=s.stretchY||[[0,l]],f=(k,M)=>k+M[1]-M[0],d=p.reduce(f,0),y=h.reduce(f,0),m=o-d,g=l-y;let b=0,x=d,v=0,_=y,w=0,A=m,S=0,z=g;if(s.content&&n){const k=s.content;b=cs(p,0,k[0]),v=cs(h,0,k[1]),x=cs(p,k[0],k[2]),_=cs(h,k[1],k[3]),w=k[0]-b,S=k[1]-v,A=k[2]-k[0]-x,z=k[3]-k[1]-_}const P=(k,M,B,C)=>{const D=hs(k.stretch-b,x,u,r.left),I=ps(k.fixed-w,A,k.stretch,d),F=hs(M.stretch-v,_,c,r.top),Y=ps(M.fixed-S,z,M.stretch,y),N=hs(B.stretch-b,x,u,r.left),L=ps(B.fixed-w,A,B.stretch,d),V=hs(C.stretch-v,_,c,r.top),G=ps(C.fixed-S,z,C.stretch,y),H=new R(D,F),W=new R(N,F),J=new R(N,V),ie=new R(D,V),E=new R(I/a,Y/a),O=new R(L/a,G/a),Q=e*Math.PI/180;if(Q){const he=Math.sin(Q),_e=Math.cos(Q),pe=[_e,-he,he,_e];H._matMult(pe),W._matMult(pe),ie._matMult(pe),J._matMult(pe)}const le=k.stretch+k.fixed,ye=M.stretch+M.fixed;return{tl:H,tr:W,bl:ie,br:J,tex:{x:s.paddedRect.x+1+le,y:s.paddedRect.y+1+ye,w:B.stretch+B.fixed-le,h:C.stretch+C.fixed-ye},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:E,pixelOffsetBR:O,minFontScaleX:A/a/u,minFontScaleY:z/a/c,isSDF:t}};if(n&&(s.stretchX||s.stretchY)){const k=Fh(p,m,d),M=Fh(h,g,y);for(let B=0;B<k.length-1;B++){const C=k[B],D=k[B+1];for(let I=0;I<M.length-1;I++)i.push(P(C,M[I],D,M[I+1]))}}else i.push(P({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:o+1},{fixed:0,stretch:l+1}));return i}function cs(r,e,t){let n=0;for(const i of r)n+=Math.max(e,Math.min(t,i[1]))-Math.max(e,Math.min(t,i[0]));return n}function Fh(r,e,t){const n=[{fixed:-1,stretch:0}];for(const[i,s]of r){const a=n[n.length-1];n.push({fixed:i-a.stretch,stretch:a.stretch}),n.push({fixed:i-a.stretch,stretch:a.stretch+(s-i)})}return n.push({fixed:e+1,stretch:t}),n}function hs(r,e,t,n){return r/e*t+n}function ps(r,e,t,n){return r-e*t/n}function My(r,e,t,n){const i=e+r.positionedLines[n].lineOffset;return 0===n?t+i/2:t+(i+(e+r.positionedLines[n-1].lineOffset))/2}U(Rt,"Anchor");class Ty{constructor(e=[],t=zy){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,i=t[e];for(;e>0;){const s=e-1>>1,a=t[s];if(n(i,a)>=0)break;t[e]=a,e=s}t[e]=i}_down(e){const{data:t,compare:n}=this,i=this.length>>1,s=t[e];for(;e<i;){let a=1+(e<<1),o=t[a];const l=a+1;if(l<this.length&&n(t[l],o)<0&&(a=l,o=t[l]),n(o,s)>=0)break;t[e]=o,e=a}t[e]=s}}function zy(r,e){return r<e?-1:r>e?1:0}function By(r,e=1,t=!1){let n=1/0,i=1/0,s=-1/0,a=-1/0;const o=r[0];for(let f=0;f<o.length;f++){const d=o[f];(!f||d.x<n)&&(n=d.x),(!f||d.y<i)&&(i=d.y),(!f||d.x>s)&&(s=d.x),(!f||d.y>a)&&(a=d.y)}const l=Math.min(s-n,a-i);let u=l/2;const c=new Ty([],Cy);if(0===l)return new R(n,i);for(let f=n;f<s;f+=l)for(let d=i;d<a;d+=l)c.push(new Jr(f+u,d+u,u,r));let p=function(f){let d=0,y=0,m=0;const g=f[0];for(let b=0,x=g.length,v=x-1;b<x;v=b++){const _=g[b],w=g[v],A=_.x*w.y-w.x*_.y;y+=(_.x+w.x)*A,m+=(_.y+w.y)*A,d+=3*A}return new Jr(y/d,m/d,0,f)}(r),h=c.length;for(;c.length;){const f=c.pop();(f.d>p.d||!p.d)&&(p=f,t&&console.log("found best %d after %d probes",Math.round(1e4*f.d)/1e4,h)),f.max-p.d<=e||(u=f.h/2,c.push(new Jr(f.p.x-u,f.p.y-u,u,r)),c.push(new Jr(f.p.x+u,f.p.y-u,u,r)),c.push(new Jr(f.p.x-u,f.p.y+u,u,r)),c.push(new Jr(f.p.x+u,f.p.y+u,u,r)),h+=4)}return t&&(console.log(`num probes: ${h}`),console.log(`best distance: ${p.d}`)),p.p}function Cy(r,e){return e.max-r.max}class Jr{constructor(e,t,n,i){this.p=new R(e,t),this.h=n,this.d=function(s,a){let o=!1,l=1/0;for(let u=0;u<a.length;u++){const c=a[u];for(let p=0,h=c.length,f=h-1;p<h;f=p++){const d=c[p],y=c[f];d.y>s.y!=y.y>s.y&&s.x<(y.x-d.x)*(s.y-d.y)/(y.y-d.y)+d.x&&(o=!o),l=Math.min(l,Dc(s,d,y))}}return(o?1:-1)*Math.sqrt(l)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}}const Io=Number.POSITIVE_INFINITY,Py=Math.sqrt(2);function Ey(r,[e,t]){let n=0,i=0;if(t===Io){e<0&&(e=0);const s=e/Py;switch(r){case"top-right":case"top-left":i=s-7;break;case"bottom-right":case"bottom-left":i=7-s;break;case"bottom":i=7-e;break;case"top":i=e-7}switch(r){case"top-right":case"bottom-right":n=-s;break;case"top-left":case"bottom-left":n=s;break;case"left":n=e;break;case"right":n=-e}}else{switch(e=Math.abs(e),t=Math.abs(t),r){case"top-right":case"top-left":case"top":i=t-7;break;case"bottom-right":case"bottom-left":case"bottom":i=7-t}switch(r){case"top-right":case"bottom-right":case"right":n=-e;break;case"top-left":case"bottom-left":case"left":n=e}}return[n,i]}function Dy(r,e,t,n,i,s,a,o,l,u){r.createArrays(),r.tilePixelRatio=K/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const c=r.layers[0].layout,p=r.layers[0]._unevaluatedLayout._values,h={};if("composite"===r.textSizeData.kind){const{minZoom:y,maxZoom:m}=r.textSizeData;h.compositeTextSizes=[p["text-size"].possiblyEvaluate(new Se(y),o),p["text-size"].possiblyEvaluate(new Se(m),o)]}if("composite"===r.iconSizeData.kind){const{minZoom:y,maxZoom:m}=r.iconSizeData;h.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new Se(y),o),p["icon-size"].possiblyEvaluate(new Se(m),o)]}h.layoutTextSize=p["text-size"].possiblyEvaluate(new Se(l+1),o),h.layoutIconSize=p["icon-size"].possiblyEvaluate(new Se(l+1),o),h.textMaxSize=p["text-size"].possiblyEvaluate(new Se(18),o);const f="map"===c.get("text-rotation-alignment")&&"point"!==c.get("symbol-placement"),d=c.get("text-size");for(const y of r.features){const m=c.get("text-font").evaluate(y,{},o).join(","),g=d.evaluate(y,{},o),b=h.layoutTextSize.evaluate(y,{},o),x=(h.layoutIconSize.evaluate(y,{},o),{horizontal:{},vertical:void 0}),v=y.text;let _,w=[0,0];if(v){const z=v.toString(),P=24*c.get("text-letter-spacing").evaluate(y,{},o),k=24*c.get("text-line-height").evaluate(y,{},o),M=Df(z)?P:0,B=c.get("text-anchor").evaluate(y,{},o),C=c.get("text-variable-anchor");if(!C){const N=c.get("text-radial-offset").evaluate(y,{},o);w=N?Ey(B,[24*N,Io]):c.get("text-offset").evaluate(y,{},o).map(L=>24*L)}let D=f?"center":c.get("text-justify").evaluate(y,{},o);const I="point"===c.get("symbol-placement"),F=I?24*c.get("text-max-width").evaluate(y,{},o):1/0,Y=N=>{r.allowVerticalPlacement&&Ea(z)&&(x.vertical=ko(v,e,t,i,m,F,k,B,N,M,w,lt.vertical,!0,b,g))};if(!f&&C){const N="auto"===D?C.map(V=>Rh(V)):[D];let L=!1;for(let V=0;V<N.length;V++){const G=N[V];if(!x.horizontal[G])if(L)x.horizontal[G]=x.horizontal[0];else{const H=ko(v,e,t,i,m,F,k,"center",G,M,w,lt.horizontal,!1,b,g);H&&(x.horizontal[G]=H,L=1===H.positionedLines.length)}}Y("left")}else{if("auto"===D&&(D=Rh(B)),I||c.get("text-writing-mode").indexOf("horizontal")>=0||!Ea(z)){const N=ko(v,e,t,i,m,F,k,B,D,M,w,lt.horizontal,!1,b,g);N&&(x.horizontal[D]=N)}Y(I?"left":D)}}let A=!1;if(y.icon&&y.icon.name){const z=n[y.icon.name];z&&(_=Ay(i[y.icon.name],c.get("icon-offset").evaluate(y,{},o),c.get("icon-anchor").evaluate(y,{},o)),A=z.sdf,void 0===r.sdfIcons?r.sdfIcons=z.sdf:r.sdfIcons!==z.sdf&&Ee("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(z.pixelRatio!==r.pixelRatio||0!==c.get("icon-rotate").constantOr(1))&&(r.iconsNeedLinear=!0))}const S=$h(x.horizontal)||x.vertical;r.iconsInText||(r.iconsInText=!!S&&S.iconsInText),(S||_)&&Vy(r,y,x,_,n,h,b,0,w,A,a,o,u)}s&&r.generateCollisionDebugBuffers(l,r.collisionBoxArray)}function Rh(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Vy(r,e,t,n,i,s,a,o,l,u,c,p,h){let f=s.textMaxSize.evaluate(e,{},p);void 0===f&&(f=a);const d=r.layers[0].layout,y=d.get("icon-offset").evaluate(e,{},p),m=$h(t.horizontal)||t.vertical,g="globe"===h.name,b=a/24,x=r.tilePixelRatio*f/24,v=(M=r.overscaling,r.zoom>18&&M>2&&(M>>=1),Math.max(K/(512*M),1)*d.get("symbol-spacing")),_=d.get("text-padding")*r.tilePixelRatio,w=d.get("icon-padding")*r.tilePixelRatio,A=me(d.get("text-max-angle")),S="map"===d.get("text-rotation-alignment")&&"point"!==d.get("symbol-placement"),z="map"===d.get("icon-rotation-alignment")&&"point"!==d.get("symbol-placement"),P=d.get("symbol-placement"),k=v/2;var M;const B=d.get("icon-text-fit");let C;n&&"none"!==B&&(r.allowVerticalPlacement&&t.vertical&&(C=Bh(n,t.vertical,B,d.get("icon-text-fit-padding"),y,b)),m&&(n=Bh(n,m,B,d.get("icon-text-fit-padding"),y,b)));const D=(I,F,Y)=>{if(F.x<0||F.x>=K||F.y<0||F.y>=K)return;let N=null;if(g){const{x:L,y:V,z:G}=h.projectTilePoint(F.x,F.y,Y);N={anchor:new Rt(L,V,G,0,void 0),up:h.upVector(Y,F.x,F.y)}}!function(L,V,G,H,W,J,ie,E,O,Q,le,ye,he,_e,pe,we,Ie,se,ze,Ke,re,xe,Ce,ce,ve){const Ze=L.addToLineVertexArray(V,H);let je,Ge,Fe,$e,Ot,en,Yn,Kn=0,Ep=0,Dp=0,Vp=0,Qo=-1,el=-1;const zt={};let Lp=cr("");const vr=G?G.anchor:V;let tl=0,rl=0;if(void 0===O._unevaluatedLayout.getValue("text-radial-offset")?[tl,rl]=O.layout.get("text-offset").evaluate(re,{},ve).map(et=>24*et):(tl=24*O.layout.get("text-radial-offset").evaluate(re,{},ve),rl=Io),L.allowVerticalPlacement&&W.vertical){const et=W.vertical;if(pe)en=Mo(et),E&&(Yn=Mo(E));else{const tt=O.layout.get("text-rotate").evaluate(re,{},ve)+90;Fe=fs(Q,vr,V,le,ye,he,et,_e,tt,we),E&&($e=fs(Q,vr,V,le,ye,he,E,se,tt))}}if(J){const et=O.layout.get("icon-rotate").evaluate(re,{},ve),tt="none"!==O.layout.get("icon-text-fit"),Jn=Lh(J,et,Ce,tt),il=E?Lh(E,et,Ce,tt):void 0;Ge=fs(Q,vr,V,le,ye,he,J,se,et),Kn=4*Jn.length;const Fp=L.iconSizeData;let br=null;"source"===Fp.kind?(br=[Lt*O.layout.get("icon-size").evaluate(re,{},ve)],br[0]>Qt&&Ee(`${L.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Fp.kind&&(br=[Lt*xe.compositeIconSizes[0].evaluate(re,{},ve),Lt*xe.compositeIconSizes[1].evaluate(re,{},ve)],(br[0]>Qt||br[1]>Qt)&&Ee(`${L.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),L.addSymbols(L.icon,Jn,br,Ke,ze,re,!1,G,V,Ze.lineStartIndex,Ze.lineLength,-1,ce,ve),Qo=L.icon.placedSymbolArray.length-1,il&&(Ep=4*il.length,L.addSymbols(L.icon,il,br,Ke,ze,re,lt.vertical,G,V,Ze.lineStartIndex,Ze.lineLength,-1,ce,ve),el=L.icon.placedSymbolArray.length-1)}for(const et in W.horizontal){const tt=W.horizontal[et];je||(Lp=cr(tt.text),pe?Ot=Mo(tt):je=fs(Q,vr,V,le,ye,he,tt,_e,O.layout.get("text-rotate").evaluate(re,{},ve),we));const Jn=1===tt.positionedLines.length;if(Dp+=jh(L,G,V,tt,ie,O,pe,re,we,Ze,W.vertical?lt.horizontal:lt.horizontalOnly,Jn?Object.keys(W.horizontal):[et],zt,Qo,xe,ce,ve),Jn)break}W.vertical&&(Vp+=jh(L,G,V,W.vertical,ie,O,pe,re,we,Ze,lt.vertical,["vertical"],zt,el,xe,ce,ve));let sr=-1;const nl=(et,tt)=>et?Math.max(et,tt):tt;sr=nl(Ot,sr),sr=nl(en,sr),sr=nl(Yn,sr);const qm=sr>-1?1:0;L.glyphOffsetArray.length>=tr.MAX_GLYPHS&&Ee("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==re.sortKey&&L.addToSortKeyRanges(L.symbolInstances.length,re.sortKey),L.symbolInstances.emplaceBack(vr.x,vr.y,vr.z,V.x,V.y,zt.right>=0?zt.right:-1,zt.center>=0?zt.center:-1,zt.left>=0?zt.left:-1,zt.vertical>=0?zt.vertical:-1,Qo,el,Lp,void 0!==je?je:L.collisionBoxArray.length,void 0!==je?je+1:L.collisionBoxArray.length,void 0!==Fe?Fe:L.collisionBoxArray.length,void 0!==Fe?Fe+1:L.collisionBoxArray.length,void 0!==Ge?Ge:L.collisionBoxArray.length,void 0!==Ge?Ge+1:L.collisionBoxArray.length,$e||L.collisionBoxArray.length,$e?$e+1:L.collisionBoxArray.length,le,Dp,Vp,Kn,Ep,qm,0,tl,rl,sr)}(r,F,N,I,t,n,i,C,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,_,S,l,0,w,z,y,e,s,u,c,p)};if("line"===P)for(const I of function(F,Y,N,L,V){const G=[];for(let H=0;H<F.length;H++){const W=F[H];let J;for(let ie=0;ie<W.length-1;ie++){let E=W[ie],O=W[ie+1];E.x<0&&O.x<0||(E.x<0?E=new R(0,E.y+(0-E.x)/(O.x-E.x)*(O.y-E.y))._round():O.x<0&&(O=new R(0,E.y+(0-E.x)/(O.x-E.x)*(O.y-E.y))._round()),E.y<0&&O.y<0||(E.y<0?E=new R(E.x+(0-E.y)/(O.y-E.y)*(O.x-E.x),0)._round():O.y<0&&(O=new R(E.x+(0-E.y)/(O.y-E.y)*(O.x-E.x),0)._round()),E.x>=L&&O.x>=L||(E.x>=L?E=new R(L,E.y+(L-E.x)/(O.x-E.x)*(O.y-E.y))._round():O.x>=L&&(O=new R(L,E.y+(L-E.x)/(O.x-E.x)*(O.y-E.y))._round()),E.y>=V&&O.y>=V||(E.y>=V?E=new R(E.x+(V-E.y)/(O.y-E.y)*(O.x-E.x),V)._round():O.y>=V&&(O=new R(E.x+(V-E.y)/(O.y-E.y)*(O.x-E.x),V)._round()),J&&E.equals(J[J.length-1])||(J=[E],G.push(J)),J.push(O)))))}}return G}(e.geometry,0,0,K,K)){const F=Iy(I,v,A,t.vertical||m,n,24,x,r.overscaling,K);for(const Y of F)m&&Ly(r,m.text,k,Y)||D(I,Y,p)}else if("line-center"===P){for(const I of e.geometry)if(I.length>1){const F=ky(I,A,t.vertical||m,n,24,x);F&&D(I,F,p)}}else if("Polygon"===e.type)for(const I of bo(e.geometry,0)){const F=By(I,16);D(I[0],new Rt(F.x,F.y,0,0,void 0),p)}else if("LineString"===e.type)for(const I of e.geometry)D(I,new Rt(I[0].x,I[0].y,0,0,void 0),p);else if("Point"===e.type)for(const I of e.geometry)for(const F of I)D([F],new Rt(F.x,F.y,0,0,void 0),p)}const Qt=32640;function jh(r,e,t,n,i,s,a,o,l,u,c,p,h,f,d,y,m){const g=function(v,_,w,A,S,z,P,k){const M=[];if(0===_.positionedLines.length)return M;const B=A.layout.get("text-rotate").evaluate(z,{})*Math.PI/180,C=function(N){const L=N[0],V=N[1],G=L*V;return G>0?[L,-V]:G<0?[-L,V]:0===L?[V,L]:[V,-L]}(w);let D=Math.abs(_.top-_.bottom);for(const N of _.positionedLines)D-=N.lineOffset;const I=_.positionedLines.length,F=D/I;let Y=_.top-w[1];for(let N=0;N<I;++N){const L=_.positionedLines[N];Y=My(_,F,Y,N);for(const V of L.positionedGlyphs){if(!V.rect)continue;const G=V.rect||{};let H=4,W=!0,J=1,ie=0;if(V.imageName){const ce=P[V.imageName];if(!ce)continue;if(ce.sdf){Ee("SDF images are not supported in formatted text and will be ignored.");continue}W=!1,J=ce.pixelRatio,H=1/J}const E=(S||k)&&V.vertical,O=V.metrics.advance*V.scale/2,Q=V.metrics,le=V.rect;if(null===le)continue;k&&_.verticalizable&&(ie=V.imageName?O-V.metrics.width*V.scale/2:0);const ye=S?[V.x+O,V.y]:[0,0];let he=[0,0],_e=[0,0],pe=!1;S||(E?(_e=[V.x+O+C[0],V.y+C[1]-ie],pe=!0):he=[V.x+O+w[0],V.y+w[1]-ie]);const we=le.w*V.scale/(J*(V.localGlyph?2:1)),Ie=le.h*V.scale/(J*(V.localGlyph?2:1));let se,ze,Ke,re;if(E){const ce=V.y-Y,ve=new R(-O,O-ce),Ze=-Math.PI/2,je=new R(..._e);se=new R(-O+he[0],he[1]),se._rotateAround(Ze,ve)._add(je),se.x+=-ce+O,se.y-=(Q.left-H)*V.scale;const Ge=V.imageName?Q.advance*V.scale:24*V.scale,Fe=String.fromCharCode(V.glyph);hy(Fe)?se.x+=(1-H)*V.scale:py(Fe)?se.x+=Ge-Q.height*V.scale+(-H-1)*V.scale:se.x+=V.imageName||Q.width+2*H===le.w&&Q.height+2*H===le.h?(Ge-Ie)/2:(Ge-(Q.height+2*H)*V.scale)/2,ze=new R(se.x,se.y-we),Ke=new R(se.x+Ie,se.y),re=new R(se.x+Ie,se.y-we)}else{const ce=(Q.left-H)*V.scale-O+he[0],ve=(-Q.top-H)*V.scale+he[1],Ze=ce+we,je=ve+Ie;se=new R(ce,ve),ze=new R(Ze,ve),Ke=new R(ce,je),re=new R(Ze,je)}if(B){let ce;ce=S?new R(0,0):pe?new R(C[0],C[1]):new R(w[0],w[1]),se._rotateAround(B,ce),ze._rotateAround(B,ce),Ke._rotateAround(B,ce),re._rotateAround(B,ce)}const xe=new R(0,0),Ce=new R(0,0);M.push({tl:se,tr:ze,bl:Ke,br:re,tex:G,writingMode:_.writingMode,glyphOffset:ye,sectionIndex:V.sectionIndex,isSDF:W,pixelOffsetTL:xe,pixelOffsetBR:Ce,minFontScaleX:0,minFontScaleY:0})}}return M}(0,n,l,s,a,o,i,r.allowVerticalPlacement),b=r.textSizeData;let x=null;"source"===b.kind?(x=[Lt*s.layout.get("text-size").evaluate(o,{},m)],x[0]>Qt&&Ee(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===b.kind&&(x=[Lt*d.compositeTextSizes[0].evaluate(o,{},m),Lt*d.compositeTextSizes[1].evaluate(o,{},m)],(x[0]>Qt||x[1]>Qt)&&Ee(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),r.addSymbols(r.text,g,x,l,a,o,c,e,t,u.lineStartIndex,u.lineLength,f,y,m);for(const v of p)h[v]=r.text.placedSymbolArray.length-1;return 4*g.length}function $h(r){for(const e in r)return r[e];return null}function fs(r,e,t,n,i,s,a,o,l,u){let c=a.top,p=a.bottom,h=a.left,f=a.right;const d=a.collisionPadding;if(d&&(h-=d[0],c-=d[1],f+=d[2],p+=d[3]),l){const y=new R(h,c),m=new R(f,c),g=new R(h,p),b=new R(f,p),x=me(l);let v=new R(0,0);u&&(v=new R(u[0],u[1])),y._rotateAround(x,v),m._rotateAround(x,v),g._rotateAround(x,v),b._rotateAround(x,v),h=Math.min(y.x,m.x,g.x,b.x),f=Math.max(y.x,m.x,g.x,b.x),c=Math.min(y.y,m.y,g.y,b.y),p=Math.max(y.y,m.y,g.y,b.y)}return r.emplaceBack(e.x,e.y,e.z,t.x,t.y,h,c,f,p,o,n,i,s),r.length-1}function Mo(r){r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const e=r.bottom-r.top;return e>0?Math.max(10,e):null}function Ly(r,e,t,n){const i=r.compareText;if(e in i){const s=i[e];for(let a=s.length-1;a>=0;a--)if(n.dist(s[a])<t)return!0}else i[e]=[];return i[e].push(n),!1}function Oh(r,e){const t=r.fovAboveCenter,n=r.elevation?r.elevation.getMinElevationBelowMSL()*e:0,i=(r._camera.position[2]*r.worldSize-n)/Math.cos(r._pitch),s=Math.sin(t)*i/Math.sin(Math.max(Math.PI/2-r._pitch-t,.01)),a=Math.sin(r._pitch)*s+i;return Math.min(1.01*a,i*(1/r._horizonShift))}function jn(r,e){if(!e.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:e};const t=Math.pow(2,-r.z),n=r.x*t,i=(r.x+1)*t,s=r.y*t,a=(r.y+1)*t,o=ot(n),l=ot(i),u=qe(s),c=qe(a),p=e.project(o,u),h=e.project(l,u),f=e.project(l,c),d=e.project(o,c);let y=Math.min(p.x,h.x,f.x,d.x),m=Math.min(p.y,h.y,f.y,d.y),g=Math.max(p.x,h.x,f.x,d.x),b=Math.max(p.y,h.y,f.y,d.y);const x=t/16;function v(w,A,S,z,P,k){const M=(S+P)/2,B=(z+k)/2,C=e.project(ot(M),qe(B)),D=Math.max(0,y-C.x,m-C.y,C.x-g,C.y-b);y=Math.min(y,C.x),g=Math.max(g,C.x),m=Math.min(m,C.y),b=Math.max(b,C.y),D>x&&(v(w,C,S,z,M,B),v(C,A,M,B,P,k))}v(p,h,n,s,i,s),v(h,f,i,s,i,a),v(f,d,i,a,n,a),v(d,p,n,a,n,s),y-=x,m-=x,g+=x,b+=x;const _=1/Math.max(g-y,b-m);return{scale:_,x:y*_,y:m*_,x2:g*_,y2:b*_,projection:e}}const Fy=_n(new Float32Array(16));class er{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new ae(0,0)}projectTilePoint(e,t,n){return{x:e,y:t,z:0}}locationPoint(e,t,n=!0){return e._coordinatePoint(e.locationCoordinate(t),n)}pixelsPerMeter(e,t){return Dt(1,e)*t}pixelSpaceConversion(e,t,n){return 1}farthestPixelDistance(e){return Oh(e,e.pixelsPerMeter)}pointCoordinate(e,t,n,i){const s=e.horizonLineFromTop(!1),a=new R(t,Math.max(s,n));return e.rayIntersectionCoordinate(e.pointRayIntersection(a,i))}pointCoordinate3D(e,t,n){const i=new R(t,n);if(e.elevation)return e.elevation.pointCoordinate(i);{const s=this.pointCoordinate(e,i.x,i.y,0);return[s.x,s.y,s.z]}}isPointAboveHorizon(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);const n=e.horizonLineFromTop();return t.y<n}createInversionMatrix(e,t){return Fy}createTileMatrix(e,t,n){let i,s,a;const o=n.canonical,l=_n(new Float64Array(16));if(this.isReprojectedInTileSpace){const u=jn(o,this);i=1,s=u.x+n.wrap*u.scale,a=u.y,qi(l,l,[i/u.scale,i/u.scale,e.pixelsPerMeter/t])}else i=t/e.zoomScale(o.z),s=(o.x+Math.pow(2,o.z)*n.wrap)*i,a=o.y*i;return bc(l,l,[s,a,0]),qi(l,l,[i/K,i/K,1]),l}upVector(e,t,n){return[0,0,1]}upVectorScale(e,t,n){return{metersToTile:1}}}class Ry extends er{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,n]=this.parallels=e.parallels||[29.5,45.5],i=Math.sin(me(t));this.n=(i+Math.sin(me(n)))/2,this.c=1+i*(2*this.n-i),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n,c:i,r0:s}=this,a=me(e-this.center[0]),o=me(t),l=Math.sqrt(i-2*n*Math.sin(o))/n;return{x:l*Math.sin(a*n),y:l*Math.cos(a*n)-s,z:0}}unproject(e,t){const{n,c:i,r0:s}=this,a=s+t;let o=Math.atan2(e,Math.abs(a))*Math.sign(a);a*n<0&&(o-=Math.PI*Math.sign(e)*Math.sign(a));const l=me(this.center[0])*n;o=ol(o,-Math.PI-l,Math.PI-l);const u=ue(it(o/n)+this.center[0],-180,180),c=Math.asin(ue((i-(e*e+a*a)*n*n)/(2*n),-1,1)),p=ue(it(c),-85.051129,yr);return new ae(u,p)}}const $n=1.340264,On=-.081106,Un=893e-6,qn=.003796,ds=Math.sqrt(3)/2;class jy extends er{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const n=Math.asin(ds*Math.sin(t)),i=n*n,s=i*i*i;return{x:.5*(e*Math.cos(n)/(ds*($n+3*On*i+s*(7*Un+9*qn*i)))/Math.PI+.5),y:1-.5*(n*($n+On*i+s*(Un+qn*i))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let n=t=(2*(1-t)-1)*Math.PI,i=n*n,s=i*i*i;for(let c,p,h,f=0;f<12&&(p=n*($n+On*i+s*(Un+qn*i))-t,h=$n+3*On*i+s*(7*Un+9*qn*i),c=p/h,n=ue(n-c,-Math.PI/3,Math.PI/3),i=n*n,s=i*i*i,!(Math.abs(c)<1e-12));++f);const a=ds*e*($n+3*On*i+s*(7*Un+9*qn*i))/Math.cos(n),o=Math.asin(Math.sin(n)/ds),l=ue(180*a/Math.PI,-180,180),u=ue(180*o/Math.PI,-85.051129,yr);return new ae(l,u)}}class $y extends er{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const n=360*(e-.5),i=ue(360*(.5-t),-85.051129,yr);return new ae(n,i)}}const Wr=Math.PI/2;function ys(r){return Math.tan((Wr+r)/2)}class Oy extends er{constructor(e){super(e),this.center=e.center||[0,30];const[t,n]=this.parallels=e.parallels||[30,30];let i=me(t),s=me(n);this.southernCenter=i+s<0,this.southernCenter&&(i=-i,s=-s);const a=Math.cos(i),o=ys(i);this.n=i===s?Math.sin(i):Math.log(a/Math.cos(s))/Math.log(ys(s)/o),this.f=a*Math.pow(ys(i),this.n)/this.n}project(e,t){t=me(t),this.southernCenter&&(t=-t),e=me(e-this.center[0]);const n=1e-6,{n:i,f:s}=this;s>0?t<-Wr+n&&(t=-Wr+n):t>Wr-n&&(t=Wr-n);const a=s/Math.pow(ys(t),i);let o=a*Math.sin(i*e),l=s-a*Math.cos(i*e);return o=.5*(o/Math.PI+.5),l=.5*(l/Math.PI+.5),{x:o,y:this.southernCenter?l:1-l,z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,this.southernCenter&&(t=1-t),t=(2*(1-t)-.5)*Math.PI;const{n,f:i}=this,s=i-t,a=Math.sign(s),o=Math.sign(n)*Math.sqrt(e*e+s*s);let l=Math.atan2(e,Math.abs(s))*a;s*n<0&&(l-=Math.PI*Math.sign(e)*a);const u=ue(it(l/n)+this.center[0],-180,180),c=ue(it(2*Math.atan(Math.pow(i/o,1/n))-Wr),-85.051129,yr);return new ae(u,this.southernCenter?-c:c)}}class Uh extends er{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:fr(e),y:dr(t),z:0}}unproject(e,t){const n=ot(e),i=qe(t);return new ae(n,i)}}const qh=me(yr);class Uy extends er{project(e,t){const n=(t=me(t))*t,i=n*n;return{x:.5*((e=me(e))*(.8707-.131979*n+i*(i*(.003971*n-.001529*i)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+n*(.015085+i*(.028874*n-.044475-.005916*i)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let n=t=(2*(1-t)-1)*Math.PI,i=25,s=0,a=n*n;do{a=n*n;const u=a*a;s=(n*(1.007226+a*(.015085+u*(.028874*a-.044475-.005916*u)))-t)/(1.007226+a*(.045255+u*(.259866*a-.311325-.005916*11*u))),n=ue(n-s,-qh,qh)}while(Math.abs(s)>1e-6&&--i>0);a=n*n;const o=ue(it(e/(.8707+a*(a*(a*a*a*(.003971-.001529*a)-.013791)-.131979))),-180,180),l=it(n);return new ae(o,l)}}const Nh=me(yr);class qy extends er{project(e,t){t=me(t),e=me(e);const n=Math.cos(t),i=2/Math.PI,s=Math.acos(n*Math.cos(e/2)),a=Math.sin(s)/s,o=.5*(e*i+2*n*Math.sin(e/2)/a)||0,l=.5*(t+Math.sin(t)/a)||0;return{x:.5*(o/Math.PI+.5),y:1-.5*(l/Math.PI+1),z:0}}unproject(e,t){let n=e=(2*e-.5)*Math.PI,i=t=(2*(1-t)-1)*Math.PI,s=25;const a=1e-6;let o=0,l=0;do{const u=Math.cos(i),c=Math.sin(i),p=2*c*u,h=c*c,f=u*u,d=Math.cos(n/2),y=Math.sin(n/2),m=2*d*y,g=y*y,b=1-f*d*d,x=b?1/b:0,v=b?Math.acos(u*d)*Math.sqrt(1/b):0,_=.5*(2*v*u*y+2*n/Math.PI)-e,w=.5*(v*c+i)-t,A=.5*x*(f*g+v*u*d*h)+1/Math.PI,S=x*(m*p/4-v*c*y),z=.125*x*(p*y-v*c*f*m),P=.5*x*(h*d+v*g*u)+.5,k=S*z-P*A;o=(w*S-_*P)/k,l=(_*z-w*A)/k,n=ue(n-o,-Math.PI,Math.PI),i=ue(i-l,-Nh,Nh)}while((Math.abs(o)>a||Math.abs(l)>a)&&--s>0);return new ae(it(n),it(i))}}class Zh extends er{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(me(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:n,cosPhi:i}=this;return{x:me(e)*i*n+.5,y:-Math.sin(me(t))/i*n+.5,z:0}}unproject(e,t){const{scale:n,cosPhi:i}=this,s=-(t-.5)/n,a=ue(it((e-.5)/n)/i,-180,180),o=Math.asin(ue(s*i,-1,1)),l=ue(it(o),-85.051129,yr);return new ae(a,l)}}class Ny extends Uh{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,t,n){const i=Tn(e,t,n);return yt(i,i,oo(kn(n))),{x:i[0],y:i[1],z:i[2]}}locationPoint(e,t){const n=so(t.lat,t.lng),i=dt([],n),s=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude;no(n,n,i,Dt(1,0)*K*s);const a=_n(new Float64Array(16));return vc(a,e.pixelMatrix,e.globeMatrix),yt(n,n,a),new R(n[0],n[1])}pixelsPerMeter(e,t){return Dt(1,0)*t}pixelSpaceConversion(e,t,n){const i=Dt(1,e)*t,s=fe(Dt(1,45)*t,i,n);return this.pixelsPerMeter(e,t)/s}createTileMatrix(e,t,n){const i=function(s){const a=(u=s.min,(l=zc)[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=u[0],l[13]=u[1],l[14]=u[2],l[15]=1,l),o=1/ao(s);var l,u;return qi(a,a,[o,o,o])}(kn(n.canonical));return vc(new Float64Array(16),e.globeMatrix,i)}createInversionMatrix(e,t){const{center:n}=e,i=oo(kn(t));return s=i,a=i,o=me(n.lng),l=Math.sin(o),u=Math.cos(o),c=a[0],p=a[1],h=a[2],f=a[3],d=a[8],y=a[9],m=a[10],g=a[11],a!==s&&(s[4]=a[4],s[5]=a[5],s[6]=a[6],s[7]=a[7],s[12]=a[12],s[13]=a[13],s[14]=a[14],s[15]=a[15]),s[0]=c*u-d*l,s[1]=p*u-y*l,s[2]=h*u-m*l,s[3]=f*u-g*l,s[8]=c*l+d*u,s[9]=p*l+y*u,s[10]=h*l+m*u,s[11]=f*l+g*u,function(s,a,o){var l=Math.sin(o),u=Math.cos(o),c=a[4],p=a[5],h=a[6],f=a[7],d=a[8],y=a[9],m=a[10],g=a[11];a!==s&&(s[0]=a[0],s[1]=a[1],s[2]=a[2],s[3]=a[3],s[12]=a[12],s[13]=a[13],s[14]=a[14],s[15]=a[15]),s[4]=c*u+d*l,s[5]=p*u+y*l,s[6]=h*u+m*l,s[7]=f*u+g*l,s[8]=d*u-c*l,s[9]=y*u-p*l,s[10]=m*u-h*l,s[11]=g*u-f*l}(i,i,me(n.lat)),qi(i,i,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(i);var s,a,o,l,u,c,p,h,f,d,y,m,g}pointCoordinate(e,t,n,i){return Ic(e,t,n,!0)||new Gi(0,0)}pointCoordinate3D(e,t,n){const i=this.pointCoordinate(e,t,n,0);return[i.x,i.y,i.z]}isPointAboveHorizon(e,t){return!Ic(e,t.x,t.y,!1)}farthestPixelDistance(e){const t=function(i,s){const a=i.cameraToCenterDistance,o=i._centerAltitude*s,l=i._camera,u=i._camera.forward(),c=jr([],Wt([],u,-a),[0,0,o]),p=i.worldSize/(2*Math.PI),h=[0,0,-p],f=i.width/i.height,d=Math.tan(i.fovAboveCenter),y=Wt([],l.up(),d),m=Wt([],l.right(),d*f),g=dt([],jr([],jr([],u,y),m)),b=[];let x;if(new Ac(c,g).closestPointOnSphere(h,p,b)){const v=jr([],b,h),_=$r([],v,c);x=Math.cos(i.fovAboveCenter)*ro(_)}else{const v=$r([],c,h),_=$r([],h,c);dt(_,_);const w=ro(v)-p;x=Math.sqrt(w*(w+2*p));const A=Math.acos(x/(p+w))-Math.acos(Ht(u,_));x*=Math.cos(A)}return 1.01*x}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),n=lo(e.zoom);if(n>0){const i=Oh(e,Dt(1,e.center.lat)*e.worldSize),s=e.worldSize/(2*Math.PI),a=Math.max(e.width,e.height)/e.worldSize*Math.PI;return fe(t,i+s*(1-Math.cos(a)),Math.pow(n,10))}return t}upVector(e,t,n){return Tn(t,n,e,1)}upVectorScale(e){return{metersToTile:kc(ao(kn(e)))}}}function To(r){const e=r.parallels,t=!!e&&Math.abs(e[0]+e[1])<.01;switch(r.name){case"mercator":return new Uh(r);case"equirectangular":return new $y(r);case"naturalEarth":return new Uy(r);case"equalEarth":return new jy(r);case"winkelTripel":return new qy(r);case"albers":return t?new Zh(r):new Ry(r);case"lambertConformalConic":return t?new Zh(r):new Oy(r);case"globe":return new Ny(r)}throw new Error(`Invalid projection name: ${r.name}`)}const Zy=rs.types,Gy=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ms(r,e,t,n,i,s,a,o,l,u,c,p,h){const f=o?Math.min(Qt,Math.round(o[0])):0,d=o?Math.min(Qt,Math.round(o[1])):0;r.emplaceBack(e,t,Math.round(32*n),Math.round(32*i),s,a,(f<<1)+(l?1:0),d,16*u,16*c,256*p,256*h)}function gs(r,e,t,n,i,s,a){r.emplaceBack(e,t,n,i,s,a)}function zo(r,e,t,n,i){r.emplaceBack(e,t,n,i),r.emplaceBack(e,t,n,i),r.emplaceBack(e,t,n,i),r.emplaceBack(e,t,n,i)}function Xy(r){for(const e of r.sections)if(Ff(e.text))return!0;return!1}class Bo{constructor(e){this.layoutVertexArray=new Ra,this.indexArray=new At,this.programConfigurations=e,this.segments=new Oe,this.dynamicLayoutVertexArray=new bn,this.opacityVertexArray=new $a,this.placedSymbolArray=new oc,this.globeExtVertexArray=new ja}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,t,n,i){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,sy.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,oy.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Gy,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,ay.members,!0)),this.opacityVertexBuffer.itemSize=1),(n||i)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}U(Bo,"SymbolBuffers");class Co{constructor(e,t,n){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new n,this.segments=new Oe,this.collisionVertexArray=new Ua,this.collisionVertexArrayExt=new qa}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,ly.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,uy.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}U(Co,"CollisionBuffers");class tr{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(a=>a.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=_n([]),this.placementViewportMatrix=_n([]);const t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=fh(this.zoom,t["text-size"]),this.iconSizeData=fh(this.zoom,t["icon-size"]);const n=this.layers[0].layout,i=n.get("symbol-sort-key"),s=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==s&&void 0!==i.constantOr(1),this.sortFeaturesByY=("viewport-y"===s||"auto"===s&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map(a=>lt[a]),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Bo(new hr(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Bo(new hr(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new cc,this.lineVertexArray=new hc,this.symbolInstances=new uc}calculateGlyphDependencies(e,t,n,i,s){for(let a=0;a<e.length;a++)if(t[e.charCodeAt(a)]=!0,i&&s){const o=Fn[e.charAt(a)];o&&(t[o.charCodeAt(0)]=!0)}}populate(e,t,n,i){const s=this.layers[0],a=s.layout,o="globe"===this.projection.name,l=a.get("text-font"),u=a.get("text-field"),c=a.get("icon-image"),p=("constant"!==u.value.kind||u.value.value instanceof Qe&&!u.value.value.isEmpty()||u.value.value.toString().length>0)&&("constant"!==l.value.kind||l.value.value.length>0),h="constant"!==c.value.kind||!!c.value.value||Object.keys(c.parameters).length>0,f=a.get("symbol-sort-key");if(this.features=[],!p&&!h)return;const d=t.iconDependencies,y=t.glyphDependencies,m=t.availableImages,g=new Se(this.zoom);for(const{feature:b,id:x,index:v,sourceLayerIndex:_}of e){const w=s._featureFilter.needGeometry,A=mr(b,w);if(!s._featureFilter.filter(g,A,n))continue;if(w||(A.geometry=Vt(b,n,i)),o&&1!==b.type&&n.z<=5){const k=A.geometry,M=.98078528056,B=(C,D)=>Ht(Tn(C.x,C.y,n,1),Tn(D.x,D.y,n,1))<M;for(let C=0;C<k.length;C++)k[C]=sd(k[C],B)}let S,z;if(p){const k=s.getValueAndResolveTokens("text-field",A,n,m),M=Qe.factory(k);Xy(M)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Hu()||this.hasRTLText&&Le.isParsed())&&(S=cy(M,s,A))}if(h){const k=s.getValueAndResolveTokens("icon-image",A,n,m);z=k instanceof at?k:at.fromString(k)}if(!S&&!z)continue;const P=this.sortFeaturesByKey?f.evaluate(A,{},n):void 0;if(this.features.push({id:x,text:S,icon:z,index:v,sourceLayerIndex:_,geometry:A.geometry,properties:b.properties,type:Zy[b.type],sortKey:P}),z&&(d[z.name]=!0),S){const k=l.evaluate(A,{},n).join(","),M="map"===a.get("text-rotation-alignment")&&"point"!==a.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(lt.vertical)>=0;for(const B of S.sections)if(B.image)d[B.image.name]=!0;else{const C=Ea(S.toString()),D=B.fontStack||k,I=y[D]=y[D]||{};this.calculateGlyphDependencies(B.text,I,M,this.allowVerticalPlacement,C)}}}"line"===a.get("symbol-placement")&&(this.features=function(b){const x={},v={},_=[];let w=0;function A(k){_.push(b[k]),w++}function S(k,M,B){const C=v[k];return delete v[k],v[M]=C,_[C].geometry[0].pop(),_[C].geometry[0]=_[C].geometry[0].concat(B[0]),C}function z(k,M,B){const C=x[M];return delete x[M],x[k]=C,_[C].geometry[0].shift(),_[C].geometry[0]=B[0].concat(_[C].geometry[0]),C}function P(k,M,B){const C=B?M[0][M[0].length-1]:M[0][0];return`${k}:${C.x}:${C.y}`}for(let k=0;k<b.length;k++){const M=b[k],B=M.geometry,C=M.text?M.text.toString():null;if(!C){A(k);continue}const D=P(C,B),I=P(C,B,!0);if(D in v&&I in x&&v[D]!==x[I]){const F=z(D,I,B),Y=S(D,I,_[F].geometry);delete x[D],delete v[I],v[P(C,_[Y].geometry,!0)]=Y,_[F].geometry=null}else D in v?S(D,I,B):I in x?z(D,I,B):(A(k),x[D]=w-1,v[I]=w-1)}return _.filter(k=>k.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((b,x)=>b.sortKey-x.sortKey)}update(e,t,n,i){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,n,i),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,n,i))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=To(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const n=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:i,y:s}of t)this.lineVertexArray.emplaceBack(i,s);return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,t,n,i,s,a,o,l,u,c,p,h,f,d){const y=e.indexArray,m=e.layoutVertexArray,g=e.globeExtVertexArray,b=e.segments.prepareSegment(4*t.length,m,y,this.canOverlap?a.sortKey:void 0),x=this.glyphOffsetArray.length,v=b.vertexLength,_=this.allowVerticalPlacement&&o===lt.vertical?Math.PI/2:0,w=a.text&&a.text.sections;for(let S=0;S<t.length;S++){const{tl:z,tr:P,bl:k,br:M,tex:B,pixelOffsetTL:C,pixelOffsetBR:D,minFontScaleX:I,minFontScaleY:F,glyphOffset:Y,isSDF:N,sectionIndex:L}=t[S],V=b.vertexLength,G=Y[1];if(ms(m,u.x,u.y,z.x,G+z.y,B.x,B.y,n,N,C.x,C.y,I,F),ms(m,u.x,u.y,P.x,G+P.y,B.x+B.w,B.y,n,N,D.x,C.y,I,F),ms(m,u.x,u.y,k.x,G+k.y,B.x,B.y+B.h,n,N,C.x,D.y,I,F),ms(m,u.x,u.y,M.x,G+M.y,B.x+B.w,B.y+B.h,n,N,D.x,D.y,I,F),l){const{x:H,y:W,z:J}=l.anchor,[ie,E,O]=l.up;gs(g,H,W,J,ie,E,O),gs(g,H,W,J,ie,E,O),gs(g,H,W,J,ie,E,O),gs(g,H,W,J,ie,E,O),zo(e.dynamicLayoutVertexArray,H,W,J,_)}else zo(e.dynamicLayoutVertexArray,u.x,u.y,u.z,_);y.emplaceBack(V,V+1,V+2),y.emplaceBack(V+1,V+2,V+3),b.vertexLength+=4,b.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Y[0]),S!==t.length-1&&L===t[S+1].sectionIndex||e.programConfigurations.populatePaintArrays(m.length,a,a.index,{},f,d,w&&w[L])}const A=l?l.anchor:u;e.placedSymbolArray.emplaceBack(A.x,A.y,A.z,u.x,u.y,x,this.glyphOffsetArray.length-x,v,c,p,u.segment,n?n[0]:0,n?n[1]:0,i[0],i[1],o,0,!1,0,h,0)}_commitLayoutVertex(e,t,n,i,s,a,o){e.emplaceBack(t,n,i,s,a,Math.round(o.x),Math.round(o.y))}_addCollisionDebugVertices(e,t,n,i,s,a,o){const l=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),u=l.vertexLength,c=o.tileAnchorX,p=o.tileAnchorY;for(let f=0;f<4;f++)n.collisionVertexArray.emplaceBack(0,0,0,0);n.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),n.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(n.layoutVertexArray,i,s,a,c,p,new R(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,i,s,a,c,p,new R(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,i,s,a,c,p,new R(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,i,s,a,c,p,new R(e.x1,e.y2)),l.vertexLength+=4;const h=n.indexArray;h.emplaceBack(u,u+1),h.emplaceBack(u+1,u+2),h.emplaceBack(u+2,u+3),h.emplaceBack(u+3,u),l.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,n,i,s,a){for(let o=i;o<s;o++){const l=n.get(o),u=this.getSymbolInstanceTextSize(e,a,t,o);this._addCollisionDebugVertices(l,u,this.textCollisionBox,l.projectedAnchorX,l.projectedAnchorY,l.projectedAnchorZ,a)}}_addIconDebugCollisionBoxes(e,t,n,i,s,a){for(let o=i;o<s;o++){const l=n.get(o),u=this.getSymbolInstanceIconSize(e,t,a.placedIconSymbolIndex);this._addCollisionDebugVertices(l,u,this.iconCollisionBox,l.projectedAnchorX,l.projectedAnchorY,l.projectedAnchorZ,a)}}generateCollisionDebugBuffers(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Co(Li,ph.members,Fr),this.iconCollisionBox=new Co(Li,ph.members,Fr);const n=as(this.iconSizeData,e),i=as(this.textSizeData,e);for(let s=0;s<this.symbolInstances.length;s++){const a=this.symbolInstances.get(s);this._addTextDebugCollisionBoxes(i,e,t,a.textBoxStartIndex,a.textBoxEndIndex,a),this._addTextDebugCollisionBoxes(i,e,t,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._addIconDebugCollisionBoxes(n,e,t,a.iconBoxStartIndex,a.iconBoxEndIndex,a),this._addIconDebugCollisionBoxes(n,e,t,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a)}}getSymbolInstanceTextSize(e,t,n,i){const s=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:i),a=dh(this.textSizeData,e,s)/24;return this.tilePixelRatio*a}getSymbolInstanceIconSize(e,t,n){const i=this.icon.placedSymbolArray.get(n),s=dh(this.iconSizeData,e,i);return this.tilePixelRatio*s}_commitDebugCollisionVertexUpdate(e,t,n){e.emplaceBack(t,-n,-n),e.emplaceBack(t,n,-n),e.emplaceBack(t,n,n),e.emplaceBack(t,-n,n)}_updateTextDebugCollisionBoxes(e,t,n,i,s,a){for(let o=i;o<s;o++){const l=n.get(o),u=this.getSymbolInstanceTextSize(e,a,t,o);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,u,l.padding)}}_updateIconDebugCollisionBoxes(e,t,n,i,s,a){for(let o=i;o<s;o++){const l=n.get(o),u=this.getSymbolInstanceIconSize(e,t,a);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,u,l.padding)}}updateCollisionDebugBuffers(e,t){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const n=as(this.iconSizeData,e),i=as(this.textSizeData,e);for(let s=0;s<this.symbolInstances.length;s++){const a=this.symbolInstances.get(s);this._updateTextDebugCollisionBoxes(i,e,t,a.textBoxStartIndex,a.textBoxEndIndex,a),this._updateTextDebugCollisionBoxes(i,e,t,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._updateIconDebugCollisionBoxes(n,e,t,a.iconBoxStartIndex,a.iconBoxEndIndex,a.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(n,e,t,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,n,i,s,a,o,l,u){const c={};if(t<n){const{x1:p,y1:h,x2:f,y2:d,padding:y,projectedAnchorX:m,projectedAnchorY:g,projectedAnchorZ:b,tileAnchorX:x,tileAnchorY:v,featureIndex:_}=e.get(t);c.textBox={x1:p,y1:h,x2:f,y2:d,padding:y,projectedAnchorX:m,projectedAnchorY:g,projectedAnchorZ:b,tileAnchorX:x,tileAnchorY:v},c.textFeatureIndex=_}if(i<s){const{x1:p,y1:h,x2:f,y2:d,padding:y,projectedAnchorX:m,projectedAnchorY:g,projectedAnchorZ:b,tileAnchorX:x,tileAnchorY:v,featureIndex:_}=e.get(i);c.verticalTextBox={x1:p,y1:h,x2:f,y2:d,padding:y,projectedAnchorX:m,projectedAnchorY:g,projectedAnchorZ:b,tileAnchorX:x,tileAnchorY:v},c.verticalTextFeatureIndex=_}if(a<o){const{x1:p,y1:h,x2:f,y2:d,padding:y,projectedAnchorX:m,projectedAnchorY:g,projectedAnchorZ:b,tileAnchorX:x,tileAnchorY:v,featureIndex:_}=e.get(a);c.iconBox={x1:p,y1:h,x2:f,y2:d,padding:y,projectedAnchorX:m,projectedAnchorY:g,projectedAnchorZ:b,tileAnchorX:x,tileAnchorY:v},c.iconFeatureIndex=_}if(l<u){const{x1:p,y1:h,x2:f,y2:d,padding:y,projectedAnchorX:m,projectedAnchorY:g,projectedAnchorZ:b,tileAnchorX:x,tileAnchorY:v,featureIndex:_}=e.get(l);c.verticalIconBox={x1:p,y1:h,x2:f,y2:d,padding:y,projectedAnchorX:m,projectedAnchorY:g,projectedAnchorZ:b,tileAnchorX:x,tileAnchorY:v},c.verticalIconFeatureIndex=_}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,t){const n=e.placedSymbolArray.get(t),i=n.vertexStartIndex+4*n.numGlyphs;for(let s=n.vertexStartIndex;s<i;s+=4)e.indexArray.emplaceBack(s,s+1,s+2),e.indexArray.emplaceBack(s+1,s+2,s+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),n=Math.cos(e),i=[],s=[],a=[];for(let o=0;o<this.symbolInstances.length;++o){a.push(o);const l=this.symbolInstances.get(o);i.push(0|Math.round(t*l.tileAnchorX+n*l.tileAnchorY)),s.push(l.featureIndex)}return a.sort((o,l)=>i[o]-i[l]||s[l]-s[o]),a}addToSortKeyRanges(e,t){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===t?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const n=this.symbolInstances.get(t);this.featureSortOrder.push(n.featureIndex);const{rightJustifiedTextSymbolIndex:i,centerJustifiedTextSymbolIndex:s,leftJustifiedTextSymbolIndex:a,verticalPlacedTextSymbolIndex:o,placedIconSymbolIndex:l,verticalPlacedIconSymbolIndex:u}=n;i>=0&&this.addIndicesForPlacedSymbol(this.text,i),s>=0&&s!==i&&this.addIndicesForPlacedSymbol(this.text,s),a>=0&&a!==s&&a!==i&&this.addIndicesForPlacedSymbol(this.text,a),o>=0&&this.addIndicesForPlacedSymbol(this.text,o),l>=0&&this.addIndicesForPlacedSymbol(this.icon,l),u>=0&&this.addIndicesForPlacedSymbol(this.icon,u)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}U(tr,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),tr.MAX_GLYPHS=65535,tr.addDynamicAttributes=zo;const Yy=new We({"symbol-placement":new q(T.layout_symbol["symbol-placement"]),"symbol-spacing":new q(T.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new q(T.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new X(T.layout_symbol["symbol-sort-key"]),"symbol-z-order":new q(T.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new q(T.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new q(T.layout_symbol["icon-ignore-placement"]),"icon-optional":new q(T.layout_symbol["icon-optional"]),"icon-rotation-alignment":new q(T.layout_symbol["icon-rotation-alignment"]),"icon-size":new X(T.layout_symbol["icon-size"]),"icon-text-fit":new q(T.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new q(T.layout_symbol["icon-text-fit-padding"]),"icon-image":new X(T.layout_symbol["icon-image"]),"icon-rotate":new X(T.layout_symbol["icon-rotate"]),"icon-padding":new q(T.layout_symbol["icon-padding"]),"icon-keep-upright":new q(T.layout_symbol["icon-keep-upright"]),"icon-offset":new X(T.layout_symbol["icon-offset"]),"icon-anchor":new X(T.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new q(T.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new q(T.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new q(T.layout_symbol["text-rotation-alignment"]),"text-field":new X(T.layout_symbol["text-field"]),"text-font":new X(T.layout_symbol["text-font"]),"text-size":new X(T.layout_symbol["text-size"]),"text-max-width":new X(T.layout_symbol["text-max-width"]),"text-line-height":new X(T.layout_symbol["text-line-height"]),"text-letter-spacing":new X(T.layout_symbol["text-letter-spacing"]),"text-justify":new X(T.layout_symbol["text-justify"]),"text-radial-offset":new X(T.layout_symbol["text-radial-offset"]),"text-variable-anchor":new q(T.layout_symbol["text-variable-anchor"]),"text-anchor":new X(T.layout_symbol["text-anchor"]),"text-max-angle":new q(T.layout_symbol["text-max-angle"]),"text-writing-mode":new q(T.layout_symbol["text-writing-mode"]),"text-rotate":new X(T.layout_symbol["text-rotate"]),"text-padding":new q(T.layout_symbol["text-padding"]),"text-keep-upright":new q(T.layout_symbol["text-keep-upright"]),"text-transform":new X(T.layout_symbol["text-transform"]),"text-offset":new X(T.layout_symbol["text-offset"]),"text-allow-overlap":new q(T.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new q(T.layout_symbol["text-ignore-placement"]),"text-optional":new q(T.layout_symbol["text-optional"])});var Po={paint:new We({"icon-opacity":new X(T.paint_symbol["icon-opacity"]),"icon-color":new X(T.paint_symbol["icon-color"]),"icon-halo-color":new X(T.paint_symbol["icon-halo-color"]),"icon-halo-width":new X(T.paint_symbol["icon-halo-width"]),"icon-halo-blur":new X(T.paint_symbol["icon-halo-blur"]),"icon-translate":new q(T.paint_symbol["icon-translate"]),"icon-translate-anchor":new q(T.paint_symbol["icon-translate-anchor"]),"text-opacity":new X(T.paint_symbol["text-opacity"]),"text-color":new X(T.paint_symbol["text-color"],{runtimeType:_t,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new X(T.paint_symbol["text-halo-color"]),"text-halo-width":new X(T.paint_symbol["text-halo-width"]),"text-halo-blur":new X(T.paint_symbol["text-halo-blur"]),"text-translate":new q(T.paint_symbol["text-translate"]),"text-translate-anchor":new q(T.paint_symbol["text-translate-anchor"])}),layout:Yy};class Gh{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:tn,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}U(Gh,"FormatSectionOverride",{omit:["defaultValue"]});class xs extends ft{constructor(e){super(e,Po)}recalculate(e,t){super.recalculate(e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const n=this.layout.get("text-writing-mode");if(n){const i=[];for(const s of n)i.indexOf(s)<0&&i.push(s);this.layout._values["text-writing-mode"]=i}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,t,n,i){const s=this.layout.get(e).evaluate(t,{},n,i),a=this._unevaluatedLayout._values[e];return a.isDataDriven()||fi(a.value)||!s?s:(o=t.properties,s.replace(/{([^{}]+)}/g,(u,c)=>c in o?String(o[c]):""));var o}createBucket(e){return new tr(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Po.paint.overridableProperties){if(!xs.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),n=new Gh(t),i=new ya(n,t.property.specification);let s=null;s="constant"===t.value.kind||"source"===t.value.kind?new ma("source",i):new ga("composite",i,t.value.zoomStops,t.value._interpolationType),this.paint._values[e]=new Lr(t.property,s,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven())&&xs.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const n=e.get("text-field"),i=Po.paint.properties[t];let s=!1;const a=o=>{for(const l of o)if(i.overrides&&i.overrides.hasOverride(l))return void(s=!0)};if("constant"===n.value.kind&&n.value.value instanceof Qe)a(n.value.value.sections);else if("source"===n.value.kind){const o=u=>{s||(u instanceof ln&&De(u.value)===rn?a(u.value.sections):u instanceof un?a(u.sections):u.eachChild(o))},l=n.value;l._styleExpression&&o(l._styleExpression.expression)}return s}getProgramConfiguration(e){return new Jt(this,e)}}var Ky={paint:new We({"background-color":new q(T.paint_background["background-color"]),"background-pattern":new q(T.paint_background["background-pattern"]),"background-opacity":new q(T.paint_background["background-opacity"])})},Jy={paint:new We({"raster-opacity":new q(T.paint_raster["raster-opacity"]),"raster-hue-rotate":new q(T.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new q(T.paint_raster["raster-brightness-min"]),"raster-brightness-max":new q(T.paint_raster["raster-brightness-max"]),"raster-saturation":new q(T.paint_raster["raster-saturation"]),"raster-contrast":new q(T.paint_raster["raster-contrast"]),"raster-resampling":new q(T.paint_raster["raster-resampling"]),"raster-fade-duration":new q(T.paint_raster["raster-fade-duration"])})};class Wy extends ft{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Hy={paint:new We({"sky-type":new q(T.paint_sky["sky-type"]),"sky-atmosphere-sun":new q(T.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new q(T.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new q(T.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new q(T.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ci(T.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new q(T.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new q(T.paint_sky["sky-atmosphere-color"]),"sky-opacity":new q(T.paint_sky["sky-opacity"])})};function Eo(r,e,t){const n=[0,0,1],i=((s=[])[0]=0,s[1]=0,s[2]=0,s[3]=1,s);var s;return function(s,a,o){o*=.5;var l=a[0],u=a[1],c=a[2],p=a[3],h=Math.sin(o),f=Math.cos(o);s[0]=l*f-c*h,s[1]=u*f+p*h,s[2]=c*f+l*h,s[3]=p*f-u*h}(i,i,t?-me(r)+Math.PI:me(r)),function(s,a,o){o*=.5;var l=a[0],u=a[1],c=a[2],p=a[3],h=Math.sin(o),f=Math.cos(o);s[0]=l*f+p*h,s[1]=u*f+c*h,s[2]=c*f-u*h,s[3]=p*f-l*h}(i,i,-me(e)),function(s,a,o){var l=o[0],u=o[1],c=o[2],p=a[0],h=a[1],f=a[2],d=u*f-c*h,y=c*p-l*f,m=l*h-u*p,g=u*m-c*y,b=c*d-l*m,x=l*y-u*d,v=2*o[3];y*=v,m*=v,b*=2,x*=2,s[0]=p+(d*=v)+(g*=2),s[1]=h+y+b,s[2]=f+m+x}(n,n,i),dt(n,n)}const Qy={circle:class extends ft{constructor(e){super(e,fd)}createBucket(e){return new po(e)}queryRadius(e){const t=e;return Ur("circle-radius",this,t)+Ur("circle-stroke-width",this,t)+Ki(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,n,i,s,a,o,l){const u=Fc(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n);return Rc(e,i,a,o,l,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),u,c)}getProgramIds(){return["circle"]}getProgramConfiguration(e){return new Jt(this,e)}},heatmap:class extends ft{createBucket(e){return new $c(e)}constructor(e){super(e,gd),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=qc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return Ur("heatmap-radius",this,e)}queryIntersectsFeature(e,t,n,i,s,a,o,l){const u=this.paint.get("heatmap-radius").evaluate(t,n);return Rc(e,i,a,o,l,!0,!0,new R(0,0),u)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(e){return new Jt(this,e)}},hillshade:class extends ft{constructor(e){super(e,xd)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends ft{constructor(e){super(e,Dd)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),n=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(e){return new Jt(this,e)}recalculate(e,t){super.recalculate(e,t);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new es(e)}queryRadius(){return Ki(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,n,i,s,a){return!e.queryGeometry.isAboveHorizon&&Ec(Lc(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),i)}isTileClipped(){return!0}},"fill-extrusion":class extends ft{constructor(e){super(e,Jd)}createBucket(e){return new is(e)}queryRadius(){return Ki(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(e){return new Jt(this,e)}queryIntersectsFeature(e,t,n,i,s,a,o,l,u){const c=Fc(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),p=this.paint.get("fill-extrusion-height").evaluate(t,n),h=this.paint.get("fill-extrusion-base").evaluate(t,n),f=[0,0],d=l&&a.elevation,y=a.elevation?a.elevation.exaggeration():1,m=e.tile.getBucket(this);if(d&&m instanceof is){const _=m.centroidVertexArray,w=u+1;w<_.length&&(f[0]=_.geta_centroid_pos0(w),f[1]=_.geta_centroid_pos1(w))}if(0===f[0]&&1===f[1])return!1;"globe"===a.projection.name&&(i=ih([i],[new R(0,0),new R(K,K)],e.tileID.canonical).map(_=>_.polygon).flat());const g=d?l:null,[b,x]=(w=i,A=h,S=p,z=c,P=o,k=g,M=f,B=y,C=a.center.lat,"globe"===(_=a).projection.name?function(I,F,Y,N,L,V,G,H,W,J,ie){const E=[],O=[],Q=I.projection.upVectorScale(ie,I.center.lat,I.worldSize).metersToTile,le=[0,0,0,1],ye=[0,0,0,1],he=(pe,we,Ie,se)=>{pe[0]=we,pe[1]=Ie,pe[2]=se,pe[3]=1},_e=function(){const pe=Math.PI/32,we=Math.tan(pe),Ie=Zi;return Ie*Math.sqrt(1+2*we*we)-Ie}();Y>0&&(Y+=_e),N+=_e;for(const pe of F){const we=[],Ie=[];for(const se of pe){const ze=se.x+L.x,Ke=se.y+L.y,re=I.projection.projectTilePoint(ze,Ke,ie),xe=I.projection.upVector(ie,se.x,se.y);let Ce=Y,ce=N;if(G){const ve=lh(ze,Ke,Y,N,G,H,W,J);Ce+=ve.base,ce+=ve.top}0!==Y?he(le,re.x+xe[0]*Q*Ce,re.y+xe[1]*Q*Ce,re.z+xe[2]*Q*Ce):he(le,re.x,re.y,re.z),he(ye,re.x+xe[0]*Q*ce,re.y+xe[1]*Q*ce,re.z+xe[2]*Q*ce),yt(le,le,V),yt(ye,ye,V),we.push(new Gr(le[0],le[1],le[2])),Ie.push(new Gr(ye[0],ye[1],ye[2]))}E.push(we),O.push(Ie)}return[E,O]}(_,w,A,S,z,P,k,M,B,C,e.tileID.canonical):k?function(I,F,Y,N,L,V,G,H,W){const J=[],ie=[],E=[0,0,0,1];for(const O of I){const Q=[],le=[];for(const ye of O){const he=ye.x+N.x,_e=ye.y+N.y,pe=lh(he,_e,F,Y,V,G,H,W);E[0]=he,E[1]=_e,E[2]=pe.base,E[3]=1,Sn(E,E,L),E[3]=Math.max(E[3],1e-5);const we=new Gr(E[0]/E[3],E[1]/E[3],E[2]/E[3]);E[0]=he,E[1]=_e,E[2]=pe.top,E[3]=1,Sn(E,E,L),E[3]=Math.max(E[3],1e-5);const Ie=new Gr(E[0]/E[3],E[1]/E[3],E[2]/E[3]);Q.push(we),le.push(Ie)}J.push(Q),ie.push(le)}return[J,ie]}(w,A,S,z,P,k,M,B,C):function(I,F,Y,N,L){const V=[],G=[],H=L[8]*F,W=L[9]*F,J=L[10]*F,ie=L[11]*F,E=L[8]*Y,O=L[9]*Y,Q=L[10]*Y,le=L[11]*Y;for(const ye of I){const he=[],_e=[];for(const pe of ye){const we=pe.x+N.x,Ie=pe.y+N.y,se=L[0]*we+L[4]*Ie+L[12],ze=L[1]*we+L[5]*Ie+L[13],Ke=L[2]*we+L[6]*Ie+L[14],re=L[3]*we+L[7]*Ie+L[15],xe=se+H,Ce=ze+W,ce=Ke+J,ve=Math.max(re+ie,1e-5),Ze=se+E,je=ze+O,Ge=Ke+Q,Fe=Math.max(re+le,1e-5);he.push(new Gr(xe/ve,Ce/ve,ce/ve)),_e.push(new Gr(Ze/Fe,je/Fe,Ge/Fe))}V.push(he),G.push(_e)}return[V,G]}(w,A,S,z,P)),v=e.queryGeometry;var _,w,A,S,z,P,k,M,B,C;return function(_,w,A){let S=1/0;Ec(A,w)&&(S=oh(A,w[0]));for(let z=0;z<w.length;z++){const P=w[z],k=_[z];for(let M=0;M<P.length-1;M++){const B=P[M],C=[B,P[M+1],k[M+1],k[M],B];od(A,C)&&(S=Math.min(S,oh(A,C)))}}return S!==1/0&&S}(b,x,v.isPointQuery()?v.screenBounds:v.screenGeometry)}},line:class extends ft{constructor(e){super(e,uh),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof Hs,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=ch.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new ss(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(e){return new Jt(this,e)}queryRadius(e){const t=e,n=hh(Ur("line-width",this,t),Ur("line-gap-width",this,t)),i=Ur("line-offset",this,t);return n/2+Math.abs(i)+Ki(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,n,i,s,a){if(e.queryGeometry.isAboveHorizon)return!1;const o=Lc(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),l=e.pixelToTileUnitsFactor/2*hh(this.paint.get("line-width").evaluate(t,n),this.paint.get("line-gap-width").evaluate(t,n)),u=this.paint.get("line-offset").evaluate(t,n);return u&&(i=function(c,p){const h=[],f=new R(0,0);for(let d=0;d<c.length;d++){const y=c[d],m=[];for(let g=0;g<y.length;g++){const x=y[g],v=y[g+1],_=0===g?f:x.sub(y[g-1])._unit()._perp(),w=g===y.length-1?f:v.sub(x)._unit()._perp(),A=_._add(w)._unit();A._mult(1/(A.x*w.x+A.y*w.y)),m.push(A._mult(p)._add(x))}h.push(m)}return h}(i,u*e.pixelToTileUnitsFactor)),function(c,p,h){for(let f=0;f<p.length;f++){const d=p[f];if(c.length>=3)for(let y=0;y<d.length;y++)if(Or(c,d[y]))return!0;if(ud(c,d,h))return!0}return!1}(o,i,l)}isTileClipped(){return!0}},symbol:xs,background:class extends ft{constructor(e){super(e,Ky)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends ft{constructor(e){super(e,Jy)}getProgramIds(){return["raster"]}},sky:class extends ft{constructor(e){super(e,Hy),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=qc({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const i=this.paint.get("sky-atmosphere-sun"),s=!i,a=e.style.light,o=a.properties.get("position");return s&&"viewport"===a.properties.get("anchor")&&Ee("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),s?Eo(o.azimuthal,90-o.polar,t):Eo(i[0],90-i[1],t)}const n=this.paint.get("sky-gradient-center");return Eo(n[0],90-n[1],t)}is3D(){return!1}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}}};var em=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Do(r){if("number"==typeof r||"boolean"==typeof r||"string"==typeof r||null==r)return JSON.stringify(r);if(Array.isArray(r)){let t="[";for(const n of r)t+=`${Do(n)},`;return`${t}]`}let e="{";for(const t of Object.keys(r).sort())e+=`${t}:${Do(r[t])},`;return`${e}}`}function tm(r){let e="";for(const t of em)e+=`/${Do(r[t])}`;return e}class rm{constructor(e){this.keyCache={},e&&this.replace(e)}replace(e){this._layerConfigs={},this._layers={},this.update(e,[])}update(e,t){for(const s of e)this._layerConfigs[s.id]=s,(this._layers[s.id]=(n=s,"custom"===n.type?new Wy(n):new Qy[n.type](n))).compileFilter(),this.keyCache[s.id]&&delete this.keyCache[s.id];var n;for(const s of t)delete this.keyCache[s],delete this._layerConfigs[s],delete this._layers[s];this.familiesBySource={};const i=function(s,a){const o={};for(let u=0;u<s.length;u++){const c=a&&a[s[u].id]||tm(s[u]);a&&(a[s[u].id]=c);let p=o[c];p||(p=o[c]=[]),p.push(s[u])}const l=[];for(const u in o)l.push(o[u]);return l}(Ms(this._layerConfigs),this.keyCache);for(const s of i){const a=s.map(h=>this._layers[h.id]),o=a[0];if("none"===o.visibility)continue;const l=o.source||"";let u=this.familiesBySource[l];u||(u=this.familiesBySource[l]={});const c=o.sourceLayer||"_geojsonTileLayer";let p=u[c];p||(p=u[c]=[]),p.push(a)}}}class Xh{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const n=e[t];this._stringToNumber[n]=t,this._numberToString[t]=n}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const nm=["tile","layer","source","sourceLayer","state"];class Yh{constructor(e,t,n,i,s){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=n,this._y=i,this.properties=e.properties,this.id=s}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const t of nm)void 0!==this[t]&&(e[t]=this[t]);return e}}class vs{constructor(e,t,n,i){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(t,i)}update(e,t,n){const{width:i,height:s}=e,{context:a}=this,{gl:o}=a,{HTMLImageElement:l,HTMLCanvasElement:u,HTMLVideoElement:c,ImageData:p,ImageBitmap:h}=Z;if(o.bindTexture(o.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===o.RGBA&&(!t||!1!==t.premultiply)),n||this.size&&this.size[0]===i&&this.size[1]===s){const{x:f,y:d}=n||{x:0,y:0};e instanceof l||e instanceof u||e instanceof c||e instanceof p||h&&e instanceof h?o.texSubImage2D(o.TEXTURE_2D,0,f,d,o.RGBA,o.UNSIGNED_BYTE,e):o.texSubImage2D(o.TEXTURE_2D,0,f,d,i,s,o.RGBA,o.UNSIGNED_BYTE,e.data)}else this.size=[i,s],e instanceof l||e instanceof u||e instanceof c||e instanceof p||h&&e instanceof h?o.texImage2D(o.TEXTURE_2D,0,this.format,this.format,o.UNSIGNED_BYTE,e):o.texImage2D(o.TEXTURE_2D,0,this.format,i,s,0,this.format,o.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(t&&t.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&o.generateMipmap(o.TEXTURE_2D)}bind(e,t){const{context:n}=this,{gl:i}=n;i.bindTexture(i.TEXTURE_2D,this.texture),e!==this.filter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,this.useMipmap?e===i.NEAREST?i.NEAREST_MIPMAP_NEAREST:i.LINEAR_MIPMAP_NEAREST:e),this.filter=e),t!==this.wrap&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,t),this.wrap=t)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}const rr=new Uint16Array(8184);for(let r=0;r<2046;r++){let e=r+2,t=0,n=0,i=0,s=0,a=0,o=0;for(1&e?i=s=a=32:t=n=o=32;(e>>=1)>1;){const u=t+i>>1,c=n+s>>1;1&e?(i=t,s=n,t=a,n=o):(t=i,n=s,i=a,s=o),a=u,o=c}const l=4*r;rr[l+0]=t,rr[l+1]=n,rr[l+2]=i,rr[l+3]=s}const Tt=new Uint16Array(2178),nr=new Uint8Array(1089),bs=new Uint16Array(1089);function Kh(r){return 0===r?-.03125:32===r?.03125:0}var im=be([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Jh={type:2,extent:K,loadGeometry:()=>[[new R(0,0),new R(8193,0),new R(8193,8193),new R(0,8193),new R(0,0)]]};class Wh{constructor(e,t,n,i,s){this.tileID=e,this.uid=$p++,this.uses=0,this.tileSize=t,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=s,this.expiredRequestCount=0,this.state="loading",i&&i.transform&&(this.projection=i.transform.projection)}registerFadeDuration(e){const t=e+this.timeAdded;t<Dr.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=jn(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,t,n){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(i,s){const a={};if(!s)return a;for(const o of i){const l=o.layerIds.map(u=>s.getLayer(u)).filter(Boolean);if(0!==l.length){o.layers=l,o.stateDependentLayerIds&&(o.stateDependentLayers=o.stateDependentLayerIds.map(u=>l.filter(c=>c.id===u)[0]));for(const u of l)a[u.id]=o}}return a}(e.buckets,t.style),this.hasSymbolBuckets=!1;for(const i in this.buckets){const s=this.buckets[i];if(s instanceof tr){if(this.hasSymbolBuckets=!0,!n)break;s.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const i in this.buckets){const s=this.buckets[i];if(s instanceof tr&&s.hasRTLText){this.hasRTLText=!0,Le.isLoading()||Le.isLoaded()||"deferred"!==Hu()||jf();break}}this.queryPadding=0;for(const i in this.buckets){const s=this.buckets[i];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(i).queryRadius(s))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Xa}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const n in this.buckets){const i=this.buckets[n];i.uploadPending()&&i.upload(e)}const t=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new vs(e,this.imageAtlas.image,t.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new vs(e,this.glyphAtlasImage,t.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new vs(e,this.lineAtlas.image,t.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,t,n,i,s,a,o,l){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:i,pixelPosMatrix:o,transform:a,params:s,tileTransform:this.tileTransform},e,t,n):{}}querySourceFeatures(e,t){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const i=n.loadVTLayers(),s=t?t.sourceLayer:"",a=i._geojsonTileLayer||i[s];if(!a)return;const o=Ai(t&&t.filter),{z:l,x:u,y:c}=this.tileID.canonical,p={z:l,x:u,y:c};for(let h=0;h<a.length;h++){const f=a.feature(h);if(o.needGeometry){const m=mr(f,!0);if(!o.filter(new Se(this.tileID.overscaledZ),m,this.tileID.canonical))continue}else if(!o.filter(new Se(this.tileID.overscaledZ),f))continue;const d=n.getId(f,s),y=new Yh(f,l,u,c,d);y.tile=p,e.push(y)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const t=this.expirationTime;if(e.cacheControl){const n=Bs(e.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const n=Date.now();let i=!1;if(this.expirationTime>n)i=!1;else if(t)if(this.expirationTime<t)i=!0;else{const s=this.expirationTime-t;s?this.expirationTime=n+Math.max(s,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,t){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!t)return;const n=this.latestFeatureIndex.loadVTLayers(),i=t.style.listImages();for(const s in this.buckets){if(!t.style.hasLayer(s))continue;const a=this.buckets[s],o=a.layers[0].sourceLayer||"_geojsonTileLayer",l=n[o],u=e[o];if(!l||!u||0===Object.keys(u).length)continue;if(a.update(u,l,i,this.imageAtlas&&this.imageAtlas.patternPositions||{}),a instanceof ss||a instanceof es){const p=t.style._getSourceCache(a.layers[0].source);t._terrain&&t._terrain.enabled&&p&&a.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(p.id,this.tileID)}const c=t&&t.style&&t.style.getLayer(s);c&&(this.queryPadding=Math.max(this.queryPadding,c.queryRadius(a)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Dr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Dr.now()+e}setTexture(e,t){const n=t.context,i=n.gl;this.texture=this.texture||t.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new vs(n,e,i.RGBA,{useMipmap:!0}),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE))}setDependencies(e,t){const n={};for(const i of t)n[i]=!0;this.dependencies[e]=n}hasDependency(e,t){for(const n of e){const i=this.dependencies[n];if(i)for(const s of t)if(i[s])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,t){if(!t||"mercator"===t.name||this._tileDebugBuffer)return;const n=Vt(Jh,this.tileID.canonical,this.tileTransform)[0],i=new Xt,s=new Ri;for(let a=0;a<n.length;a++){const{x:o,y:l}=n[a];i.emplaceBack(o,l),s.emplaceBack(a)}s.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(s),this._tileDebugBuffer=e.createVertexBuffer(i,io.members),this._tileDebugSegments=Oe.simpleSegment(0,0,i.length,s.length)}_makeTileBoundsBuffers(e,t){if(this._tileBoundsBuffer||!t||"mercator"===t.name)return;const n=Vt(Jh,this.tileID.canonical,this.tileTransform)[0];let i,s;if(this.isRaster){const a=function(o,l){const u=jn(o,l),c=Math.pow(2,o.z);for(let m=0;m<33;m++)for(let g=0;g<33;g++){const b=ot((o.x+(g+Kh(g))/32)/c),x=qe((o.y+(m+Kh(m))/32)/c),v=l.project(b,x),_=33*m+g;Tt[2*_+0]=Math.round((v.x*u.scale-u.x)*K),Tt[2*_+1]=Math.round((v.y*u.scale-u.y)*K)}nr.fill(0),bs.fill(0);for(let m=2045;m>=0;m--){const g=4*m,b=rr[g+0],x=rr[g+1],v=rr[g+2],_=rr[g+3],w=b+v>>1,A=x+_>>1,S=w+A-x,z=A+b-w,P=33*x+b,k=33*_+v,M=33*A+w,B=Math.hypot((Tt[2*P+0]+Tt[2*k+0])/2-Tt[2*M+0],(Tt[2*P+1]+Tt[2*k+1])/2-Tt[2*M+1])>=16;nr[M]=nr[M]||(B?1:0),m<1022&&(nr[M]=nr[M]||nr[33*(x+z>>1)+(b+S>>1)]||nr[33*(_+z>>1)+(v+S>>1)])}const p=new vn,h=new At;let f=0;function d(m,g){const b=33*g+m;return 0===bs[b]&&(p.emplaceBack(Tt[2*b+0],Tt[2*b+1],m*K/32,g*K/32),bs[b]=++f),bs[b]-1}function y(m,g,b,x,v,_){const w=m+b>>1,A=g+x>>1;if(Math.abs(m-v)+Math.abs(g-_)>1&&nr[33*A+w])y(v,_,m,g,w,A),y(b,x,v,_,w,A);else{const S=d(m,g),z=d(b,x),P=d(v,_);h.emplaceBack(S,z,P)}}return y(0,0,32,32,32,0),y(32,32,0,0,0,32),{vertices:p,indices:h}}(this.tileID.canonical,t);i=a.vertices,s=a.indices}else{i=new vn,s=new At;for(const{x:o,y:l}of n)i.emplaceBack(o,l,0,0);const a=qr(i.int16,void 0,4);for(let o=0;o<a.length;o+=3)s.emplaceBack(a[o],a[o+1],a[o+2])}this._tileBoundsBuffer=e.createVertexBuffer(i,im.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(s),this._tileBoundsSegments=Oe.simpleSegment(0,0,i.length,s.length)}_makeGlobeTileDebugBuffers(e,t){const n=t.projection;if(!n||"globe"!==n.name||t.freezeTileCoverage)return;const i=this.tileID.canonical,a=oo(function(u,c){const p=lo(c.zoom);if(0===p)return kn(u);const h=Mc(u),f=Tc(h),d=fr(h.getWest())*c.worldSize,y=fr(h.getEast())*c.worldSize,m=dr(h.getNorth())*c.worldSize,g=dr(h.getSouth())*c.worldSize,b=[d,m,0],x=[y,m,0],v=[d,g,0],_=[y,g,0],w=xc([],c.globeMatrix);return yt(b,b,w),yt(x,x,w),yt(v,v,w),yt(_,_,w),f[0]=In(f[0],v,p),f[1]=In(f[1],_,p),f[2]=In(f[2],x,p),f[3]=In(f[3],b,p),mt.fromPoints(f)}(i,t)),o=lo(t.zoom);let l;o>0&&(l=xc(new Float64Array(16),t.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,i,t,a,l,o),this._makeGlobeTileDebugTextBuffer(e,i,t,a,l,o)}_globePoint(e,t,n,i,s,a,o){let l=Tn(e,t,n);if(a){const u=1<<n.z,c=fr(i.center.lng),p=dr(i.center.lat),h=(n.x+.5)/u-c;let f=0;h>.5?f=-1:h<-.5&&(f=1);let d=(e/K+n.x)/u+f,y=(t/K+n.y)/u;d=(d-c)*i._pixelsPerMercatorPixel+c,y=(y-p)*i._pixelsPerMercatorPixel+p;const m=[d*i.worldSize,y*i.worldSize,0];yt(m,m,a),l=In(l,m,o)}return yt(l,l,s)}_makeGlobeTileDebugBorderBuffer(e,t,n,i,s,a){const o=new Xt,l=new Ri,u=new Ei,c=(h,f,d,y,m)=>{const g=(d-h)/(m-1),b=(y-f)/(m-1),x=o.length;for(let v=0;v<m;v++){const _=h+v*g,w=f+v*b;o.emplaceBack(_,w);const A=this._globePoint(_,w,t,n,i,s,a);u.emplaceBack(A[0],A[1],A[2]),l.emplaceBack(x+v)}},p=K;c(0,0,p,0,16),c(p,0,p,p,16),c(p,p,0,p,16),c(0,p,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(l),this._tileDebugBuffer=e.createVertexBuffer(o,io.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(u,Sc.members),this._tileDebugSegments=Oe.simpleSegment(0,0,o.length,l.length)}_makeGlobeTileDebugTextBuffer(e,t,n,i,s,a){const o=new Xt,l=new At,u=new Ei,c=25;l.reserve(32),o.reserve(c),u.reserve(c);const p=(h,f)=>c*h+f;for(let h=0;h<c;h++){const f=2048*h;for(let d=0;d<c;d++){const y=2048*d;o.emplaceBack(y,f);const m=this._globePoint(y,f,t,n,i,s,a);u.emplaceBack(m[0],m[1],m[2])}}for(let h=0;h<4;h++)for(let f=0;f<4;f++){const d=p(h,f),y=p(h,f+1),m=p(h+1,f),g=p(h+1,f+1);l.emplaceBack(d,y,m),l.emplaceBack(m,y,g)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(l),this._tileDebugTextBuffer=e.createVertexBuffer(o,io.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(u,Sc.members),this._tileDebugTextSegments=Oe.simpleSegment(0,0,c,32)}}class sm{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,n){const i=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][i]=this.stateChanges[e][i]||{},Re(this.stateChanges[e][i],n),null===this.deletedStates[e]){this.deletedStates[e]={};for(const s in this.state[e])s!==i&&(this.deletedStates[e][s]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][i]){this.deletedStates[e][i]={};for(const s in this.state[e][i])n[s]||(this.deletedStates[e][i][s]=null)}else for(const s in n)this.deletedStates[e]&&this.deletedStates[e][i]&&null===this.deletedStates[e][i][s]&&delete this.deletedStates[e][i][s]}removeFeatureState(e,t,n){if(null===this.deletedStates[e])return;const i=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&void 0!==t)null!==this.deletedStates[e][i]&&(this.deletedStates[e][i]=this.deletedStates[e][i]||{},this.deletedStates[e][i][n]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][i])for(n in this.deletedStates[e][i]={},this.stateChanges[e][i])this.deletedStates[e][i][n]=null;else this.deletedStates[e][i]=null;else this.deletedStates[e]=null}getState(e,t){const n=String(t),i=Re({},(this.state[e]||{})[n],(this.stateChanges[e]||{})[n]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const s=this.deletedStates[e][t];if(null===s)return{};for(const a in s)delete i[a]}return i}initializeTileState(e,t){e.setFeatureState(this.state,t)}coalesceChanges(e,t){const n={};for(const i in this.stateChanges){this.state[i]=this.state[i]||{};const s={};for(const a in this.stateChanges[i])this.state[i][a]||(this.state[i][a]={}),Re(this.state[i][a],this.stateChanges[i][a]),s[a]=this.state[i][a];n[i]=s}for(const i in this.deletedStates){this.state[i]=this.state[i]||{};const s={};if(null===this.deletedStates[i])for(const a in this.state[i])s[a]={},this.state[i][a]={};else for(const a in this.deletedStates[i]){if(null===this.deletedStates[i][a])this.state[i][a]={};else if(this.state[i][a])for(const o of Object.keys(this.deletedStates[i][a]))delete this.state[i][a][o];s[a]=this.state[i][a]}n[i]=n[i]||{},Re(n[i],s)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(const i in e)e[i].setFeatureState(n,t)}}class Hh{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const n=this.toIdx(e,t);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function Qh(r,e,t,n){let i=0,s=Number.MAX_VALUE;for(let a=0;a<3;a++)if(Math.abs(n[a])<1e-15){if(t[a]<r[a]||t[a]>e[a])return null}else{const o=1/n[a];let l=(r[a]-t[a])*o,u=(e[a]-t[a])*o;if(l>u){const c=l;l=u,u=c}if(l>i&&(i=l),u<s&&(s=u),i>s)return null}return i}function ep(r,e,t,n,i,s,a,o,l,u,c){const p=n-r,h=i-e,f=s-t,d=a-r,y=o-e,m=l-t,g=c[1]*m-c[2]*y,b=c[2]*d-c[0]*m,x=c[0]*y-c[1]*d,v=p*g+h*b+f*x;if(Math.abs(v)<1e-15)return null;const _=1/v,w=u[0]-r,A=u[1]-e,S=u[2]-t,z=(w*g+A*b+S*x)*_;if(z<0||z>1)return null;const P=A*f-S*h,k=S*p-w*f,M=w*h-A*p,B=(c[0]*P+c[1]*k+c[2]*M)*_;return B<0||z+B>1?null:(d*P+y*k+m*M)*_}function tp(r,e,t){return(r-e)/(t-e)}function rp(r,e,t,n,i,s,a,o,l){const u=1<<t,c=s-n,p=a-i,h=(r+1)/u*c+n,f=(e+0)/u*p+i,d=(e+1)/u*p+i;o[0]=(r+0)/u*c+n,o[1]=f,l[0]=h,l[1]=d}class np{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(s){const a=Math.ceil(Math.log2(s.dim/8)),o=[];let l=Math.ceil(Math.pow(2,a));const u=1/l,c=(f,d,y,m,g)=>{const b=m?1:0,x=(f+1)*y-b,v=d*y,_=(d+1)*y-b;g[0]=f*y,g[1]=v,g[2]=x,g[3]=_};let p=new Hh(l);const h=[];for(let f=0;f<l*l;f++){c(f%l,Math.floor(f/l),u,!1,h);const d=ir(h[0],h[1],s),y=ir(h[2],h[1],s),m=ir(h[2],h[3],s),g=ir(h[0],h[3],s);p.minimums.push(Math.min(d,y,m,g)),p.maximums.push(Math.max(d,y,m,g)),p.leaves.push(1)}for(o.push(p),l/=2;l>=1;l/=2){const f=o[o.length-1];p=new Hh(l);for(let d=0;d<l*l;d++){c(d%l,Math.floor(d/l),2,!0,h);const y=f.getElevation(h[0],h[1]),m=f.getElevation(h[2],h[1]),g=f.getElevation(h[2],h[3]),b=f.getElevation(h[0],h[3]),x=f.isLeaf(h[0],h[1]),v=f.isLeaf(h[2],h[1]),_=f.isLeaf(h[2],h[3]),w=f.isLeaf(h[0],h[3]),A=Math.min(y.min,m.min,g.min,b.min),S=Math.max(y.max,m.max,g.max,b.max),z=x&&v&&_&&w;p.maximums.push(S),p.minimums.push(A),p.leaves.push(S-A<=5&&z?1:0)}o.push(p)}return o}(this.dem),n=t.length-1,i=t[n];this._addNode(i.minimums[0],i.maximums[0],i.leaves[0]),this._construct(t,0,0,n,0)}raycastRoot(e,t,n,i,s,a,o=1){return Qh([e,t,-100],[n,i,this.maximums[0]*o],s,a)}raycast(e,t,n,i,s,a,o=1){if(!this.nodeCount)return null;const l=this.raycastRoot(e,t,n,i,s,a,o);if(null==l)return null;const u=[],c=[],p=[],h=[],f=[{idx:0,t:l,nodex:0,nodey:0,depth:0}];for(;f.length>0;){const{idx:d,t:y,nodex:m,nodey:g,depth:b}=f.pop();if(this.leaves[d]){rp(m,g,b,e,t,n,i,p,h);const v=1<<b,_=(m+0)/v,w=(m+1)/v,A=(g+0)/v,S=(g+1)/v,z=ir(_,A,this.dem)*o,P=ir(w,A,this.dem)*o,k=ir(w,S,this.dem)*o,M=ir(_,S,this.dem)*o,B=ep(p[0],p[1],z,h[0],p[1],P,h[0],h[1],k,s,a),C=ep(h[0],h[1],k,p[0],h[1],M,p[0],p[1],z,s,a),D=Math.min(null!==B?B:Number.MAX_VALUE,null!==C?C:Number.MAX_VALUE);if(D!==Number.MAX_VALUE)return D;{const I=no([],s,a,y);if(ip(z,P,M,k,tp(I[0],p[0],h[0]),tp(I[1],p[1],h[1]))>=I[2])return y}continue}let x=0;for(let v=0;v<this._siblingOffset.length;v++){rp((m<<1)+this._siblingOffset[v][0],(g<<1)+this._siblingOffset[v][1],b+1,e,t,n,i,p,h),p[2]=-100,h[2]=this.maximums[this.childOffsets[d]+v]*o;const _=Qh(p,h,s,a);if(null!=_){const w=_;u[v]=w;let A=!1;for(let S=0;S<x&&!A;S++)w>=u[c[S]]&&(c.splice(S,0,v),A=!0);A||(c[x]=v),x++}}for(let v=0;v<x;v++){const _=c[v];f.push({idx:this.childOffsets[d]+_,t:u[_],nodex:(m<<1)+this._siblingOffset[_][0],nodey:(g<<1)+this._siblingOffset[_][1],depth:b+1})}}return null}_addNode(e,t,n){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,n,i,s){if(1===e[i].isLeaf(t,n))return;this.childOffsets[s]||(this.childOffsets[s]=this.nodeCount);const a=i-1,o=e[a];let l=0,u=0;for(let c=0;c<this._siblingOffset.length;c++){const p=2*t+this._siblingOffset[c][0],h=2*n+this._siblingOffset[c][1],f=o.getElevation(p,h),d=o.isLeaf(p,h),y=this._addNode(f.min,f.max,d);d&&(l|=1<<c),u||(u=y)}for(let c=0;c<this._siblingOffset.length;c++)l&1<<c||this._construct(e,2*t+this._siblingOffset[c][0],2*n+this._siblingOffset[c][1],a,u+c)}}function ip(r,e,t,n,i,s){return fe(fe(r,t,s),fe(e,n,s),i)}function ir(r,e,t){const n=t.dim,i=ue(r*n-.5,0,n-1),s=ue(e*n-.5,0,n-1),a=Math.floor(i),o=Math.floor(s),l=Math.min(a+1,n-1),u=Math.min(o+1,n-1);return ip(t.get(a,o),t.get(l,o),t.get(a,u),t.get(l,u),i-a,s-o)}const sp={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function am(r,e,t){return(256*r*256+256*e+t)/10-1e4}function om(r,e,t){return 256*r+e+t/256-32768}class ws{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,n,i=!1,s=!1){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(n&&"mapbox"!==n&&"terrarium"!==n)return Ee(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=t.height;const a=this.dim=t.height-2,o=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.encoding=n||"mapbox",this.borderReady=i,!i){for(let l=0;l<a;l++)o[this._idx(-1,l)]=o[this._idx(0,l)],o[this._idx(a,l)]=o[this._idx(a-1,l)],o[this._idx(l,-1)]=o[this._idx(l,0)],o[this._idx(l,a)]=o[this._idx(l,a-1)];o[this._idx(-1,-1)]=o[this._idx(0,0)],o[this._idx(a,-1)]=o[this._idx(a-1,0)],o[this._idx(-1,a)]=o[this._idx(0,a-1)],o[this._idx(a,a)]=o[this._idx(a-1,a-1)],s&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new np(this)}get(e,t,n=!1){n&&(e=ue(e,-1,this.dim),t=ue(t,-1,this.dim));const i=4*this._idx(e,t);return("terrarium"===this.encoding?om:am)(this.pixels[i],this.pixels[i+1],this.pixels[i+2])}static getUnpackVector(e){return sp[e]}get unpackVector(){return sp[this.encoding]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}static pack(e,t){const n=[0,0,0,0],i=ws.getUnpackVector(t);let s=Math.floor((e+i[3])/i[2]);return n[2]=s%256,s=Math.floor(s/256),n[1]=s%256,s=Math.floor(s/256),n[0]=s,n}getPixels(){return new rt({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let i=t*this.dim,s=t*this.dim+this.dim,a=n*this.dim,o=n*this.dim+this.dim;switch(t){case-1:i=s-1;break;case 1:s=i+1}switch(n){case-1:a=o-1;break;case 1:o=a+1}const l=-t*this.dim,u=-n*this.dim;for(let c=a;c<o;c++)for(let p=i;p<s;p++){const h=4*this._idx(p,c),f=4*this._idx(p+l,c+u);this.pixels[h+0]=e.pixels[f+0],this.pixels[h+1]=e.pixels[f+1],this.pixels[h+2]=e.pixels[f+2],this.pixels[h+3]=e.pixels[f+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}U(ws,"DEMData"),U(np,"DemMinMaxQuadTree",{omit:["dem"]});class lm{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,n){const i=e.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);const s={value:t,timeout:void 0};if(void 0!==n&&(s.timeout=setTimeout(()=>{this.remove(e,s)},n)),this.data[i].push(s),this.order.push(i),this.order.length>this.max){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const n=e.wrapped().key,i=void 0===t?0:this.data[n].indexOf(t),s=this.data[n][i];return this.data[n].splice(i,1),s.timeout&&clearTimeout(s.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(s.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(e){const t=[];for(const n in this.data)for(const i of this.data[n])e(i.value)||t.push(i);for(const n of t)this.remove(n.value.tileID,n)}}class jt{constructor(e,t,n){this.blendFunction=e,this.blendColor=t,this.mask=n}}jt.Replace=[1,0],jt.disabled=new jt(jt.Replace,Be.transparent,[!1,!1,!1,!1]),jt.unblended=new jt(jt.Replace,Be.transparent,[!0,!0,!0,!0]),jt.alphaBlended=new jt([1,771],Be.transparent,[!0,!0,!0,!0]);class Hr extends _i{constructor(e,t,n){super(),this.id=e,this._onlySymbols=n,t.on("data",i=>{"source"===i.dataType&&"metadata"===i.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===i.dataType&&"content"===i.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),t.on("error",()=>{this._sourceErrored=!0}),this._source=t,this._tiles={},this._cache=new lm(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new sm,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const n=this._tiles[t];n.upload(e),n.prepare(this.map.style.imageManager)}}getIds(){return Ms(this._tiles).map(e=>e.tileID).sort(ap).map(e=>e.key)}getRenderableIds(e){const t=[];for(const n in this._tiles)this._isIdRenderable(+n,e)&&t.push(this._tiles[n]);return e?t.sort((n,i)=>{const s=n.tileID,a=i.tileID,o=new R(s.canonical.x,s.canonical.y)._rotate(this.transform.angle),l=new R(a.canonical.x,a.canonical.y)._rotate(this.transform.angle);return s.overscaledZ-a.overscaledZ||l.y-o.y||l.x-o.x}).map(n=>n.tileID.key):t.map(n=>n.tileID).sort(ap).map(n=>n.key)}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const n=this._tiles[e];n&&("loading"!==n.state&&(n.state=t),this._loadTile(n,this._tileLoaded.bind(this,n,e,t)))}_tileLoaded(e,t,n,i){if(i)if(e.state="errored",404!==i.status)this._source.fire(new Sa(i,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const s=this.map.painter.terrain;this.update(this.transform,s.getScaledDemTileSize(),!0),s.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Dr.now(),"expired"===n&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Br("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const t=this.getRenderableIds();for(let i=0;i<t.length;i++){const s=t[i];if(e.neighboringTiles&&e.neighboringTiles[s]){const a=this.getTileByID(s);n(e,a),n(a,e)}}function n(i,s){if(!i.dem||i.dem.borderReady)return;i.needsHillshadePrepare=!0,i.needsDEMTextureUpload=!0;let a=s.tileID.canonical.x-i.tileID.canonical.x;const o=s.tileID.canonical.y-i.tileID.canonical.y,l=Math.pow(2,i.tileID.canonical.z),u=s.tileID.key;0===a&&0===o||Math.abs(o)>1||(Math.abs(a)>1&&(1===Math.abs(a+l)?a+=l:1===Math.abs(a-l)&&(a-=l)),s.dem&&i.dem&&(i.dem.backfillBorder(s.dem,a,o),i.neighboringTiles&&i.neighboringTiles[u]&&(i.neighboringTiles[u].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,n,i){for(const s in this._tiles){let a=this._tiles[s];if(i[s]||!a.hasData()||a.tileID.overscaledZ<=t||a.tileID.overscaledZ>n)continue;let o=a.tileID;for(;a&&a.tileID.overscaledZ>t+1;){const u=a.tileID.scaledTo(a.tileID.overscaledZ-1);a=this._tiles[u.key],a&&a.hasData()&&(o=u)}let l=o;for(;l.overscaledZ>t;)if(l=l.scaledTo(l.overscaledZ-1),e[l.key]){i[o.key]=o;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=t?n:null}for(let n=e.overscaledZ-1;n>=t;n--){const i=e.scaledTo(n),s=this._getLoadedTile(i);if(s)return s}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const n=Math.ceil(e.width/t)+1,i=Math.ceil(e.height/t)+1,s=Math.floor(n*i*5),a="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,s):s,o="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,a):a;this._cache.setMaxSize(o)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const n={};for(const i in this._tiles){const s=this._tiles[i];s.tileID=s.tileID.unwrapTo(s.tileID.wrap+t),n[s.tileID.key]=s}this._tiles=n;for(const i in this._timers)clearTimeout(this._timers[i]),delete this._timers[i];for(const i in this._tiles)this._setTileReloadTimer(+i,this._tiles[i])}}update(e,t,n){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!n)return;let i;this.updateCacheSize(e,t),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?i=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(o=>new nt(o.canonical.z,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y)):(i=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(i=i.filter(o=>this._source.hasTile(o)))):i=[];const s=this._updateRetainedTiles(i);if(op(this._source.type)&&0!==i.length){const o={},l={},u=Object.keys(s);for(const p of u){const h=s[p],f=this._tiles[p];if(!f||f.fadeEndTime&&f.fadeEndTime<=Dr.now())continue;const d=this.findLoadedParent(h,Math.max(h.overscaledZ-Hr.maxOverzooming,this._source.minzoom));d&&(this._addTile(d.tileID),o[d.tileID.key]=d.tileID),l[p]=h}const c=i[i.length-1].overscaledZ;for(const p in this._tiles){const h=this._tiles[p];if(s[p]||!h.hasData())continue;let f=h.tileID;for(;f.overscaledZ>c;){f=f.scaledTo(f.overscaledZ-1);const d=this._tiles[f.key];if(d&&d.hasData()&&l[f.key]){s[p]=h.tileID;break}}}for(const p in o)s[p]||(this._coveredTiles[p]=!0,s[p]=o[p])}for(const o in s)this._tiles[o].clearFadeHold();const a=function(o,l){const u=[];for(const c in o)c in l||u.push(c);return u}(this._tiles,s);for(const o of a){const l=this._tiles[o];l.hasSymbolBuckets&&!l.holdingForFade()?l.setHoldDuration(this.map._fadeDuration):l.hasSymbolBuckets&&!l.symbolFadeFinished()||this._removeTile(+o)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const n={},i=e.reduce((u,c)=>Math.min(u,c.overscaledZ),1/0),s=e[0].overscaledZ,a=Math.max(s-Hr.maxOverzooming,this._source.minzoom),o=Math.max(s+Hr.maxUnderzooming,this._source.minzoom),l={};for(const u of e){const c=this._addTile(u);t[u.key]=u,c.hasData()||i<this._source.maxzoom&&(l[u.key]=u)}this._retainLoadedChildren(l,i,o,t);for(const u of e){let c=this._tiles[u.key];if(c.hasData())continue;if(u.canonical.z>=this._source.maxzoom){const h=u.children(this._source.maxzoom)[0],f=this.getTile(h);if(f&&f.hasData()){t[h.key]=h;continue}}else{const h=u.children(this._source.maxzoom);if(t[h[0].key]&&t[h[1].key]&&t[h[2].key]&&t[h[3].key])continue}let p=c.wasRequested();for(let h=u.overscaledZ-1;h>=a;--h){const f=u.scaledTo(h);if(n[f.key]||(n[f.key]=!0,c=this.getTile(f),!c&&p&&(c=this._addTile(f)),c&&(t[f.key]=f,p=c.wasRequested(),c.hasData())))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let n,i=this._tiles[e].tileID;for(;i.overscaledZ>0;){if(i.key in this._loadedParentTiles){n=this._loadedParentTiles[i.key];break}t.push(i.key);const s=i.scaledTo(i.overscaledZ-1);if(n=this._getLoadedTile(s),n)break;i=s}for(const s of t)this._loadedParentTiles[s]=n}}_addTile(e){let t=this._tiles[e.key];if(t)return t;t=this._cache.getAndRemove(e),t&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));const n=Boolean(t);if(!n){const i=this.map?this.map.painter:null;t=new Wh(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,i,this._isRaster),this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,n||this._source.fire(new Br("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const n=t.getExpiryTimeout();n&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},n))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,t,n){const i=[],s=this.transform;if(!s)return i;const a="globe"===s.projection.name,o=fr(s.center.lng);for(const l in this._tiles){const u=this._tiles[l];if(n&&u.clearQueryDebugViz(),u.holdingForFade())continue;let c;if(a){const p=u.tileID.canonical;if(0===p.z){const h=[Math.abs(ue(o,...Nn(p,-1))-o),Math.abs(ue(o,...Nn(p,1))-o)];c=[0,2*h.indexOf(Math.min(...h))-1]}else{const h=[Math.abs(ue(o,...Nn(p,-1))-o),Math.abs(ue(o,...Nn(p,0))-o),Math.abs(ue(o,...Nn(p,1))-o)];c=[h.indexOf(Math.min(...h))-1]}}else c=[0];for(const p of c){const h=e.containsTile(u,s,t,p);h&&i.push(h)}}return i}getVisibleCoordinates(e){const t=this.getRenderableIds(e).map(n=>this._tiles[n].tileID);for(const n of t)n.projMatrix=this.transform.calculateProjMatrix(n.toUnwrapped());return t}hasTransition(){if(this._source.hasTransition())return!0;if(op(this._source.type))for(const e in this._tiles){const t=this._tiles[e];if(void 0!==t.fadeEndTime&&t.fadeEndTime>=Dr.now())return!0}return!1}setFeatureState(e,t,n){this._state.updateState(e=e||"_geojsonTileLayer",t,n)}removeFeatureState(e,t,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,n)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,n){const i=this._tiles[e];i&&i.setDependencies(t,n)}reloadTilesForDependencies(e,t){for(const n in this._tiles)this._tiles[n].hasDependency(e,t)&&this._reloadTile(+n,"reloading");this._cache.filter(n=>!n.hasDependency(e,t))}_preloadTiles(e,t){const n=new Map,i=Array.isArray(e)?e:[e],s=this.map.painter.terrain,a=this.usedForTerrain&&s?s.getScaledDemTileSize():this._source.tileSize;for(const o of i){const l=o.coveringTiles({tileSize:a,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const u of l)n.set(u.key,u);this.usedForTerrain&&o.updateElevation(!1)}!function(o,l,u){if(!o.length)return u(null,[]);let c=o.length;const p=new Array(o.length);let h=null;o.forEach((f,d)=>{l(f,(y,m)=>{y&&(h=y),p[d]=m,0==--c&&u(h,p)})})}(Array.from(n.values()),(o,l)=>{const u=new Wh(o,this._source.tileSize*o.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(u,c=>{"raster-dem"===this._source.type&&u.dem&&this._backfillDEM(u),l(c,u)})},t)}}function ap(r,e){const t=Math.abs(2*r.wrap)-+(r.wrap<0),n=Math.abs(2*e.wrap)-+(e.wrap<0);return r.overscaledZ-e.overscaledZ||n-t||e.canonical.y-r.canonical.y||e.canonical.x-r.canonical.x}function op(r){return"raster"===r||"image"===r||"video"===r||"custom"===r}function Nn(r,e){const t=1<<r.z;return[r.x/t+e,(r.x+1)/t+e]}Hr.maxOverzooming=10,Hr.maxUnderzooming=3;class Vo{constructor(e,t,n){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=n}static create(e,t,n){const i=n||e.findDEMTileFor(t);if(!i||!i.dem)return;const s=i.dem,a=i.tileID,o=1<<t.canonical.z-a.canonical.z;return new Vo(i,i.tileSize/K/o,[(t.canonical.x/o-a.canonical.x)*s.dim,(t.canonical.y/o-a.canonical.y)*s.dim])}tileCoordToPixel(e,t){const n=t*this._scale+this._offset[1],i=Math.floor(e*this._scale+this._offset[0]),s=Math.floor(n);return new R(i,s)}getElevationAt(e,t,n,i){const s=e*this._scale+this._offset[0],a=t*this._scale+this._offset[1],o=Math.floor(s),l=Math.floor(a),u=this._dem;return i=!!i,n?fe(fe(u.get(o,l,i),u.get(o,l+1,i),a-l),fe(u.get(o+1,l,i),u.get(o+1,l+1,i),a-l),s-o):u.get(o,l,i)}getElevationAtPixel(e,t,n){return this._dem.get(e,t,!!n)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Dt(1,e)*this._dem.stride}}class lp{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new _r(K,16,0),this.featureIndexArray=new fc,this.promoteId=t}insert(e,t,n,i,s,a=0){const o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,i,s,a);const l=this.grid;for(let u=0;u<t.length;u++){const c=t[u],p=[1/0,1/0,-1/0,-1/0];for(let h=0;h<c.length;h++){const f=c[h];p[0]=Math.min(p[0],f.x),p[1]=Math.min(p[1],f.y),p[2]=Math.max(p[2],f.x),p[3]=Math.max(p[3],f.y)}p[0]<K&&p[1]<K&&p[2]>=0&&p[3]>=0&&l.insert(o,p[0],p[1],p[2],p[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new So(new os(this.rawTileData)).layers,this.sourceLayerCoder=new Xh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t,n,i){this.loadVTLayers();const s=e.params||{},a=Ai(s.filter),o=e.tileResult,l=e.transform,u=o.bufferedTilespaceBounds,c=this.grid.query(u.min.x,u.min.y,u.max.x,u.max.y,(d,y,m,g)=>function(b,x,v,_,w){for(const S of b)if(x<=S.x&&v<=S.y&&_>=S.x&&w>=S.y)return!0;const A=[new R(x,v),new R(x,w),new R(_,w),new R(_,v)];if(b.length>2)for(const S of A)if(Or(b,S))return!0;for(let S=0;S<b.length-1;S++)if(hd(b[S],b[S+1],A))return!0;return!1}(o.bufferedTilespaceGeometry,d,y,m,g));c.sort(um);let p=null;l.elevation&&c.length>0&&(p=Vo.create(l.elevation,this.tileID));const h={};let f;for(let d=0;d<c.length;d++){const y=c[d];if(y===f)continue;f=y;const m=this.featureIndexArray.get(y);let g=null;this.loadMatchingFeature(h,m,a,s.layers,s.availableImages,t,n,i,(b,x,v,_=0)=>(g||(g=Vt(b,this.tileID.canonical,e.tileTransform)),x.queryIntersectsFeature(o,b,v,g,this.z,e.transform,e.pixelPosMatrix,p,_)))}return h}loadMatchingFeature(e,t,n,i,s,a,o,l,u){const{featureIndex:c,bucketIndex:p,sourceLayerIndex:h,layoutVertexArrayOffset:f}=t,d=this.bucketLayerIDs[p];if(i&&!function(b,x){for(let v=0;v<b.length;v++)if(x.indexOf(b[v])>=0)return!0;return!1}(i,d))return;const y=this.sourceLayerCoder.decode(h),m=this.vtLayers[y].feature(c);if(n.needGeometry){const b=mr(m,!0);if(!n.filter(new Se(this.tileID.overscaledZ),b,this.tileID.canonical))return}else if(!n.filter(new Se(this.tileID.overscaledZ),m))return;const g=this.getId(m,y);for(let b=0;b<d.length;b++){const x=d[b];if(i&&i.indexOf(x)<0)continue;const v=a[x];if(!v)continue;let _={};void 0!==g&&l&&(_=l.getState(v.sourceLayer||"_geojsonTileLayer",g));const w=Re({},o[x]);w.paint=up(w.paint,v.paint,m,_,s),w.layout=up(w.layout,v.layout,m,_,s);const A=!u||u(m,v,_,f);if(!A)continue;const S=new Yh(m,this.z,this.x,this.y,g);S.layer=w;let z=e[x];void 0===z&&(z=e[x]=[]),z.push({featureIndex:c,feature:S,intersectionZ:A})}}lookupSymbolFeatures(e,t,n,i,s,a,o,l){const u={};this.loadVTLayers();const c=Ai(s);for(const p of e)this.loadMatchingFeature(u,{bucketIndex:n,sourceLayerIndex:i,featureIndex:p,layoutVertexArrayOffset:0},c,a,o,l,t);return u}loadFeature(e){const{featureIndex:t,sourceLayerIndex:n}=e;this.loadVTLayers();const i=this.sourceLayerCoder.decode(n),s=this.vtFeatures[i];if(s[t])return s[t];const a=this.vtLayers[i].feature(t);return s[t]=a,a}hasLayer(e){for(const t of this.bucketLayerIDs)for(const n of t)if(e===n)return!0;return!1}getId(e,t){let n=e.id;if(this.promoteId){const i="string"==typeof this.promoteId?this.promoteId:this.promoteId[t];null!=i&&(n=e.properties[i]),"boolean"==typeof n&&(n=Number(n))}return n}}function up(r,e,t,n,i){return zs(r,(s,a)=>{const o=e instanceof Bi?e.get(a):null;return o&&o.evaluate?o.evaluate(t,n,i):o})}function um(r,e){return e-r}U(lp,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class cp{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new gr({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const n=this.getKey(e,t);return this.positions[n]}trim(){const e=this.width,t=this.height=(n=this.nextRow)<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2));var n;this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,n){const i=[];let s=e.length%2==1?-e[e.length-1]*n:0,a=e[0]*n,o=!0;i.push({left:s,right:a,isDash:o,zeroLength:0===e[0]});let l=e[0];for(let u=1;u<e.length;u++){o=!o;const c=e[u];s=l*n,l+=c,a=l*n,i.push({left:s,right:a,isDash:o,zeroLength:0===c})}return i}addRoundDash(e,t,n){const i=t/2;for(let s=-n;s<=n;s++){const a=this.width*(this.nextRow+n+s);let o=0,l=e[o];for(let u=0;u<this.width;u++){u/l.right>1&&(l=e[++o]);const c=Math.abs(u-l.left),p=Math.abs(u-l.right),h=Math.min(c,p);let f;const d=s/n*(i+1);if(l.isDash){const y=i-Math.abs(d);f=Math.sqrt(h*h+y*y)}else f=i-Math.sqrt(h*h+d*d);this.image.data[a+u]=Math.max(0,Math.min(255,f+128))}}}addRegularDash(e,t){for(let l=e.length-1;l>=0;--l){const u=e[l],c=e[l+1];u.zeroLength?e.splice(l,1):c&&c.isDash===u.isDash&&(c.left=u.left,e.splice(l,1))}const n=e[0],i=e[e.length-1];n.isDash===i.isDash&&(n.left=i.left-this.width,i.right=n.right+this.width);const s=this.width*this.nextRow;let a=0,o=e[a];for(let l=0;l<this.width;l++){l/o.right>1&&(o=e[++a]);const u=Math.abs(l-o.left),c=Math.abs(l-o.right),p=Math.min(u,c);this.image.data[s+l]=Math.max(0,Math.min(255,(o.isDash?p:-p)+t+128))}}addDash(e,t){const n=this.getKey(e,t);if(this.positions[n])return this.positions[n];const i="round"===t,s=i?7:0,a=2*s+1;if(this.nextRow+a>this.height)return Ee("LineAtlas out of space"),null;0===e.length&&e.push(1);let o=0;for(let c=0;c<e.length;c++)e[c]<0&&(Ee("Negative value is found in line dasharray, replacing values with 0"),e[c]=0),o+=e[c];if(0!==o){const c=this.width/o,p=this.getDashRanges(e,this.width,c);i?this.addRoundDash(p,c,s):this.addRegularDash(p,"square"===t?.5*c:0)}const l=this.nextRow+s;this.nextRow+=a;const u={tl:[l,s],br:[o,0]};return this.positions[n]=u,u}}U(cp,"LineAtlas");class hp{constructor(e){const t={},n=[];for(const o in e){const l=e[o],u=t[o]={};for(const c in l.glyphs){const p=l.glyphs[+c];if(!p||0===p.bitmap.width||0===p.bitmap.height)continue;const h=p.metrics.localGlyph?2:1,f={x:0,y:0,w:p.bitmap.width+2*h,h:p.bitmap.height+2*h};n.push(f),u[c]=f}}const{w:i,h:s}=wh(n),a=new gr({width:i||1,height:s||1});for(const o in e){const l=e[o];for(const u in l.glyphs){const c=l.glyphs[+u];if(!c||0===c.bitmap.width||0===c.bitmap.height)continue;const p=t[o][u],h=c.metrics.localGlyph?2:1;gr.copy(c.bitmap,a,{x:0,y:0},{x:p.x+h,y:p.y+h},c.bitmap)}}this.image=a,this.positions=t}}U(hp,"GlyphAtlas");class cm{constructor(e){this.tileID=new nt(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=jn(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,t,n,i,s){this.status="parsing",this.data=e,this.collisionBoxArray=new Xa;const a=new Xh(Object.keys(e.layers).sort()),o=new lp(this.tileID,this.promoteId);o.bucketLayerIDs=[];const l={},u=new cp(256,256),c={featureIndex:o,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:u,availableImages:n},p=t.familiesBySource[this.source];for(const _ in p){const w=e.layers[_];if(!w)continue;let A=!1,S=!1;for(const k of p[_])"symbol"===k[0].type?A=!0:S=!0;if(!0===this.isSymbolTile&&!A||!1===this.isSymbolTile&&!S)continue;1===w.version&&Ee(`Vector tile source "${this.source}" layer "${_}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const z=a.encode(_),P=[];for(let k=0;k<w.length;k++){const M=w.feature(k),B=o.getId(M,_);P.push({feature:M,id:B,index:k,sourceLayerIndex:z})}for(const k of p[_]){const M=k[0];void 0!==this.isSymbolTile&&"symbol"===M.type!==this.isSymbolTile||M.minzoom&&this.zoom<Math.floor(M.minzoom)||M.maxzoom&&this.zoom>=M.maxzoom||"none"!==M.visibility&&(Lo(k,this.zoom,n),(l[M.id]=M.createBucket({index:o.bucketLayerIDs.length,layers:k,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:z,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:n})).populate(P,c,this.tileID.canonical,this.tileTransform),o.bucketLayerIDs.push(k.map(B=>B.id)))}}let h,f,d,y;u.trim();const m={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},g=zs(c.glyphDependencies,_=>Object.keys(_).map(Number));Object.keys(g).length?i.send("getGlyphs",{uid:this.uid,stacks:g},(_,w)=>{h||(h=_,f=w,v.call(this))},void 0,!1,m):f={};const b=Object.keys(c.iconDependencies);b.length?i.send("getImages",{icons:b,source:this.source,tileID:this.tileID,type:"icons"},(_,w)=>{h||(h=_,d=w,v.call(this))},void 0,!1,m):d={};const x=Object.keys(c.patternDependencies);function v(){if(h)return s(h);if(f&&d&&y){const _=new hp(f),w=new Sh(d,y);for(const A in l){const S=l[A];S instanceof tr?(Lo(S.layers,this.zoom,n),Dy(S,f,_.positions,d,w.iconPositions,this.showCollisionBoxes,n,this.tileID.canonical,this.tileZoom,this.projection)):S.hasPattern&&(S instanceof ss||S instanceof es||S instanceof is)&&(Lo(S.layers,this.zoom,n),S.addFeatures(c,this.tileID.canonical,w.patternPositions,n,this.tileTransform))}this.status="done",s(null,{buckets:Ms(l).filter(A=>!A.isEmpty()),featureIndex:o,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:_.image,lineAtlas:u,imageAtlas:w,glyphMap:this.returnDependencies?f:null,iconMap:this.returnDependencies?d:null,glyphPositions:this.returnDependencies?_.positions:null})}}x.length?i.send("getImages",{icons:x,source:this.source,tileID:this.tileID,type:"patterns"},(_,w)=>{h||(h=_,y=w,v.call(this))},void 0,!1,m):y={},v.call(this)}}function Lo(r,e,t){const n=new Se(e);for(const i of r)i.recalculate(n,t)}class hm{constructor(e){this.entries={},this.scheduler=e}request(e,t,n,i){const s=this.entries[e]=this.entries[e]||{callbacks:[]};if(s.result){const[a,o]=s.result;return this.scheduler?this.scheduler.add(()=>{i(a,o)},t):i(a,o),()=>{}}return s.callbacks.push(i),s.cancel||(s.cancel=n((a,o)=>{s.result=[a,o];for(const l of s.callbacks)this.scheduler?this.scheduler.add(()=>{l(a,o)},t):l(a,o);setTimeout(()=>delete this.entries[e],3e3)})),()=>{s.result||(s.callbacks=s.callbacks.filter(a=>a!==i),s.callbacks.length||(s.cancel(),delete this.entries[e]))}}}function pm(r,e,t){const n=JSON.stringify(r.request);return r.data&&(this.deduped.entries[n]={result:[null,r.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},i=>{const s=au(r.request,(a,o,l,u)=>{a?i(a):o&&i(null,{vectorTile:t?void 0:new So(new os(o)),rawData:o,cacheControl:l,expires:u})});return()=>{s.cancel(),i()}},e)}class Fo extends _i{constructor(e,t,n,i,s){super(),this.actor=e,this.layerIndex=t,this.availableImages=n,this.loadVectorData=s||pm,this.loading={},this.loaded={},this.deduped=new hm(e.scheduler),this.isSpriteLoaded=i,this.scheduler=e.scheduler}loadTile(e,t){const n=e.uid,i=e&&e.request,s=i&&i.collectResourceTiming,a=this.loading[n]=new cm(e);a.abort=this.loadVectorData(e,(o,l)=>{const u=!this.loading[n];if(delete this.loading[n],u||o||!l)return a.status="done",u||(this.loaded[n]=a),t(o);const c=l.rawData,p={};l.expires&&(p.expires=l.expires),l.cacheControl&&(p.cacheControl=l.cacheControl),a.vectorTile=l.vectorTile||new So(new os(c));const h=()=>{a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,(f,d)=>{if(f||!d)return t(f);const y={};if(s){const m=uu(i);m.length>0&&(y.resourceTiming=JSON.parse(JSON.stringify(m)))}t(null,Re({rawTileData:c.slice(0)},d,p,y))})};this.isSpriteLoaded?h():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(h,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):h()}),this.loaded=this.loaded||{},this.loaded[n]=a})}reloadTile(e,t){const n=this.loaded,i=e.uid,s=this;if(n&&n[i]){const a=n[i];a.showCollisionBoxes=e.showCollisionBoxes,a.enableTerrain=!!e.enableTerrain,a.projection=e.projection,a.tileTransform=jn(e.tileID.canonical,e.projection);const o=(l,u)=>{const c=a.reloadCallback;c&&(delete a.reloadCallback,a.parse(a.vectorTile,s.layerIndex,this.availableImages,s.actor,c)),t(l,u)};"parsing"===a.status?a.reloadCallback=o:"done"===a.status&&(a.vectorTile?a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,o):o())}}abortTile(e,t){const n=e.uid,i=this.loading[n];i&&(i.abort&&i.abort(),delete this.loading[n]),t()}removeTile(e,t){const n=this.loaded,i=e.uid;n&&n[i]&&delete n[i],t()}}class fm{loadTile(e,t){const{uid:n,encoding:i,rawImageData:s,padding:a,buildQuadTree:o}=e,l=Z.ImageBitmap&&s instanceof Z.ImageBitmap?this.getImageData(s,a):s;t(null,new ws(n,l,i,a<1,o))}getImageData(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const n=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),n}}var dm=function r(e,t){var n,i=e&&e.type;if("FeatureCollection"===i)for(n=0;n<e.features.length;n++)r(e.features[n],t);else if("GeometryCollection"===i)for(n=0;n<e.geometries.length;n++)r(e.geometries[n],t);else if("Feature"===i)r(e.geometry,t);else if("Polygon"===i)pp(e.coordinates,t);else if("MultiPolygon"===i)for(n=0;n<e.coordinates.length;n++)pp(e.coordinates[n],t);return e};function pp(r,e){if(0!==r.length){fp(r[0],e);for(var t=1;t<r.length;t++)fp(r[t],!e)}}function fp(r,e){for(var t=0,n=0,i=0,s=r.length,a=s-1;i<s;a=i++){var o=(r[i][0]-r[a][0])*(r[a][1]+r[i][1]),l=t+o;n+=Math.abs(t)>=Math.abs(o)?t-l+o:o-l+t,t=l}t+n>=0!=!!e&&r.reverse()}const ym=rs.prototype.toGeoJSON;class mm{constructor(e){this._feature=e,this.extent=K,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))}loadGeometry(){if(1===this._feature.type){const e=[];for(const t of this._feature.geometry)e.push([new R(t[0],t[1])]);return e}{const e=[];for(const t of this._feature.geometry){const n=[];for(const i of t)n.push(new R(i[0],i[1]));e.push(n)}return e}}toGeoJSON(e,t,n){return ym.call(this,e,t,n)}}class gm{constructor(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=K,this.length=e.length,this._features=e}feature(e){return new mm(this._features[e])}}var Qr={},xm={get exports(){return Qr},set exports(r){Qr=r}},vm=R,bm=ts.VectorTileFeature,wm=dp;function dp(r,e){this.options=e||{},this.features=r,this.length=r.length}function _s(r,e){this.id="number"==typeof r.id?r.id:void 0,this.type=r.type,this.rawGeometry=1===r.type?[r.geometry]:r.geometry,this.properties=r.tags,this.extent=e||4096}dp.prototype.feature=function(r){return new _s(this.features[r],this.options.extent)},_s.prototype.loadGeometry=function(){var r=this.rawGeometry;this.geometry=[];for(var e=0;e<r.length;e++){for(var t=r[e],n=[],i=0;i<t.length;i++)n.push(new vm(t[i][0],t[i][1]));this.geometry.push(n)}return this.geometry},_s.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var r=this.geometry,e=1/0,t=-1/0,n=1/0,i=-1/0,s=0;s<r.length;s++)for(var a=r[s],o=0;o<a.length;o++){var l=a[o];e=Math.min(e,l.x),t=Math.max(t,l.x),n=Math.min(n,l.y),i=Math.max(i,l.y)}return[e,n,t,i]},_s.prototype.toGeoJSON=bm.prototype.toGeoJSON;var _m=os,yp=wm;function Ro(r){var e=new _m;return function(t,n){for(var i in t.layers)n.writeMessage(3,Sm,t.layers[i])}(r,e),e.finish()}function Sm(r,e){var t;e.writeVarintField(15,r.version||1),e.writeStringField(1,r.name||""),e.writeVarintField(5,r.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(t=0;t<r.length;t++)n.feature=r.feature(t),e.writeMessage(2,Am,n);var i=n.keys;for(t=0;t<i.length;t++)e.writeStringField(3,i[t]);var s=n.values;for(t=0;t<s.length;t++)e.writeMessage(4,Mm,s[t])}function Am(r,e){var t=r.feature;void 0!==t.id&&e.writeVarintField(1,t.id),e.writeMessage(2,km,r),e.writeVarintField(3,t.type),e.writeMessage(4,Im,t)}function km(r,e){var t=r.feature,n=r.keys,i=r.values,s=r.keycache,a=r.valuecache;for(var o in t.properties){var l=t.properties[o],u=s[o];if(null!==l){void 0===u&&(n.push(o),s[o]=u=n.length-1),e.writeVarint(u);var c=typeof l;"string"!==c&&"boolean"!==c&&"number"!==c&&(l=JSON.stringify(l));var p=c+":"+l,h=a[p];void 0===h&&(i.push(l),a[p]=h=i.length-1),e.writeVarint(h)}}}function jo(r,e){return(e<<3)+(7&r)}function mp(r){return r<<1^r>>31}function Im(r,e){for(var t=r.loadGeometry(),n=r.type,i=0,s=0,a=t.length,o=0;o<a;o++){var l=t[o],u=1;1===n&&(u=l.length),e.writeVarint(jo(1,u));for(var c=3===n?l.length-1:l.length,p=0;p<c;p++){1===p&&1!==n&&e.writeVarint(jo(2,c-1));var h=l[p].x-i,f=l[p].y-s;e.writeVarint(mp(h)),e.writeVarint(mp(f)),i+=h,s+=f}3===n&&e.writeVarint(jo(7,1))}}function Mm(r,e){var t=typeof r;"string"===t?e.writeStringField(1,r):"boolean"===t?e.writeBooleanField(7,r):"number"===t&&(r%1!=0?e.writeDoubleField(3,r):r<0?e.writeSVarintField(6,r):e.writeVarintField(5,r))}function $o(r,e,t,n,i,s){if(i-n<=t)return;const a=n+i>>1;gp(r,e,a,n,i,s%2),$o(r,e,t,n,a-1,s+1),$o(r,e,t,a+1,i,s+1)}function gp(r,e,t,n,i,s){for(;i>n;){if(i-n>600){const u=i-n+1,c=t-n+1,p=Math.log(u),h=.5*Math.exp(2*p/3),f=.5*Math.sqrt(p*h*(u-h)/u)*(c-u/2<0?-1:1);gp(r,e,t,Math.max(n,Math.floor(t-c*h/u+f)),Math.min(i,Math.floor(t+(u-c)*h/u+f)),s)}const a=e[2*t+s];let o=n,l=i;for(Zn(r,e,n,t),e[2*i+s]>a&&Zn(r,e,n,i);o<l;){for(Zn(r,e,o,l),o++,l--;e[2*o+s]<a;)o++;for(;e[2*l+s]>a;)l--}e[2*n+s]===a?Zn(r,e,n,l):(l++,Zn(r,e,l,i)),l<=t&&(n=l+1),t<=l&&(i=l-1)}}function Zn(r,e,t,n){Oo(r,t,n),Oo(e,2*t,2*n),Oo(e,2*t+1,2*n+1)}function Oo(r,e,t){const n=r[e];r[e]=r[t],r[t]=n}function xp(r,e,t,n){const i=r-t,s=e-n;return i*i+s*s}xm.exports=Ro,Qr.fromVectorTileJs=Ro,Qr.fromGeojsonVt=function(r,e){e=e||{};var t={};for(var n in r)t[n]=new yp(r[n].features,e),t[n].name=n,t[n].version=e.version,t[n].extent=e.extent;return Ro({layers:t})},Qr.GeoJSONWrapper=yp;const Tm=r=>r[0],zm=r=>r[1];class vp{constructor(e,t=Tm,n=zm,i=64,s=Float64Array){this.nodeSize=i,this.points=e;const a=e.length<65536?Uint16Array:Uint32Array,o=this.ids=new a(e.length),l=this.coords=new s(2*e.length);for(let u=0;u<e.length;u++)o[u]=u,l[2*u]=t(e[u]),l[2*u+1]=n(e[u]);$o(o,l,i,0,o.length-1,0)}range(e,t,n,i){return function(s,a,o,l,u,c,p){const h=[0,s.length-1,0],f=[];let d,y;for(;h.length;){const m=h.pop(),g=h.pop(),b=h.pop();if(g-b<=p){for(let _=b;_<=g;_++)d=a[2*_],y=a[2*_+1],d>=o&&d<=u&&y>=l&&y<=c&&f.push(s[_]);continue}const x=Math.floor((b+g)/2);d=a[2*x],y=a[2*x+1],d>=o&&d<=u&&y>=l&&y<=c&&f.push(s[x]);const v=(m+1)%2;(0===m?o<=d:l<=y)&&(h.push(b),h.push(x-1),h.push(v)),(0===m?u>=d:c>=y)&&(h.push(x+1),h.push(g),h.push(v))}return f}(this.ids,this.coords,e,t,n,i,this.nodeSize)}within(e,t,n){return function(i,s,a,o,l,u){const c=[0,i.length-1,0],p=[],h=l*l;for(;c.length;){const f=c.pop(),d=c.pop(),y=c.pop();if(d-y<=u){for(let v=y;v<=d;v++)xp(s[2*v],s[2*v+1],a,o)<=h&&p.push(i[v]);continue}const m=Math.floor((y+d)/2),g=s[2*m],b=s[2*m+1];xp(g,b,a,o)<=h&&p.push(i[m]);const x=(f+1)%2;(0===f?a-l<=g:o-l<=b)&&(c.push(y),c.push(m-1),c.push(x)),(0===f?a+l>=g:o+l>=b)&&(c.push(m+1),c.push(d),c.push(x))}return p}(this.ids,this.coords,e,t,n,this.nodeSize)}}const Bm={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:r=>r},Ss=Math.fround||(Uo=new Float32Array(1),r=>(Uo[0]=+r,Uo[0]));var Uo;class Cm{constructor(e){this.options=Gn(Object.create(Bm),e),this.trees=new Array(this.options.maxZoom+1)}load(e){const{log:t,minZoom:n,maxZoom:i,nodeSize:s}=this.options;t&&console.time("total time");const a=`prepare ${e.length} points`;t&&console.time(a),this.points=e;let o=[];for(let l=0;l<e.length;l++)e[l].geometry&&o.push(Em(e[l],l));this.trees[i+1]=new vp(o,_p,Sp,s,Float32Array),t&&console.timeEnd(a);for(let l=i;l>=n;l--){const u=+Date.now();o=this._cluster(o,l),this.trees[l]=new vp(o,_p,Sp,s,Float32Array),t&&console.log("z%d: %d clusters in %dms",l,o.length,+Date.now()-u)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let n=((e[0]+180)%360+360)%360-180;const i=Math.max(-90,Math.min(90,e[1]));let s=180===e[2]?180:((e[2]+180)%360+360)%360-180;const a=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,s=180;else if(n>s){const c=this.getClusters([n,i,180,a],t),p=this.getClusters([-180,i,s,a],t);return c.concat(p)}const o=this.trees[this._limitZoom(t)],l=o.range(As(n),ks(a),As(s),ks(i)),u=[];for(const c of l){const p=o.points[c];u.push(p.numPoints?bp(p):this.points[p.index])}return u}getChildren(e){const t=this._getOriginId(e),n=this._getOriginZoom(e),i="No cluster with the specified id.",s=this.trees[n];if(!s)throw new Error(i);const a=s.points[t];if(!a)throw new Error(i);const o=this.options.radius/(this.options.extent*Math.pow(2,n-1)),l=s.within(a.x,a.y,o),u=[];for(const c of l){const p=s.points[c];p.parentId===e&&u.push(p.numPoints?bp(p):this.points[p.index])}if(0===u.length)throw new Error(i);return u}getLeaves(e,t,n){const i=[];return this._appendLeaves(i,e,t=t||10,n=n||0,0),i}getTile(e,t,n){const i=this.trees[this._limitZoom(e)],s=Math.pow(2,e),{extent:a,radius:o}=this.options,l=o/a,u=(n-l)/s,c=(n+1+l)/s,p={features:[]};return this._addTileFeatures(i.range((t-l)/s,u,(t+1+l)/s,c),i.points,t,n,s,p),0===t&&this._addTileFeatures(i.range(1-l/s,u,1,c),i.points,s,n,s,p),t===s-1&&this._addTileFeatures(i.range(0,u,l/s,c),i.points,-1,n,s,p),p.features.length?p:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t}_appendLeaves(e,t,n,i,s){const a=this.getChildren(t);for(const o of a){const l=o.properties;if(l&&l.cluster?s+l.point_count<=i?s+=l.point_count:s=this._appendLeaves(e,l.cluster_id,n,i,s):s<i?s++:e.push(o),e.length===n)break}return s}_addTileFeatures(e,t,n,i,s,a){for(const o of e){const l=t[o],u=l.numPoints;let c,p,h;if(u)c=wp(l),p=l.x,h=l.y;else{const y=this.points[l.index];c=y.properties,p=As(y.geometry.coordinates[0]),h=ks(y.geometry.coordinates[1])}const f={type:1,geometry:[[Math.round(this.options.extent*(p*s-n)),Math.round(this.options.extent*(h*s-i))]],tags:c};let d;u?d=l.id:this.options.generateId?d=l.index:this.points[l.index].id&&(d=this.points[l.index].id),void 0!==d&&(f.id=d),a.features.push(f)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const n=[],{radius:i,extent:s,reduce:a,minPoints:o}=this.options,l=i/(s*Math.pow(2,t));for(let u=0;u<e.length;u++){const c=e[u];if(c.zoom<=t)continue;c.zoom=t;const p=this.trees[t+1],h=p.within(c.x,c.y,l),f=c.numPoints||1;let d=f;for(const y of h){const m=p.points[y];m.zoom>t&&(d+=m.numPoints||1)}if(d>f&&d>=o){let y=c.x*f,m=c.y*f,g=a&&f>1?this._map(c,!0):null;const b=(u<<5)+(t+1)+this.points.length;for(const x of h){const v=p.points[x];if(v.zoom<=t)continue;v.zoom=t;const _=v.numPoints||1;y+=v.x*_,m+=v.y*_,v.parentId=b,a&&(g||(g=this._map(c,!0)),a(g,this._map(v)))}c.parentId=b,n.push(Pm(y/d,m/d,b,d,g))}else if(n.push(c),d>1)for(const y of h){const m=p.points[y];m.zoom<=t||(m.zoom=t,n.push(m))}}return n}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t){if(e.numPoints)return t?Gn({},e.properties):e.properties;const n=this.points[e.index].properties,i=this.options.map(n);return t&&i===n?Gn({},i):i}}function Pm(r,e,t,n,i){return{x:Ss(r),y:Ss(e),zoom:1/0,id:t,parentId:-1,numPoints:n,properties:i}}function Em(r,e){const[t,n]=r.geometry.coordinates;return{x:Ss(As(t)),y:Ss(ks(n)),zoom:1/0,index:e,parentId:-1}}function bp(r){return{type:"Feature",id:r.id,properties:wp(r),geometry:{type:"Point",coordinates:[(e=r.x,360*(e-.5)),Dm(r.y)]}};var e}function wp(r){const e=r.numPoints,t=e>=1e4?`${Math.round(e/1e3)}k`:e>=1e3?Math.round(e/100)/10+"k":e;return Gn(Gn({},r.properties),{cluster:!0,cluster_id:r.id,point_count:e,point_count_abbreviated:t})}function As(r){return r/360+.5}function ks(r){const e=Math.sin(r*Math.PI/180),t=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return t<0?0:t>1?1:t}function Dm(r){const e=(180-360*r)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function Gn(r,e){for(const t in e)r[t]=e[t];return r}function _p(r){return r.x}function Sp(r){return r.y}function qo(r,e,t,n){for(var i,s=n,a=t-e>>1,o=t-e,l=r[e],u=r[e+1],c=r[t],p=r[t+1],h=e+3;h<t;h+=3){var f=Vm(r[h],r[h+1],l,u,c,p);if(f>s)i=h,s=f;else if(f===s){var d=Math.abs(h-a);d<o&&(i=h,o=d)}}s>n&&(i-e>3&&qo(r,e,i,n),r[i+2]=s,t-i>3&&qo(r,i,t,n))}function Vm(r,e,t,n,i,s){var a=i-t,o=s-n;if(0!==a||0!==o){var l=((r-t)*a+(e-n)*o)/(a*a+o*o);l>1?(t=i,n=s):l>0&&(t+=a*l,n+=o*l)}return(a=r-t)*a+(o=e-n)*o}function Xn(r,e,t,n){var i={id:void 0===r?null:r,type:e,geometry:t,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(s){var a=s.geometry,o=s.type;if("Point"===o||"MultiPoint"===o||"LineString"===o)No(s,a);else if("Polygon"===o||"MultiLineString"===o)for(var l=0;l<a.length;l++)No(s,a[l]);else if("MultiPolygon"===o)for(l=0;l<a.length;l++)for(var u=0;u<a[l].length;u++)No(s,a[l][u])}(i),i}function No(r,e){for(var t=0;t<e.length;t+=3)r.minX=Math.min(r.minX,e[t]),r.minY=Math.min(r.minY,e[t+1]),r.maxX=Math.max(r.maxX,e[t]),r.maxY=Math.max(r.maxY,e[t+1])}function Zo(r,e,t,n){if(e.geometry){var i=e.geometry.coordinates,s=e.geometry.type,a=Math.pow(t.tolerance/((1<<t.maxZoom)*t.extent),2),o=[],l=e.id;if(t.promoteId?l=e.properties[t.promoteId]:t.generateId&&(l=n||0),"Point"===s)Ap(i,o);else if("MultiPoint"===s)for(var u=0;u<i.length;u++)Ap(i[u],o);else if("LineString"===s)Go(i,o,a,!1);else if("MultiLineString"===s){if(t.lineMetrics){for(u=0;u<i.length;u++)Go(i[u],o=[],a,!1),r.push(Xn(l,"LineString",o,e.properties));return}Xo(i,o,a,!1)}else if("Polygon"===s)Xo(i,o,a,!0);else{if("MultiPolygon"!==s){if("GeometryCollection"===s){for(u=0;u<e.geometry.geometries.length;u++)Zo(r,{id:l,geometry:e.geometry.geometries[u],properties:e.properties},t,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(u=0;u<i.length;u++){var c=[];Xo(i[u],c,a,!0),o.push(c)}}r.push(Xn(l,s,o,e.properties))}}function Ap(r,e){e.push(kp(r[0])),e.push(Ip(r[1])),e.push(0)}function Go(r,e,t,n){for(var i,s,a=0,o=0;o<r.length;o++){var l=kp(r[o][0]),u=Ip(r[o][1]);e.push(l),e.push(u),e.push(0),o>0&&(a+=n?(i*u-l*s)/2:Math.sqrt(Math.pow(l-i,2)+Math.pow(u-s,2))),i=l,s=u}var c=e.length-3;e[2]=1,qo(e,0,c,t),e[c+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function Xo(r,e,t,n){for(var i=0;i<r.length;i++){var s=[];Go(r[i],s,t,n),e.push(s)}}function kp(r){return r/360+.5}function Ip(r){var e=Math.sin(r*Math.PI/180),t=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return t<0?0:t>1?1:t}function $t(r,e,t,n,i,s,a,o){if(n/=e,s>=(t/=e)&&a<n)return r;if(a<t||s>=n)return null;for(var l=[],u=0;u<r.length;u++){var c=r[u],p=c.geometry,h=c.type,f=0===i?c.minX:c.minY,d=0===i?c.maxX:c.maxY;if(f>=t&&d<n)l.push(c);else if(!(d<t||f>=n)){var y=[];if("Point"===h||"MultiPoint"===h)Lm(p,y,t,n,i);else if("LineString"===h)Mp(p,y,t,n,i,!1,o.lineMetrics);else if("MultiLineString"===h)Yo(p,y,t,n,i,!1);else if("Polygon"===h)Yo(p,y,t,n,i,!0);else if("MultiPolygon"===h)for(var m=0;m<p.length;m++){var g=[];Yo(p[m],g,t,n,i,!0),g.length&&y.push(g)}if(y.length){if(o.lineMetrics&&"LineString"===h){for(m=0;m<y.length;m++)l.push(Xn(c.id,h,y[m],c.tags));continue}"LineString"!==h&&"MultiLineString"!==h||(1===y.length?(h="LineString",y=y[0]):h="MultiLineString"),"Point"!==h&&"MultiPoint"!==h||(h=3===y.length?"Point":"MultiPoint"),l.push(Xn(c.id,h,y,c.tags))}}}return l.length?l:null}function Lm(r,e,t,n,i){for(var s=0;s<r.length;s+=3){var a=r[s+i];a>=t&&a<=n&&(e.push(r[s]),e.push(r[s+1]),e.push(r[s+2]))}}function Mp(r,e,t,n,i,s,a){for(var o,l,u=Tp(r),c=0===i?Fm:Rm,p=r.start,h=0;h<r.length-3;h+=3){var f=r[h],d=r[h+1],y=r[h+2],m=r[h+3],g=r[h+4],b=0===i?f:d,x=0===i?m:g,v=!1;a&&(o=Math.sqrt(Math.pow(f-m,2)+Math.pow(d-g,2))),b<t?x>t&&(l=c(u,f,d,m,g,t),a&&(u.start=p+o*l)):b>n?x<n&&(l=c(u,f,d,m,g,n),a&&(u.start=p+o*l)):Ko(u,f,d,y),x<t&&b>=t&&(l=c(u,f,d,m,g,t),v=!0),x>n&&b<=n&&(l=c(u,f,d,m,g,n),v=!0),!s&&v&&(a&&(u.end=p+o*l),e.push(u),u=Tp(r)),a&&(p+=o)}var _=r.length-3;f=r[_],d=r[_+1],y=r[_+2],(b=0===i?f:d)>=t&&b<=n&&Ko(u,f,d,y),_=u.length-3,s&&_>=3&&(u[_]!==u[0]||u[_+1]!==u[1])&&Ko(u,u[0],u[1],u[2]),u.length&&e.push(u)}function Tp(r){var e=[];return e.size=r.size,e.start=r.start,e.end=r.end,e}function Yo(r,e,t,n,i,s){for(var a=0;a<r.length;a++)Mp(r[a],e,t,n,i,s,!1)}function Ko(r,e,t,n){r.push(e),r.push(t),r.push(n)}function Fm(r,e,t,n,i,s){var a=(s-e)/(n-e);return r.push(s),r.push(t+(i-t)*a),r.push(1),a}function Rm(r,e,t,n,i,s){var a=(s-t)/(i-t);return r.push(e+(n-e)*a),r.push(s),r.push(1),a}function zp(r,e){for(var t=[],n=0;n<r.length;n++){var i,s=r[n],a=s.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=Jo(s.geometry,e);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var o=0;o<s.geometry.length;o++)i.push(Jo(s.geometry[o],e))}else if("MultiPolygon"===a)for(i=[],o=0;o<s.geometry.length;o++){for(var l=[],u=0;u<s.geometry[o].length;u++)l.push(Jo(s.geometry[o][u],e));i.push(l)}t.push(Xn(s.id,a,i,s.tags))}return t}function Jo(r,e){var t=[];t.size=r.size,void 0!==r.start&&(t.start=r.start,t.end=r.end);for(var n=0;n<r.length;n+=3)t.push(r[n]+e,r[n+1],r[n+2]);return t}function Bp(r,e){if(r.transformed)return r;var t,n,i,s=1<<r.z,a=r.x,o=r.y;for(t=0;t<r.features.length;t++){var l=r.features[t],u=l.geometry,c=l.type;if(l.geometry=[],1===c)for(n=0;n<u.length;n+=2)l.geometry.push(Cp(u[n],u[n+1],e,s,a,o));else for(n=0;n<u.length;n++){var p=[];for(i=0;i<u[n].length;i+=2)p.push(Cp(u[n][i],u[n][i+1],e,s,a,o));l.geometry.push(p)}}return r.transformed=!0,r}function Cp(r,e,t,n,i,s){return[Math.round(t*(r*n-i)),Math.round(t*(e*n-s))]}function jm(r,e,t,n,i){for(var s=e===i.maxZoom?0:i.tolerance/((1<<e)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:t,y:n,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},o=0;o<r.length;o++){a.numFeatures++,$m(a,r[o],s,i);var l=r[o].minX,u=r[o].minY,c=r[o].maxX,p=r[o].maxY;l<a.minX&&(a.minX=l),u<a.minY&&(a.minY=u),c>a.maxX&&(a.maxX=c),p>a.maxY&&(a.maxY=p)}return a}function $m(r,e,t,n){var i=e.geometry,s=e.type,a=[];if("Point"===s||"MultiPoint"===s)for(var o=0;o<i.length;o+=3)a.push(i[o]),a.push(i[o+1]),r.numPoints++,r.numSimplified++;else if("LineString"===s)Wo(a,i,r,t,!1,!1);else if("MultiLineString"===s||"Polygon"===s)for(o=0;o<i.length;o++)Wo(a,i[o],r,t,"Polygon"===s,0===o);else if("MultiPolygon"===s)for(var l=0;l<i.length;l++){var u=i[l];for(o=0;o<u.length;o++)Wo(a,u[o],r,t,!0,0===o)}if(a.length){var c=e.tags||null;if("LineString"===s&&n.lineMetrics){for(var p in c={},e.tags)c[p]=e.tags[p];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var h={geometry:a,type:"Polygon"===s||"MultiPolygon"===s?3:"LineString"===s||"MultiLineString"===s?2:1,tags:c};null!==e.id&&(h.id=e.id),r.features.push(h)}}function Wo(r,e,t,n,i,s){var a=n*n;if(n>0&&e.size<(i?a:n))t.numPoints+=e.length/3;else{for(var o=[],l=0;l<e.length;l+=3)(0===n||e[l+2]>a)&&(t.numSimplified++,o.push(e[l]),o.push(e[l+1])),t.numPoints++;i&&function(u,c){for(var p=0,h=0,f=u.length,d=f-2;h<f;d=h,h+=2)p+=(u[h]-u[d])*(u[h+1]+u[d+1]);if(p>0===c)for(h=0,f=u.length;h<f/2;h+=2){var y=u[h],m=u[h+1];u[h]=u[f-2-h],u[h+1]=u[f-1-h],u[f-2-h]=y,u[f-1-h]=m}}(o,s),r.push(o)}}function Is(r,e){var t=(e=this.options=function(i,s){for(var a in s)i[a]=s[a];return i}(Object.create(this.options),e)).debug;if(t&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var i,s,a,o,l,u,n=function(i,s){var a=[];if("FeatureCollection"===i.type)for(var o=0;o<i.features.length;o++)Zo(a,i.features[o],s,o);else Zo(a,"Feature"===i.type?i:{geometry:i},s);return a}(r,e);this.tiles={},this.tileCoords=[],t&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),o=i=n,l=$t(i,1,-1-(a=(s=e).buffer/s.extent),a,0,-1,2,s),u=$t(i,1,1-a,2+a,0,-1,2,s),(l||u)&&(o=$t(i,1,-a,1+a,0,-1,2,s)||[],l&&(o=zp(l,1).concat(o)),u&&(o=o.concat(zp(u,-1)))),(n=o).length&&this.splitTile(n,0,0,0),t&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ho(r,e,t){return 32*((1<<r)*t+e)+r}function Om(r,e){const t=r.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);const n=this._geoJSONIndex.getTile(t.z,t.x,t.y);if(!n)return e(null,null);const i=new gm(n.features);let s=Qr(i);0===s.byteOffset&&s.byteLength===s.buffer.byteLength||(s=new Uint8Array(s)),e(null,{vectorTile:i,rawData:s.buffer})}Is.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Is.prototype.splitTile=function(r,e,t,n,i,s,a){for(var o=[r,e,t,n],l=this.options,u=l.debug;o.length;){n=o.pop(),t=o.pop(),e=o.pop(),r=o.pop();var c=1<<e,p=Ho(e,t,n),h=this.tiles[p];if(!h&&(u>1&&console.time("creation"),h=this.tiles[p]=jm(r,e,t,n,l),this.tileCoords.push({z:e,x:t,y:n}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,t,n,h.numFeatures,h.numPoints,h.numSimplified),console.timeEnd("creation"));var f="z"+e;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(h.source=r,i){if(e===l.maxZoom||e===i)continue;var d=1<<i-e;if(t!==Math.floor(s/d)||n!==Math.floor(a/d))continue}else if(e===l.indexMaxZoom||h.numPoints<=l.indexMaxPoints)continue;if(h.source=null,0!==r.length){u>1&&console.time("clipping");var y,m,g,b,x,v,_=.5*l.buffer/l.extent,w=.5-_,A=.5+_,S=1+_;y=m=g=b=null,x=$t(r,c,t-_,t+A,0,h.minX,h.maxX,l),v=$t(r,c,t+w,t+S,0,h.minX,h.maxX,l),r=null,x&&(y=$t(x,c,n-_,n+A,1,h.minY,h.maxY,l),m=$t(x,c,n+w,n+S,1,h.minY,h.maxY,l),x=null),v&&(g=$t(v,c,n-_,n+A,1,h.minY,h.maxY,l),b=$t(v,c,n+w,n+S,1,h.minY,h.maxY,l),v=null),u>1&&console.timeEnd("clipping"),o.push(y||[],e+1,2*t,2*n),o.push(m||[],e+1,2*t,2*n+1),o.push(g||[],e+1,2*t+1,2*n),o.push(b||[],e+1,2*t+1,2*n+1)}}},Is.prototype.getTile=function(r,e,t){var n=this.options,i=n.extent,s=n.debug;if(r<0||r>24)return null;var a=1<<r,o=Ho(r,e=(e%a+a)%a,t);if(this.tiles[o])return Bp(this.tiles[o],i);s>1&&console.log("drilling down to z%d-%d-%d",r,e,t);for(var l,u=r,c=e,p=t;!l&&u>0;)u--,c=Math.floor(c/2),p=Math.floor(p/2),l=this.tiles[Ho(u,c,p)];return l&&l.source?(s>1&&console.log("found parent tile z%d-%d-%d",u,c,p),s>1&&console.time("drilling down"),this.splitTile(l.source,u,c,p,r,e,t),s>1&&console.timeEnd("drilling down"),this.tiles[o]?Bp(this.tiles[o],i):null):null};class Um extends Fo{constructor(e,t,n,i,s){super(e,t,n,i,Om),s&&(this.loadGeoJSON=s)}loadData(e,t){const n=e&&e.request,i=n&&n.collectResourceTiming;this.loadGeoJSON(e,(s,a)=>{if(s||!a)return t(s);if("object"!=typeof a)return t(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));{dm(a,!0);try{if(e.filter){const l=lr(e.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===l.result)throw new Error(l.value.map(c=>`${c.key}: ${c.message}`).join(", "));a={type:"FeatureCollection",features:a.features.filter(c=>l.value.evaluate({zoom:0},c))}}this._geoJSONIndex=e.cluster?new Cm(function({superclusterOptions:l,clusterProperties:u}){if(!u||!l)return l;const c={},p={},h={accumulated:null,zoom:0},f={properties:null},d=Object.keys(u);for(const y of d){const[m,g]=u[y],b=lr(g),x=lr("string"==typeof m?[m,["accumulated"],["get",y]]:m);c[y]=b.value,p[y]=x.value}return l.map=y=>{f.properties=y;const m={};for(const g of d)m[g]=c[g].evaluate(h,f);return m},l.reduce=(y,m)=>{f.properties=m;for(const g of d)h.accumulated=y[g],y[g]=p[g].evaluate(h,f)},l}(e)).load(a.features):new Is(l=a,e.geojsonVtOptions)}catch(l){return t(l)}this.loaded={};const o={};if(i){const l=uu(n);l&&(o.resourceTiming={},o.resourceTiming[e.source]=JSON.parse(JSON.stringify(l)))}t(null,o)}var l})}reloadTile(e,t){const n=this.loaded;return n&&n[e.uid]?super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(e,t){if(e.request)i=t,bi(Re(e.request,{type:"json"}),i);else{if("string"!=typeof e.data)return t(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));try{return t(null,JSON.parse(e.data))}catch{return t(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`))}}var i}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(n){t(n)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(n){t(n)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(n){t(n)}}}typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new class Pp{constructor(e){this.self=e,this.actor=new If(e,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=To({name:"mercator"}),this.workerSourceTypes={vector:Fo,geojson:Um},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(t,n)=>{if(this.workerSourceTypes[t])throw new Error(`Worker source with name "${t}" already registered.`);this.workerSourceTypes[t]=n},this.self.registerRTLTextPlugin=t=>{if(Le.isParsed())throw new Error("RTL text plugin already registered.");Le.applyArabicShaping=t.applyArabicShaping,Le.processBidirectionalText=t.processBidirectionalText,Le.processStyledBidirectionalText=t.processStyledBidirectionalText}}clearCaches(e,t,n){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e],n()}checkIfReady(e,t,n){n()}setReferrer(e,t){this.referrer=t}spriteLoaded(e,t){this.isSpriteLoaded[e]=t;for(const n in this.workerSources[e]){const i=this.workerSources[e][n];for(const s in i)i[s]instanceof Fo&&(i[s].isSpriteLoaded=t,i[s].fire(new Br("isSpriteLoaded")))}}setImages(e,t,n){this.availableImages[e]=t;for(const i in this.workerSources[e]){const s=this.workerSources[e][i];for(const a in s)s[a].availableImages=t}n()}enableTerrain(e,t,n){this.terrain=t,n()}setProjection(e,t){this.projections[e]=To(t)}setLayers(e,t,n){this.getLayerIndex(e).replace(t),n()}updateLayers(e,t,n){this.getLayerIndex(e).update(t.layers,t.removedIds),n()}loadTile(e,t,n){const i=this.enableTerrain?Re({enableTerrain:this.terrain},t):t;i.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source).loadTile(i,n)}loadDEMTile(e,t,n){const i=this.enableTerrain?Re({buildQuadTree:this.terrain},t):t;this.getDEMWorkerSource(e,t.source).loadTile(i,n)}reloadTile(e,t,n){const i=this.enableTerrain?Re({enableTerrain:this.terrain},t):t;i.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source).reloadTile(i,n)}abortTile(e,t,n){this.getWorkerSource(e,t.type,t.source).abortTile(t,n)}removeTile(e,t,n){this.getWorkerSource(e,t.type,t.source).removeTile(t,n)}removeSource(e,t,n){if(!this.workerSources[e]||!this.workerSources[e][t.type]||!this.workerSources[e][t.type][t.source])return;const i=this.workerSources[e][t.type][t.source];delete this.workerSources[e][t.type][t.source],void 0!==i.removeSource?i.removeSource(t,n):n()}loadWorkerSource(e,t,n){try{this.self.importScripts(t.url),n()}catch(i){n(i.toString())}}syncRTLPluginState(e,t,n){try{Le.setState(t);const i=Le.getPluginURL();if(Le.isLoaded()&&!Le.isParsed()&&null!=i){this.self.importScripts(i);const s=Le.isParsed();n(s?void 0:new Error(`RTL Text Plugin failed to import scripts from ${i}`),s)}}catch(i){n(i.toString())}}getAvailableImages(e){let t=this.availableImages[e];return t||(t=[]),t}getLayerIndex(e){let t=this.layerIndexes[e];return t||(t=this.layerIndexes[e]=new rm),t}getWorkerSource(e,t,n){return this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),this.workerSources[e][t][n]||(this.workerSources[e][t][n]=new this.workerSourceTypes[t]({send:(s,a,o,l,u,c)=>{this.actor.send(s,a,o,e,u,c)},scheduler:this.actor.scheduler},this.getLayerIndex(e),this.getAvailableImages(e),this.isSpriteLoaded[e])),this.workerSources[e][t][n]}getDEMWorkerSource(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new fm),this.demWorkerSources[e][t]}enforceCacheSizeLimit(e,t){var n;n=t,vi(),Ct&&Ct.then(i=>{i.keys().then(s=>{for(let a=0;a<s.length-n;a++)i.delete(s[a])})})}getWorkerPerformanceMetrics(e,t,n){n(void 0,void 0)}}(self))}()})();